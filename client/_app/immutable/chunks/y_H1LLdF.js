import{c as ee,b as ue,ak as re,d as H,h as S,g as fe,$ as oe,v as K,K as ce,a1 as de,a2 as he,a3 as Q,s as L,e as C,C as pe,al as me,am as j,an as ve,ao as z,ap as P,aq as _e,ar as X,t as Ae,as as G,at as te,au as be,av as ne,aw as Ee,ax as ge,ay as V,Z as ye,az as ae,aA as Ie,a as we,aB as Ne,aC as Te,aD as xe,I as Se}from"./iAwc3qQu.js";function Ue(e,t){return t}function De(e,t,r){for(var n=e.items,i=[],o=t.length,u=0;u<o;u++)Ne(t[u].e,i,!0);var m=o>0&&i.length===0&&r!==null;if(m){var b=r.parentNode;Te(b),b.append(r),n.clear(),I(e,t[0].prev,t[o-1].next)}xe(i,()=>{for(var A=0;A<o;A++){var h=t[A];m||(n.delete(h.k),I(e,h.prev,h.next)),ae(h.e,!m)}})}function ze(e,t,r,n,i,o=null){var u=e,m={flags:t,items:new Map,first:null},b=(t&re)!==0;if(b){var A=e;u=S?H(fe(A)):A.appendChild(ee())}S&&oe();var h=null,N=!1,E=new Map,T=ce(()=>{var d=r();return be(d)?d:d==null?[]:te(d)}),s,c;function f(){Me(c,s,m,E,u,i,t,n,r),o!==null&&(s.length===0?h?ne(h):h=j(()=>o(u)):h!==null&&Ee(h,()=>{h=null}))}ue(()=>{c??(c=Se),s=K(T);var d=s.length;if(N&&d===0)return;N=d===0;let _=!1;if(S){var g=de(u)===he;g!==(d===0)&&(u=Q(),H(u),L(!1),_=!0)}if(S){for(var w=null,p,a=0;a<d;a++){if(C.nodeType===pe&&C.data===me){u=C,_=!0,L(!1);break}var l=s[a],v=n(l,a);p=q(C,m,w,null,l,v,a,i,t,r),m.items.set(v,p),w=p}d>0&&H(Q())}if(S)d===0&&o&&(h=j(()=>o(u)));else if(ve()){var D=new Set,R=_e;for(a=0;a<d;a+=1){l=s[a],v=n(l,a);var x=m.items.get(v)??E.get(v);x?t&(z|P)&&se(x,l,a,t):(p=q(null,m,null,null,l,v,a,i,t,r,!0),E.set(v,p)),D.add(v)}for(const[y,U]of m.items)D.has(y)||R.skipped_effects.add(U.e);R.oncommit(f)}else f();_&&L(!0),K(T)}),S&&(u=C)}function Me(e,t,r,n,i,o,u,m,b){var W,B,J,Y;var A=(u&Ie)!==0,h=(u&(z|P))!==0,N=t.length,E=r.items,T=r.first,s=T,c,f=null,d,_=[],g=[],w,p,a,l;if(A)for(l=0;l<N;l+=1)w=t[l],p=m(w,l),a=E.get(p),a!==void 0&&((W=a.a)==null||W.measure(),(d??(d=new Set)).add(a));for(l=0;l<N;l+=1){if(w=t[l],p=m(w,l),a=E.get(p),a===void 0){var v=n.get(p);if(v!==void 0){n.delete(p),E.set(p,v);var D=f?f.next:s;I(r,f,v),I(r,v,D),F(v,D,i),f=v}else{var R=s?s.e.nodes_start:i;f=q(R,r,f,f===null?r.first:f.next,w,p,l,o,u,b)}E.set(p,f),_=[],g=[],s=f.next;continue}if(h&&se(a,w,l,u),a.e.f&V&&(ne(a.e),A&&((B=a.a)==null||B.unfix(),(d??(d=new Set)).delete(a))),a!==s){if(c!==void 0&&c.has(a)){if(_.length<g.length){var x=g[0],y;f=x.prev;var U=_[0],Z=_[_.length-1];for(y=0;y<_.length;y+=1)F(_[y],x,i);for(y=0;y<g.length;y+=1)c.delete(g[y]);I(r,U.prev,Z.next),I(r,f,U),I(r,Z,x),s=x,f=Z,l-=1,_=[],g=[]}else c.delete(a),F(a,s,i),I(r,a.prev,a.next),I(r,a,f===null?r.first:f.next),I(r,f,a),f=a;continue}for(_=[],g=[];s!==null&&s.k!==p;)s.e.f&V||(c??(c=new Set)).add(s),g.push(s),s=s.next;if(s===null)continue;a=s}_.push(a),f=a,s=a.next}if(s!==null||c!==void 0){for(var M=c===void 0?[]:te(c);s!==null;)s.e.f&V||M.push(s),s=s.next;var $=M.length;if($>0){var ie=u&re&&N===0?i:null;if(A){for(l=0;l<$;l+=1)(J=M[l].a)==null||J.measure();for(l=0;l<$;l+=1)(Y=M[l].a)==null||Y.fix()}De(r,M,ie)}}A&&ye(()=>{var k;if(d!==void 0)for(a of d)(k=a.a)==null||k.apply()}),e.first=r.first&&r.first.e,e.last=f&&f.e;for(var le of n.values())ae(le.e);n.clear()}function se(e,t,r,n){n&z&&X(e.v,t),n&P?X(e.i,r):e.i=r}function q(e,t,r,n,i,o,u,m,b,A,h){var N=(b&z)!==0,E=(b&ge)===0,T=N?E?Ae(i,!1,!1):G(i):i,s=b&P?G(u):u,c={i:s,v:T,k:o,a:null,e:null,prev:r,next:n};try{if(e===null){var f=document.createDocumentFragment();f.append(e=ee())}return c.e=j(()=>m(e,T,s,A),S),c.e.prev=r&&r.e,c.e.next=n&&n.e,r===null?h||(t.first=c):(r.next=c,r.e.next=c.e),n!==null&&(n.prev=c,n.e.prev=c.e),c}finally{}}function F(e,t,r){for(var n=e.next?e.next.e.nodes_start:r,i=t?t.e.nodes_start:r,o=e.e.nodes_start;o!==null&&o!==n;){var u=we(o);i.before(o),o=u}}function I(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}class Pe{constructor(t,r,n,i){var o,u;this.note=r,this.activity=n,this.actor=t,r.published?this.published=String(r.published):(o=r.ephemeral)!=null&&o.timestamp?this.published=r.ephemeral.timestamp:this.published=new Date().toISOString(),(u=r.ephemeral)!=null&&u.timestamp?this.created_at=r.ephemeral.timestamp:this.created_at=new Date().toISOString(),this.replies=i||new Map,this.public=this.isPublic()}jsonTo(){let t=[];return this.note.to&&t.push(...O(this.note.to)),this.note.cc&&t.push(...O(this.note.cc)),JSON.stringify(t)}jsonSender(){return JSON.stringify(this.actor)}isPublic(){const t=["https://www.w3.org/ns/activitystreams#Public","as:Public","Public"];let r=[];return this.note.to&&r.push(...O(this.note.to)),this.note.cc&&r.push(...O(this.note.cc)),r.some(n=>t.includes(n))}}const Ze=e=>typeof e=="object"&&e!==null&&e.type==="Note",$e=e=>typeof e=="object"&&e!==null&&e.type==="EncryptedNote",He=e=>typeof e=="object"&&e!==null&&e.type==="Article",Le=e=>typeof e=="object"&&e!==null;function Ve(e){const t=["","k","M","B","T"];let r=0;for(;e>=1e3&&r<t.length-1;)e/=1e3,r++;return r===0?Math.floor(e).toString():e.toFixed(1)+t[r]}function Fe(e){if(typeof e=="string")return e;if(Array.isArray(e))return e[0]}const je=(e,t)=>{try{const r=new URL(e);let n=r.pathname.slice(1);const i=r.hostname;return n=n.endsWith("/")?n.slice(0,-1):n,n.startsWith("@")?t?`${n}`:`${n}@${i}`:null}catch(r){return console.error("Error parsing URL:",r),null}};function qe(e){return new Promise(t=>setTimeout(t,e))}function We(e){const t=/^https:\/\/([a-zA-Z0-9\-.]+?)\/[A-Za-z0-9/\-._]+$/;if(e.id){const r=e.id.match(t);if(r)return`@${e.preferredUsername}@${r[1]}`}return String(e.url)}function Be(e,t,r){return e&&r.tag&&O(r.tag).forEach(i=>{i.type==="Emoji"&&i.icon&&t&&(t=t.replaceAll(i.name,`<img class="emoji" src="${Ce(e,i.icon.url)}"/>`))}),t}function Je(e,t){return Date.parse(e.created_at)<Date.parse(t.created_at)?-1:Date.parse(e.created_at)>Date.parse(t.created_at)?1:0}function Ye(e){const t=new URL(e),r=t.searchParams.get("max"),n=t.searchParams.get("min");return r?{value:r,type:"max"}:n?{value:n,type:"min"}:{value:null,type:null}}function ke(e){const t=/https:\/\/(?:[a-zA-Z0-9.-]+)(?:\.[a-zA-Z0-9.-]+)+\/(?:notes|conversation)\/([a-zA-Z0-9-]+)/,r=e.match(t);return r&&r[1]?r[1]:null}function Ke(e,t){const r=/(https:\/\/(?:[a-zA-Z0-9.-]+)(?:\.[a-zA-Z0-9.-]+)+)\/.*/,n=e.match(r),i=t.match(r);return n!==null&&i!==null&&n[1]==i[1]}function Ce(e,t){return e?"/api/cache?url="+e.get_url_safe_base64(t):t}function Oe(e){return e.instrument&&e.instrument.find(r=>r.type==="VaultItem")||null}const Qe=(e,t)=>{if((t==null?void 0:t.object.type)=="EncryptedNote"){let r;return e&&(r=Oe(t))?e.decrypt_text(r.content)||"":'<span class"failure">Message could not be decrypted</span>'}else return(t==null?void 0:t.object.content)||""},Xe=e=>e?e.replace(/<[^>]*>/g," "):"",Ge=e=>e?Array.isArray(e)?e[0]||null:e:null,O=e=>e==null?[]:Array.isArray(e)?e:[e];export{Pe as D,ke as a,je as b,Je as c,Ge as d,ze as e,Ye as f,We as g,Fe as h,Ue as i,Ce as j,Be as k,Ve as l,Qe as m,Ke as n,$e as o,He as p,Ze as q,Xe as r,qe as s,Le as t,O as u};
