import{w as D,J as I}from"./DR2rOELM.js";function E(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Z(e,t){e.d(1),t.delete(e.key)}function $(e,t,s,n,i,p,u,_,A,N,m,x){let o=e.length,h=p.length,l=o;const y={};for(;l--;)y[e[l].key]=l;const f=[],g=new Map,b=new Map,j=[];for(l=h;l--;){const r=x(i,p,l),c=s(r);let a=u.get(c);a?j.push(()=>a.p(r,t)):(a=N(c,r),a.c()),g.set(c,f[l]=a),c in y&&b.set(c,Math.abs(l-y[c]))}const S=new Set,M=new Set;function w(r){I(r,1),r.m(_,m),u.set(r.key,r),m=r.first,h--}for(;o&&h;){const r=f[h-1],c=e[o-1],a=r.key,d=c.key;r===c?(m=r.first,o--,h--):g.has(d)?!u.has(a)||S.has(a)?w(r):M.has(d)?o--:b.get(a)>b.get(d)?(M.add(a),w(r)):(S.add(d),o--):(A(c,u),o--)}for(;o--;){const r=e[o];g.has(r.key)||A(r,u)}for(;h;)w(f[h-1]);return D(j),f}class T{constructor(t,s,n,i){var p,u;this.note=s,this.activity=n,this.actor=t,s.published?this.published=String(s.published):(p=s.ephemeral)!=null&&p.timestamp?this.published=s.ephemeral.timestamp:this.published=new Date().toISOString(),(u=s.ephemeral)!=null&&u.timestamp?this.created_at=s.ephemeral.timestamp:this.created_at=new Date().toISOString(),this.replies=i||new Map,this.public=this.isPublic()}jsonTo(){let t=[];return this.note.to&&(Array.isArray(this.note.to)?t.push(...this.note.to):t.push(this.note.to)),this.note.cc&&(Array.isArray(this.note.cc)?t.push(...this.note.cc):t.push(this.note.cc)),JSON.stringify(t)}jsonSender(){return JSON.stringify(this.actor)}isPublic(){const t=["https://www.w3.org/ns/activitystreams#Public","as:Public","Public"];let s=[];return this.note.to&&(Array.isArray(this.note.to)?s.push(...this.note.to):s.push(this.note.to)),this.note.cc&&(Array.isArray(this.note.cc)?s.push(...this.note.cc):s.push(this.note.cc)),s.some(n=>t.includes(n))}}const v=e=>typeof e=="object"&&e!==null&&e.type==="Note",F=e=>typeof e=="object"&&e!==null&&e.type==="EncryptedNote",O=e=>typeof e=="object"&&e!==null,V=e=>typeof e=="object"&&e!==null;function W(e){const t=["","k","M","B","T"];let s=0;for(;e>=1e3&&s<t.length-1;)e/=1e3,s++;return s===0?Math.floor(e).toString():e.toFixed(1)+t[s]}function J(e){if(typeof e=="string")return e;if(Array.isArray(e))return e[0]}const L=(e,t)=>{try{const s=new URL(e);let n=s.pathname.slice(1);const i=s.hostname;return n=n.endsWith("/")?n.slice(0,-1):n,n.startsWith("@")?t?`${n}`:`${n}@${i}`:null}catch(s){return console.error("Error parsing URL:",s),null}};function R(e){return new Promise(t=>setTimeout(t,e))}function k(e){const t=/^https:\/\/([a-zA-Z0-9\-.]+?)\/[A-Za-z0-9/\-._]+$/;if(e.id){const s=e.id.match(t);if(s)return`@${e.preferredUsername}@${s[1]}`}return String(e.url)}function q(e,t,s){if(e&&s.tag){let n=[];Array.isArray(s.tag)?n=[...s.tag]:n.push(s.tag),n.forEach(i=>{i.type==="Emoji"&&i.icon&&t&&(t=t.replaceAll(i.name,`<img class="emoji" src="${P(e,i.icon.url)}"/>`))})}return t}function B(e,t){return Date.parse(e.created_at)<Date.parse(t.created_at)?-1:Date.parse(e.created_at)>Date.parse(t.created_at)?1:0}function C(e){const t=new URL(e),s=t.searchParams.get("max"),n=t.searchParams.get("min");return s?{value:s,type:"max"}:n?{value:n,type:"min"}:{value:null,type:null}}function Q(e){const t=/https:\/\/(?:[a-zA-Z0-9.-]+)(?:\.[a-zA-Z0-9.-]+)+\/(?:notes|conversation)\/([a-zA-Z0-9-]+)/,s=e.match(t);return s&&s[1]?s[1]:null}function G(e,t){const s=/(https:\/\/(?:[a-zA-Z0-9.-]+)(?:\.[a-zA-Z0-9.-]+)+)\/.*/,n=e.match(s),i=t.match(s);return n!==null&&i!==null&&n[1]==i[1]}function P(e,t){return e?"/api/cache?url="+e.get_url_safe_base64(t):t}function U(e){return e.instrument&&e.instrument.find(s=>s.type==="VaultItem")||null}const H=(e,t)=>{if((t==null?void 0:t.object.type)=="EncryptedNote"){let s;return e&&(s=U(t))?e.decrypt_text(s.content)||"":'<span class"failure">Message could not be decrypted</span>'}else return(t==null?void 0:t.object.content)||""},K=e=>e?e.replace(/<[^>]*>/g," "):"";export{T as D,Q as a,B as b,P as c,C as d,E as e,L as f,k as g,v as h,q as i,O as j,V as k,J as l,W as m,H as n,G as o,F as p,Z as q,K as r,R as s,$ as u};
