import{Q as pt,R as vt,S as Ae,G as gt,s as pe,f as v,a as U,g,h as w,d as h,c as H,j as c,E as te,i as I,v as p,C as Y,F as E,w as Ee,o as je,e as x,H as ut,p as De,B as ye,L as ht,l as Z,m as $,n as le,T as bt,u as me,D as ae,J as ve,K as ge,O as Le,U as kt,V as wt}from"./scheduler.vJi1FF2t.js";import{e as Ne,f as ne,i as se,l as Me,h as we,c as Oe,m as Et}from"./common.iVHbJUVt.js";import{g as ie,t as B,c as oe,a as G,S as be,i as ke,b as ce,d as fe,m as ue,e as he}from"./index.NkgvvCTc.js";import{e as Te}from"./stores.Q3fukup_.js";import{p as jt}from"./stores.RFVp_Ggc.js";import"./paths.s9Ljdrp4.js";function _e(s,e){const t=e.token={};function l(n,r,a,o){if(e.token!==t)return;e.resolved=o;let i=e.ctx;a!==void 0&&(i=i.slice(),i[a]=o);const f=n&&(e.current=n)(i);let d=!1;e.block&&(e.blocks?e.blocks.forEach((u,_)=>{_!==r&&u&&(ie(),B(u,1,1,()=>{e.blocks[_]===u&&(e.blocks[_]=null)}),oe())}):e.block.d(1),f.c(),G(f,1),f.m(e.mount(),e.anchor),d=!0),e.block=f,e.blocks&&(e.blocks[r]=f),d&&gt()}if(pt(s)){const n=vt();if(s.then(r=>{Ae(n),l(e.then,1,e.value,r),Ae(null)},r=>{if(Ae(n),l(e.catch,2,e.error,r),Ae(null),!e.hasCatch)throw r}),e.current!==e.pending)return l(e.pending,0),!0}else{if(e.current!==e.then)return l(e.then,1,e.value,s),!0;e.resolved=s}}function Ce(s,e,t){const l=e.slice(),{resolved:n}=s;s.current===s.then&&(l[s.value]=n),s.current===s.catch&&(l[s.error]=n),s.block.p(l,t)}function Ie(s){let e=s.replies.size;return s.replies.size>0&&s.replies.forEach(t=>{e+=Ie(t)}),e}function ze(s,e,t){const l=s.slice();return l[17]=e[t],l}function Re(s){let e,t=Ne(s[0].attachment),l=[];for(let n=0;n<t.length;n+=1)l[n]=qe(ze(s,t,n));return{c(){for(let n=0;n<l.length;n+=1)l[n].c();e=x()},l(n){for(let r=0;r<l.length;r+=1)l[r].l(n);e=x()},m(n,r){for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(n,r);I(n,e,r)},p(n,r){if(r&177){t=Ne(n[0].attachment);let a;for(a=0;a<t.length;a+=1){const o=ze(n,t,a);l[a]?l[a].p(o,r):(l[a]=qe(o),l[a].c(),l[a].m(e.parentNode,e))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(n){n&&h(e),ut(l,n)}}}function It(s){let e,t,l,n,r,a;return{c(){e=v("div"),t=v("audio"),n=U(),this.h()},l(o){e=g(o,"DIV",{class:!0,tabindex:!0});var i=w(e);t=g(i,"AUDIO",{src:!0}),w(t).forEach(h),n=H(i),i.forEach(h),this.h()},h(){t.controls=!0,te(t.src,l=ne(s[4],String(s[17].url)))||c(t,"src",l),c(e,"class",ye(s[5].getPlacement())+" svelte-1qbmjua"),c(e,"tabindex","0")},m(o,i){I(o,e,i),p(e,t),p(e,n),r||(a=Y(t,"error",s[15]),r=!0)},p(o,i){i&17&&!te(t.src,l=ne(o[4],String(o[17].url)))&&c(t,"src",l)},d(o){o&&h(e),r=!1,a()}}}function Tt(s){let e,t,l,n,r,a,o,i,f,d;return{c(){e=v("div"),t=v("video"),l=v("source"),i=U(),this.h()},l(u){e=g(u,"DIV",{class:!0,tabindex:!0});var _=w(e);t=g(_,"VIDEO",{width:!0,height:!0});var k=w(t);l=g(k,"SOURCE",{src:!0,type:!0}),k.forEach(h),i=H(_),_.forEach(h),this.h()},h(){te(l.src,n=ne(s[4],String(s[17].url)))||c(l,"src",n),c(l,"type",r=s[17].mediaType),c(t,"width",a=s[17].width),c(t,"height",o=s[17].height),t.controls=!0,c(e,"class",ye(s[5].getPlacement())+" svelte-1qbmjua"),c(e,"tabindex","0")},m(u,_){I(u,e,_),p(e,t),p(t,l),p(e,i),f||(d=[Y(l,"error",s[13]),Y(t,"error",s[14])],f=!0)},p(u,_){_&17&&!te(l.src,n=ne(u[4],String(u[17].url)))&&c(l,"src",n),_&1&&r!==(r=u[17].mediaType)&&c(l,"type",r),_&1&&a!==(a=u[17].width)&&c(t,"width",a),_&1&&o!==(o=u[17].height)&&c(t,"height",o)},d(u){u&&h(e),f=!1,ht(d)}}}function St(s){let e,t,l,n,r,a,o,i,f;return{c(){e=v("div"),t=v("img"),o=U(),this.h()},l(d){e=g(d,"DIV",{class:!0,tabindex:!0});var u=w(e);t=g(u,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),o=H(u),u.forEach(h),this.h()},h(){te(t.src,l=ne(s[4],String(s[17].url)))||c(t,"src",l),c(t,"width",n=s[17].width),c(t,"height",r=s[17].height),c(t,"alt",a=s[17].name),c(t,"class","svelte-1qbmjua"),c(e,"class",ye(s[5].getPlacement())+" svelte-1qbmjua"),c(e,"tabindex","0")},m(d,u){I(d,e,u),p(e,t),p(e,o),i||(f=[Y(t,"click",s[7]),Y(t,"error",s[12])],i=!0)},p(d,u){u&17&&!te(t.src,l=ne(d[4],String(d[17].url)))&&c(t,"src",l),u&1&&n!==(n=d[17].width)&&c(t,"width",n),u&1&&r!==(r=d[17].height)&&c(t,"height",r),u&1&&a!==(a=d[17].name)&&c(t,"alt",a)},d(d){d&&h(e),i=!1,ht(f)}}}function qe(s){let e,t,l,n;function r(i,f){if(f&1&&(e=null),f&1&&(t=null),f&1&&(l=null),e==null&&(e=!!(i[17].type=="Document"&&/^(?:image)\/.+$/.test(String(i[17].mediaType))||i[17].type=="Image")),e)return St;if(t==null&&(t=!!(i[17].type=="Document"&&/^(?:video)\/.+$/.test(String(i[17].mediaType)))),t)return Tt;if(l==null&&(l=!!(i[17].type=="Document"&&/^(?:audio)\/.+$/.test(String(i[17].mediaType)))),l)return It}let a=r(s,-1),o=a&&a(s);return{c(){o&&o.c(),n=x()},l(i){o&&o.l(i),n=x()},m(i,f){o&&o.m(i,f),I(i,n,f)},p(i,f){a===(a=r(i,f))&&o?o.p(i,f):(o&&o.d(1),o=a&&a(i),o&&(o.c(),o.m(n.parentNode,n)))},d(i){i&&h(n),o&&o.d(i)}}}function At(s){let e,t,l,n,r,a,o,i,f,d=s[0].attachment&&Re(s);return{c(){e=v("div"),t=U(),l=v("div"),n=v("img"),a=U(),o=v("section"),d&&d.c(),this.h()},l(u){e=g(u,"DIV",{class:!0}),w(e).forEach(h),t=H(u),l=g(u,"DIV",{role:!0,"aria-labelledby":!0,class:!0});var _=w(l);n=g(_,"IMG",{src:!0,class:!0}),_.forEach(h),a=H(u),o=g(u,"SECTION",{class:!0});var k=w(o);d&&d.l(k),k.forEach(h),this.h()},h(){c(e,"class","mask hidden svelte-1qbmjua"),te(n.src,r="#")||c(n,"src",r),c(n,"class","svelte-1qbmjua"),c(l,"role","img"),c(l,"aria-labelledby","cancel"),c(l,"class","image hidden svelte-1qbmjua"),c(o,"class","svelte-1qbmjua")},m(u,_){I(u,e,_),s[9](e),I(u,t,_),I(u,l,_),p(l,n),s[10](n),s[11](l),I(u,a,_),I(u,o,_),d&&d.m(o,null),i||(f=Y(n,"click",s[6]),i=!0)},p(u,[_]){u[0].attachment?d?d.p(u,_):(d=Re(u),d.c(),d.m(o,null)):d&&(d.d(1),d=null)},i:E,o:E,d(u){u&&(h(e),h(t),h(l),h(a),h(o)),s[9](null),s[10](null),s[11](null),d&&d.d(),i=!1,f()}}}function Dt(s,e,t){let l,n;Ee(s,Te,m=>t(8,n=m));let{note:r}=e;je(async()=>{});class a{constructor(P){a.total=P}static{this.total=0}static{this.iteration=0}getPlacement(){return a.iteration++,a.total%2===0||a.total>=3&&a.iteration!==1?"half":"full"}}let o=new a(r.attachment?.length||0),i,f,d;const u=m=>{console.log(m),t(1,i.src="#",i),d.classList.add("hidden"),f.classList.add("hidden")},_=m=>{console.log(m),m.target&&m.target.src&&(t(1,i.src=m.target.src,i),d.classList.remove("hidden"),f.classList.remove("hidden"))};function k(m){De[m?"unshift":"push"](()=>{f=m,t(2,f)})}function b(m){De[m?"unshift":"push"](()=>{i=m,t(1,i)})}function T(m){De[m?"unshift":"push"](()=>{d=m,t(3,d)})}const N=m=>console.log(m),C=m=>console.log(m),L=m=>console.log(m),O=m=>console.log(m);return s.$$set=m=>{"note"in m&&t(0,r=m.note)},s.$$.update=()=>{s.$$.dirty&256&&t(4,l=n)},[r,i,f,d,l,o,u,_,n,k,b,T,N,C,L,O]}class dt extends be{constructor(e){super(),ke(this,e,Dt,At,pe,{note:0})}}function Nt(s){let e,t,l,n;return{c(){e=v("time"),t=Z(s[1]),this.h()},l(r){e=g(r,"TIME",{datetime:!0,title:!0});var a=w(e);t=$(a,s[1]),a.forEach(h),this.h()},h(){c(e,"datetime",l=s[0].toISOString()),c(e,"title",n=s[0].toLocaleString())},m(r,a){I(r,e,a),p(e,t)},p(r,[a]){a&2&&le(t,r[1]),a&1&&l!==(l=r[0].toISOString())&&c(e,"datetime",l),a&1&&n!==(n=r[0].toLocaleString())&&c(e,"title",n)},i:E,o:E,d(r){r&&h(e)}}}function Ct(s){const e=Math.floor((new Date().getTime()-s.getTime())/1e3);return e<60?`${e}s`:e<3600?`${Math.floor(e/60)}m`:e<86400?`${Math.floor(e/3600)}h`:e<604800?`${Math.floor(e/86400)}d`:e<2592e3?`${Math.floor(e/604800)}w`:e<31536e3?`${Math.floor(e/2592e3)}mo`:`${Math.floor(e/31536e3)}y`}function Lt(s){const e=Math.floor((new Date().getTime()-s.getTime())/1e3);return e<60?1e3:e<3600?6e4:e<86400?36e5:e<604800?864e5:36e5*12}function Mt(s,e,t){let{timestamp:l=new Date}=e,n="",r;function a(){t(1,n=Ct(l)),clearInterval(r),r=setInterval(a,Lt(l))}return je(()=>{a()}),bt(()=>{clearInterval(r)}),s.$$set=o=>{"timestamp"in o&&t(0,l=o.timestamp)},[l,n]}class _t extends be{constructor(e){super(),ke(this,e,Mt,Nt,pe,{timestamp:0})}}function Ge(s){let e,t,l,n,r="Edit",a,o;return{c(){e=v("li"),t=Z("Delete"),l=U(),n=v("li"),n.textContent=r,this.h()},l(i){e=g(i,"LI",{"data-object":!0,class:!0});var f=w(e);t=$(f,"Delete"),f.forEach(h),l=H(i),n=g(i,"LI",{class:!0,"data-svelte-h":!0}),me(n)!=="svelte-nqb85c"&&(n.textContent=r),this.h()},h(){c(e,"data-object",s[0]),c(e,"class","svelte-t3gszi"),c(n,"class","svelte-t3gszi")},m(i,f){I(i,e,f),p(e,t),I(i,l,f),I(i,n,f),a||(o=Y(e,"click",ae(s[4])),a=!0)},p(i,f){f&1&&c(e,"data-object",i[0])},d(i){i&&(h(e),h(l),h(n)),a=!1,o()}}}function yt(s){let e,t,l,n,r,a,o="Mute Author",i,f,d="Block Author",u,_,k="Block Instance",b,T,N=s[1]&&Ge(s);return{c(){e=v("i"),t=U(),l=v("dialog"),n=v("ul"),N&&N.c(),r=U(),a=v("li"),a.textContent=o,i=U(),f=v("li"),f.textContent=d,u=U(),_=v("li"),_.textContent=k,this.h()},l(C){e=g(C,"I",{class:!0,"data-object":!0}),w(e).forEach(h),t=H(C),l=g(C,"DIALOG",{class:!0});var L=w(l);n=g(L,"UL",{class:!0});var O=w(n);N&&N.l(O),r=H(O),a=g(O,"LI",{class:!0,"data-svelte-h":!0}),me(a)!=="svelte-cedbu2"&&(a.textContent=o),i=H(O),f=g(O,"LI",{class:!0,"data-svelte-h":!0}),me(f)!=="svelte-1gvp02o"&&(f.textContent=d),u=H(O),_=g(O,"LI",{class:!0,"data-svelte-h":!0}),me(_)!=="svelte-5kz5l4"&&(_.textContent=k),O.forEach(h),L.forEach(h),this.h()},h(){c(e,"class","fa-solid fa-ellipsis svelte-t3gszi"),c(e,"data-object",s[0]),c(a,"class","svelte-t3gszi"),c(f,"class","svelte-t3gszi"),c(_,"class","svelte-t3gszi"),c(n,"class","svelte-t3gszi"),c(l,"class","svelte-t3gszi")},m(C,L){I(C,e,L),I(C,t,L),I(C,l,L),p(l,n),N&&N.m(n,null),p(n,r),p(n,a),p(n,i),p(n,f),p(n,u),p(n,_),s[7](l),b||(T=Y(e,"click",s[3]),b=!0)},p(C,[L]){L&1&&c(e,"data-object",C[0]),C[1]?N?N.p(C,L):(N=Ge(C),N.c(),N.m(n,r)):N&&(N.d(1),N=null)},i:E,o:E,d(C){C&&(h(e),h(t),h(l)),N&&N.d(),s[7](null),b=!1,T()}}}function Pt(s,e,t){let l,n;Ee(s,Te,_=>t(6,n=_));let{object:r}=e,{owner:a}=e,{remove:o}=e;je(async()=>{});function i(_){console.log("HANDLE MENU ACTIVATED"),d.open?d.close():d.show()}function f(_){console.log("HANDLE DELETE ACTIVATED");const k=_.target.dataset.object;l?.send_delete(k).then(b=>{b&&(console.info("DELETE SENT"),o(k))})}let d;function u(_){De[_?"unshift":"push"](()=>{d=_,t(2,d)})}return s.$$set=_=>{"object"in _&&t(0,r=_.object),"owner"in _&&t(1,a=_.owner),"remove"in _&&t(5,o=_.remove)},s.$$.update=()=>{s.$$.dirty&64&&(l=n)},[r,a,d,i,f,o,n,u]}class mt extends be{constructor(e){super(),ke(this,e,Pt,yt,pe,{object:0,owner:1,remove:5})}}function We(s,e,t){const l=s.slice();return l[17]=e[t],l}function Fe(s){let e,t;return{c(){e=v("img"),this.h()},l(l){e=g(l,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){te(e.src,t=ne(s[3],s[0].actor.icon.url))||c(e,"src",t),c(e,"alt","Sender"),c(e,"class","svelte-56f1sk")},m(l,n){I(l,e,n)},p(l,n){n&9&&!te(e.src,t=ne(l[3],l[0].actor.icon.url))&&c(e,"src",t)},d(l){l&&h(e)}}}function Be(s){let e,t,l=se(s[3],s[0].actor.name||s[0].actor.preferredUsername,s[0].actor)+"",n,r,a=we(s[0].actor)+"",o,i;return{c(){e=v("a"),t=new ve(!1),n=Z(` •
					`),r=v("span"),o=Z(a),this.h()},l(f){e=g(f,"A",{href:!0,class:!0});var d=w(e);t=ge(d,!1),n=$(d,` •
					`),r=g(d,"SPAN",{class:!0});var u=w(r);o=$(u,a),u.forEach(h),d.forEach(h),this.h()},h(){t.a=n,c(r,"class","url svelte-56f1sk"),c(e,"href",i="/"+we(s[0].actor)),c(e,"class","svelte-56f1sk")},m(f,d){I(f,e,d),t.m(l,e),p(e,n),p(e,r),p(r,o)},p(f,d){d&9&&l!==(l=se(f[3],f[0].actor.name||f[0].actor.preferredUsername,f[0].actor)+"")&&t.p(l),d&1&&a!==(a=we(f[0].actor)+"")&&le(o,a),d&1&&i!==(i="/"+we(f[0].actor))&&c(e,"href",i)},d(f){f&&h(e)}}}function Je(s){let e,t;return e=new dt({props:{note:s[0].note}}),{c(){ce(e.$$.fragment)},l(l){fe(e.$$.fragment,l)},m(l,n){ue(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.note=l[0].note),e.$set(r)},i(l){t||(G(e.$$.fragment,l),t=!0)},o(l){B(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function Ke(s){let e,t,l,n=Ie(s[0])+"",r,a,o;return{c(){e=v("span"),t=v("i"),l=U(),r=Z(n),this.h()},l(i){e=g(i,"SPAN",{class:!0,"data-conversation":!0,"data-note":!0});var f=w(e);t=g(f,"I",{class:!0}),w(t).forEach(h),l=H(f),r=$(f,n),f.forEach(h),this.h()},h(){c(t,"class","fa-solid fa-comments svelte-56f1sk"),c(e,"class","comments svelte-56f1sk"),c(e,"data-conversation",a=s[0].note.conversation),c(e,"data-note",o=s[0].note.id)},m(i,f){I(i,e,f),p(e,t),p(e,l),p(e,r)},p(i,f){f&1&&n!==(n=Ie(i[0])+"")&&le(r,n),f&1&&a!==(a=i[0].note.conversation)&&c(e,"data-conversation",a),f&1&&o!==(o=i[0].note.id)&&c(e,"data-note",o)},d(i){i&&h(e)}}}function Qe(s){let e,t,l,n,r;function a(b,T){return b[0].note.ephemeral?.announced?Ht:Ut}let o=a(s),i=o(s);function f(b,T){return b[0].note.ephemeral?.liked?Ot:Vt}let d=f(s),u=d(s),_=s[0].actor&&Ye(s),k=s[0].note.id&&Xe(s);return{c(){e=v("nav"),i.c(),t=U(),u.c(),l=U(),_&&_.c(),n=U(),k&&k.c(),this.h()},l(b){e=g(b,"NAV",{class:!0});var T=w(e);i.l(T),t=H(T),u.l(T),l=H(T),_&&_.l(T),n=H(T),k&&k.l(T),T.forEach(h),this.h()},h(){c(e,"class","svelte-56f1sk")},m(b,T){I(b,e,T),i.m(e,null),p(e,t),u.m(e,null),p(e,l),_&&_.m(e,null),p(e,n),k&&k.m(e,null),r=!0},p(b,T){o===(o=a(b))&&i?i.p(b,T):(i.d(1),i=o(b),i&&(i.c(),i.m(e,t))),d===(d=f(b))&&u?u.p(b,T):(u.d(1),u=d(b),u&&(u.c(),u.m(e,l))),b[0].actor?_?_.p(b,T):(_=Ye(b),_.c(),_.m(e,n)):_&&(_.d(1),_=null),b[0].note.id?k?(k.p(b,T),T&1&&G(k,1)):(k=Xe(b),k.c(),G(k,1),k.m(e,null)):k&&(ie(),B(k,1,1,()=>{k=null}),oe())},i(b){r||(G(k),r=!0)},o(b){B(k),r=!1},d(b){b&&h(e),i.d(),u.d(),_&&_.d(),k&&k.d()}}}function Ut(s){let e,t,l;return{c(){e=v("i"),this.h()},l(n){e=g(n,"I",{class:!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-repeat svelte-56f1sk")},m(n,r){I(n,e,r),t||(l=Y(e,"click",ae(s[11])),t=!0)},p:E,d(n){n&&h(e),t=!1,l()}}}function Ht(s){let e,t,l;return{c(){e=v("i"),this.h()},l(n){e=g(n,"I",{class:!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-repeat selected svelte-56f1sk")},m(n,r){I(n,e,r),t||(l=Y(e,"click",ae(s[10])),t=!0)},p:E,d(n){n&&h(e),t=!1,l()}}}function Vt(s){let e,t,l;return{c(){e=v("i"),this.h()},l(n){e=g(n,"I",{class:!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-star svelte-56f1sk")},m(n,r){I(n,e,r),t||(l=Y(e,"click",ae(s[13])),t=!0)},p:E,d(n){n&&h(e),t=!1,l()}}}function Ot(s){let e,t,l;return{c(){e=v("i"),this.h()},l(n){e=g(n,"I",{class:!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-star selected svelte-56f1sk")},m(n,r){I(n,e,r),t||(l=Y(e,"click",ae(s[12])),t=!0)},p:E,d(n){n&&h(e),t=!1,l()}}}function Ye(s){let e,t,l;return{c(){e=v("i"),this.h()},l(n){e=g(n,"I",{class:!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-reply svelte-56f1sk")},m(n,r){I(n,e,r),t||(l=Y(e,"click",s[14]),t=!0)},p:E,d(n){n&&h(e),t=!1,l()}}}function Xe(s){let e,t,l,n={ctx:s,current:null,token:null,hasCatch:!1,pending:qt,then:Rt,catch:zt,value:20,blocks:[,,,]};return _e(t=s[3]?.get_ap_id(),n),{c(){e=x(),n.block.c()},l(r){e=x(),n.block.l(r)},m(r,a){I(r,e,a),n.block.m(r,n.anchor=a),n.mount=()=>e.parentNode,n.anchor=e,l=!0},p(r,a){s=r,n.ctx=s,a&8&&t!==(t=s[3]?.get_ap_id())&&_e(t,n)||Ce(n,s,a)},i(r){l||(G(n.block),l=!0)},o(r){for(let a=0;a<3;a+=1){const o=n.blocks[a];B(o)}l=!1},d(r){r&&h(e),n.block.d(r),n.token=null,n=null}}}function zt(s){return{c:E,l:E,m:E,p:E,i:E,o:E,d:E}}function Rt(s){let e,t;return e=new mt({props:{remove:s[2],object:s[0].note.id,owner:s[20]==s[0].note.attributedTo}}),{c(){ce(e.$$.fragment)},l(l){fe(e.$$.fragment,l)},m(l,n){ue(e,l,n),t=!0},p(l,n){const r={};n&4&&(r.remove=l[2]),n&1&&(r.object=l[0].note.id),n&9&&(r.owner=l[20]==l[0].note.attributedTo),e.$set(r)},i(l){t||(G(e.$$.fragment,l),t=!0)},o(l){B(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function qt(s){return{c:E,l:E,m:E,p:E,i:E,o:E,d:E}}function Ze(s){let e,t,l=Ne(Array.from(s[0].replies.values()).sort(Oe).reverse()),n=[];for(let a=0;a<l.length;a+=1)n[a]=$e(We(s,l,a));const r=a=>B(n[a],1,1,()=>{n[a]=null});return{c(){e=v("div");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=g(a,"DIV",{class:!0});var o=w(e);for(let i=0;i<n.length;i+=1)n[i].l(o);o.forEach(h),this.h()},h(){c(e,"class","replies svelte-56f1sk")},m(a,o){I(a,e,o);for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(e,null);t=!0},p(a,o){if(o&3){l=Ne(Array.from(a[0].replies.values()).sort(Oe).reverse());let i;for(i=0;i<l.length;i+=1){const f=We(a,l,i);n[i]?(n[i].p(f,o),G(n[i],1)):(n[i]=$e(f),n[i].c(),G(n[i],1),n[i].m(e,null))}for(ie(),i=l.length;i<n.length;i+=1)r(i);oe()}},i(a){if(!t){for(let o=0;o<l.length;o+=1)G(n[o]);t=!0}},o(a){n=n.filter(Boolean);for(let o=0;o<n.length;o+=1)B(n[o]);t=!1},d(a){a&&h(e),ut(n,a)}}}function $e(s){let e,t;return e=new Ft({props:{note:s[17],username:s[1]}}),e.$on("replyTo",s[15]),{c(){ce(e.$$.fragment)},l(l){fe(e.$$.fragment,l)},m(l,n){ue(e,l,n),t=!0},p(l,n){const r={};n&1&&(r.note=l[17]),n&2&&(r.username=l[1]),e.$set(r)},i(l){t||(G(e.$$.fragment,l),t=!0)},o(l){B(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function Gt(s){let e,t,l,n,r,a,o,i,f,d=se(s[3],s[4]||"",s[0].note)+"",u,_,k,b,T,N,C,L=s[0].actor&&s[0].actor.icon&&Fe(s),O=s[0].actor&&Be(s),m=s[0].note.attachment&&s[0].note.attachment.length>0&&Je(s),P=s[0].replies?.size&&Ke(s);b=new _t({props:{timestamp:new Date(s[0].published)}});let R=s[1]&&Qe(s),y=s[0].replies?.size&&Ze(s);return{c(){e=v("div"),t=v("article"),l=v("div"),n=v("div"),L&&L.c(),r=U(),a=v("address"),O&&O.c(),o=U(),i=v("section"),f=new ve(!1),u=U(),m&&m.c(),_=U(),P&&P.c(),k=U(),ce(b.$$.fragment),T=U(),R&&R.c(),N=U(),y&&y.c(),this.h()},l(j){e=g(j,"DIV",{class:!0});var q=w(e);t=g(q,"ARTICLE",{class:!0});var M=w(t);l=g(M,"DIV",{class:!0});var K=w(l);n=g(K,"DIV",{});var W=w(n);L&&L.l(W),W.forEach(h),K.forEach(h),r=H(M),a=g(M,"ADDRESS",{class:!0});var A=w(a);O&&O.l(A),A.forEach(h),o=H(M),i=g(M,"SECTION",{class:!0});var F=w(i);f=ge(F,!1),F.forEach(h),u=H(M),m&&m.l(M),_=H(M),P&&P.l(M),k=H(M),fe(b.$$.fragment,M),T=H(M),R&&R.l(M),M.forEach(h),N=H(q),y&&y.l(q),q.forEach(h),this.h()},h(){c(l,"class","avatar svelte-56f1sk"),c(a,"class","svelte-56f1sk"),f.a=null,c(i,"class","svelte-56f1sk"),c(t,"class","svelte-56f1sk"),c(e,"class","container svelte-56f1sk")},m(j,q){I(j,e,q),p(e,t),p(t,l),p(l,n),L&&L.m(n,null),p(t,r),p(t,a),O&&O.m(a,null),p(t,o),p(t,i),f.m(d,i),p(t,u),m&&m.m(t,null),p(t,_),P&&P.m(t,null),p(t,k),ue(b,t,null),p(t,T),R&&R.m(t,null),p(e,N),y&&y.m(e,null),C=!0},p(j,[q]){j[0].actor&&j[0].actor.icon?L?L.p(j,q):(L=Fe(j),L.c(),L.m(n,null)):L&&(L.d(1),L=null),j[0].actor?O?O.p(j,q):(O=Be(j),O.c(),O.m(a,null)):O&&(O.d(1),O=null),(!C||q&25)&&d!==(d=se(j[3],j[4]||"",j[0].note)+"")&&f.p(d),j[0].note.attachment&&j[0].note.attachment.length>0?m?(m.p(j,q),q&1&&G(m,1)):(m=Je(j),m.c(),G(m,1),m.m(t,_)):m&&(ie(),B(m,1,1,()=>{m=null}),oe()),j[0].replies?.size?P?P.p(j,q):(P=Ke(j),P.c(),P.m(t,k)):P&&(P.d(1),P=null);const M={};q&1&&(M.timestamp=new Date(j[0].published)),b.$set(M),j[1]?R?(R.p(j,q),q&2&&G(R,1)):(R=Qe(j),R.c(),G(R,1),R.m(t,null)):R&&(ie(),B(R,1,1,()=>{R=null}),oe()),j[0].replies?.size?y?(y.p(j,q),q&1&&G(y,1)):(y=Ze(j),y.c(),G(y,1),y.m(e,null)):y&&(ie(),B(y,1,1,()=>{y=null}),oe())},i(j){C||(G(m),G(b.$$.fragment,j),G(R),G(y),C=!0)},o(j){B(m),B(b.$$.fragment,j),B(R),B(y),C=!1},d(j){j&&h(e),L&&L.d(),O&&O.d(),m&&m.d(),P&&P.d(),he(b),R&&R.d(),y&&y.d()}}}function Wt(s,e,t){let l,n;Ee(s,Te,m=>t(9,n=m));const r=Le();let{note:a}=e,{username:o}=e,{remove:i}=e,f;function d(m){if(console.debug("Handling Announce"),m.note.id){const P=m.note.id;P?l?.send_announce(P).then(R=>{console.debug("Announce sent");let y=m.note.ephemeral||{};y.announced=R,m.note.ephemeral=y,t(0,a=m)}):console.error(`Object invalid: ${P}`)}}function u(m){if(console.debug("Handling Like"),m.note.id&&m.note.attributedTo){const P=m.note.attributedTo,R=m.note.id;l?.send_like(P,R).then(y=>{console.debug("Like sent");let j=m.note.ephemeral||{};j.liked=y,m.note.ephemeral=j,t(0,a=m)})}}function _(m){if(console.debug("Handling Unike"),m.note.id&&m.note.attributedTo){const P=m.note.attributedTo,R=m.note.id;m.note.ephemeral&&m.note.ephemeral.liked&&l?.send_unlike(P,R,m.note.ephemeral.liked).then(y=>{console.debug("Unlike sent");let j=m.note.ephemeral||{};j.liked=null,m.note.ephemeral=j,t(0,a=m)})}}function k(m){r("replyTo",{replyToNote:m,replyToActor:m.actor,openAside:!0})}const b=()=>d(a),T=()=>d(a),N=()=>_(a),C=()=>u(a),L=()=>k(a);function O(m){kt.call(this,s,m)}return s.$$set=m=>{"note"in m&&t(0,a=m.note),"username"in m&&t(1,o=m.username),"remove"in m&&t(2,i=m.remove)},s.$$.update=()=>{s.$$.dirty&512&&t(3,l=n),s.$$.dirty&9&&t(4,f=(a.note.type=="Note"?a.note.content:Me(l,a.activity))||"")},[a,o,i,l,f,d,u,_,k,n,b,T,N,C,L,O]}class Ft extends be{constructor(e){super(),ke(this,e,Wt,Gt,pe,{note:0,username:1,remove:2})}}function xe(s){let e,t,l;return{c(){e=v("span"),t=v("span"),l=Z(s[1]),this.h()},l(n){e=g(n,"SPAN",{class:!0});var r=w(e);t=g(r,"SPAN",{class:!0});var a=w(t);l=$(a,s[1]),a.forEach(h),r.forEach(h),this.h()},h(){c(t,"class","server-name svelte-1g6n0s2"),c(e,"class","server svelte-1g6n0s2")},m(n,r){I(n,e,r),p(e,t),p(t,l)},p(n,r){r&2&&le(l,n[1])},d(n){n&&h(e)}}}function Bt(s){let e,t,l,n,r,a=s[1]&&xe(s);return{c(){e=v("div"),t=v("span"),l=Z("@"),n=Z(s[0]),r=U(),a&&a.c(),this.h()},l(o){e=g(o,"DIV",{class:!0});var i=w(e);t=g(i,"SPAN",{class:!0});var f=w(t);l=$(f,"@"),n=$(f,s[0]),f.forEach(h),r=H(i),a&&a.l(i),i.forEach(h),this.h()},h(){c(t,"class","username svelte-1g6n0s2"),c(e,"class","fedi-handle svelte-1g6n0s2")},m(o,i){I(o,e,i),p(e,t),p(t,l),p(t,n),p(e,r),a&&a.m(e,null)},p(o,[i]){i&1&&le(n,o[0]),o[1]?a?a.p(o,i):(a=xe(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:E,o:E,d(o){o&&h(e),a&&a.d()}}}function Jt(s){const t=(s.startsWith("@")?s.slice(1):s).split("@");return t.length===2?{username:t[0],server:t[1]}:null}function Kt(s,e,t){let{handle:l}=e,n="",r="";function a(o){const i=Jt(o);i?(t(0,n=i.username),t(1,r=i.server)):(console.error("Invalid Fediverse handle format"),t(0,n=""),t(1,r=""))}return je(()=>{a(l)}),s.$$set=o=>{"handle"in o&&t(2,l=o.handle)},[n,r,l]}class Qt extends be{constructor(e){super(),ke(this,e,Kt,Bt,pe,{handle:2})}}function et(s){let e,t,l,n,r,a=s[0][X].ogTitle+"",o,i,f,d,u=s[0][X].ogImage?.length&&tt(s),_=s[0][X].ogDescription&&lt(s),k=s[0][X].ogSiteName&&nt(s);return{c(){e=v("a"),t=v("div"),u&&u.c(),l=U(),n=v("div"),r=v("span"),o=Z(a),i=U(),_&&_.c(),f=U(),k&&k.c(),this.h()},l(b){e=g(b,"A",{href:!0,target:!0,rel:!0,class:!0});var T=w(e);t=g(T,"DIV",{class:!0});var N=w(t);u&&u.l(N),l=H(N),n=g(N,"DIV",{class:!0});var C=w(n);r=g(C,"SPAN",{class:!0});var L=w(r);o=$(L,a),L.forEach(h),i=H(C),_&&_.l(C),f=H(C),k&&k.l(C),C.forEach(h),N.forEach(h),T.forEach(h),this.h()},h(){c(r,"class","svelte-1kwn4le"),c(n,"class","svelte-1kwn4le"),c(t,"class","svelte-1kwn4le"),c(e,"href",d=s[0][X].ogUrl),c(e,"target","_blank"),c(e,"rel","noreferrer"),c(e,"class","svelte-1kwn4le")},m(b,T){I(b,e,T),p(e,t),u&&u.m(t,null),p(t,l),p(t,n),p(n,r),p(r,o),p(n,i),_&&_.m(n,null),p(n,f),k&&k.m(n,null)},p(b,T){b[0][X].ogImage?.length?u?u.p(b,T):(u=tt(b),u.c(),u.m(t,l)):u&&(u.d(1),u=null),T&1&&a!==(a=b[0][X].ogTitle+"")&&le(o,a),b[0][X].ogDescription?_?_.p(b,T):(_=lt(b),_.c(),_.m(n,f)):_&&(_.d(1),_=null),b[0][X].ogSiteName?k?k.p(b,T):(k=nt(b),k.c(),k.m(n,null)):k&&(k.d(1),k=null),T&1&&d!==(d=b[0][X].ogUrl)&&c(e,"href",d)},d(b){b&&h(e),u&&u.d(),_&&_.d(),k&&k.d()}}}function tt(s){let e,t,l,n,r;return{c(){e=v("div"),t=v("img"),this.h()},l(a){e=g(a,"DIV",{class:!0});var o=w(e);t=g(o,"IMG",{src:!0,alt:!0,class:!0}),o.forEach(h),this.h()},h(){te(t.src,l=ne(s[1],String(s[0][X].ogImage)))||c(t,"src",l),c(t,"alt","Link Preview"),c(t,"class","svelte-1kwn4le"),c(e,"class","image svelte-1kwn4le")},m(a,o){I(a,e,o),p(e,t),n||(r=Y(t,"error",s[2]),n=!0)},p(a,o){o&3&&!te(t.src,l=ne(a[1],String(a[0][X].ogImage)))&&c(t,"src",l)},d(a){a&&h(e),n=!1,r()}}}function lt(s){let e,t=s[0][X].ogDescription+"",l;return{c(){e=v("span"),l=Z(t),this.h()},l(n){e=g(n,"SPAN",{class:!0});var r=w(e);l=$(r,t),r.forEach(h),this.h()},h(){c(e,"class","svelte-1kwn4le")},m(n,r){I(n,e,r),p(e,l)},p(n,r){r&1&&t!==(t=n[0][X].ogDescription+"")&&le(l,t)},d(n){n&&h(e)}}}function nt(s){let e,t=s[0][X].ogSiteName+"",l;return{c(){e=v("span"),l=Z(t),this.h()},l(n){e=g(n,"SPAN",{class:!0});var r=w(e);l=$(r,t),r.forEach(h),this.h()},h(){c(e,"class","svelte-1kwn4le")},m(n,r){I(n,e,r),p(e,l)},p(n,r){r&1&&t!==(t=n[0][X].ogSiteName+"")&&le(l,t)},d(n){n&&h(e)}}}function Yt(s){let e,t=s[0][X].ogUrl&&s[0][X].ogTitle&&et(s);return{c(){t&&t.c(),e=x()},l(l){t&&t.l(l),e=x()},m(l,n){t&&t.m(l,n),I(l,e,n)},p(l,[n]){l[0][X].ogUrl&&l[0][X].ogTitle?t?t.p(l,n):(t=et(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:E,o:E,d(l){l&&h(e),t&&t.d(l)}}}let X=0;function Xt(s,e,t){let l,n;Ee(s,Te,o=>t(3,n=o));let{links:r}=e;je(async()=>{});const a=o=>{console.log(o.target);let i=o.target;i&&(i.style.display="none")};return s.$$set=o=>{"links"in o&&t(0,r=o.links)},s.$$.update=()=>{s.$$.dirty&8&&t(1,l=n)},[r,l,a,n]}class Zt extends be{constructor(e){super(),ke(this,e,Xt,Yt,pe,{links:0})}}new TextEncoder;function st(s){let e,t,l,n,r={ctx:s,current:null,token:null,hasCatch:!1,pending:el,then:xt,catch:$t,value:32};_e(e=s[8](s[0].note),r);let a={ctx:s,current:null,token:null,hasCatch:!1,pending:nl,then:ll,catch:tl,value:32};return _e(n=s[9](s[0].note),a),{c(){r.block.c(),t=U(),l=x(),a.block.c()},l(o){r.block.l(o),t=H(o),l=x(),a.block.l(o)},m(o,i){r.block.m(o,r.anchor=i),r.mount=()=>t.parentNode,r.anchor=t,I(o,t,i),I(o,l,i),a.block.m(o,a.anchor=i),a.mount=()=>l.parentNode,a.anchor=l},p(o,i){s=o,r.ctx=s,i[0]&1&&e!==(e=s[8](s[0].note))&&_e(e,r)||Ce(r,s,i),a.ctx=s,i[0]&1&&n!==(n=s[9](s[0].note))&&_e(n,a)||Ce(a,s,i)},d(o){o&&(h(t),h(l)),r.block.d(o),r.token=null,r=null,a.block.d(o),a.token=null,a=null}}}function $t(s){return{c:E,l:E,m:E,p:E,d:E}}function xt(s){let e,t=s[32]&&at(s);return{c(){t&&t.c(),e=x()},l(l){t&&t.l(l),e=x()},m(l,n){t&&t.m(l,n),I(l,e,n)},p(l,n){l[32]?t?t.p(l,n):(t=at(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&h(e),t&&t.d(l)}}}function at(s){let e,t,l,n,r,a,o,i,f=s[32]+"";return{c(){e=v("span"),t=v("i"),l=Z(` In
					`),n=v("a"),r=Z("reply"),o=Z(`
					to `),i=new ve(!1),this.h()},l(d){e=g(d,"SPAN",{class:!0});var u=w(e);t=g(u,"I",{class:!0}),w(t).forEach(h),l=$(u,` In
					`),n=g(u,"A",{href:!0,target:!0,rel:!0,class:!0});var _=w(n);r=$(_,"reply"),_.forEach(h),o=$(u,`
					to `),i=ge(u,!1),u.forEach(h),this.h()},h(){c(t,"class","fa-solid fa-reply svelte-4w57jv"),c(n,"href",a=s[0].note.inReplyTo),c(n,"target","_blank"),c(n,"rel","noreferrer"),c(n,"class","svelte-4w57jv"),i.a=null,c(e,"class","reply svelte-4w57jv")},m(d,u){I(d,e,u),p(e,t),p(e,l),p(e,n),p(n,r),p(e,o),i.m(f,e)},p(d,u){u[0]&1&&a!==(a=d[0].note.inReplyTo)&&c(n,"href",a),u[0]&1&&f!==(f=d[32]+"")&&i.p(f)},d(d){d&&h(e)}}}function el(s){return{c:E,l:E,m:E,p:E,d:E}}function tl(s){return{c:E,l:E,m:E,p:E,d:E}}function ll(s){let e,t=s[32]&&rt(s);return{c(){t&&t.c(),e=x()},l(l){t&&t.l(l),e=x()},m(l,n){t&&t.m(l,n),I(l,e,n)},p(l,n){l[32]?t?t.p(l,n):(t=rt(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&h(e),t&&t.d(l)}}}function rt(s){let e,t,l,n,r,a=s[32].name+"",o,i=s[32].others+"",f;return{c(){e=v("span"),t=v("i"),l=Z(` Reposted by
					`),n=v("a"),r=new ve(!1),f=Z(i),this.h()},l(d){e=g(d,"SPAN",{class:!0});var u=w(e);t=g(u,"I",{class:!0}),w(t).forEach(h),l=$(u,` Reposted by
					`),n=g(u,"A",{href:!0,class:!0});var _=w(n);r=ge(_,!1),_.forEach(h),f=$(u,i),u.forEach(h),this.h()},h(){c(t,"class","fa-solid fa-retweet svelte-4w57jv"),r.a=null,c(n,"href",o=s[32].url),c(n,"class","svelte-4w57jv"),c(e,"class","repost svelte-4w57jv")},m(d,u){I(d,e,u),p(e,t),p(e,l),p(e,n),r.m(a,n),p(e,f)},p(d,u){u[0]&1&&a!==(a=d[32].name+"")&&r.p(a),u[0]&1&&o!==(o=d[32].url)&&c(n,"href",o),u[0]&1&&i!==(i=d[32].others+"")&&le(f,i)},d(d){d&&h(e)}}}function nl(s){return{c:E,l:E,m:E,p:E,d:E}}function sl(s){let e,t,l,n;return{c(){e=v("img"),this.h()},l(r){e=g(r,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){te(e.src,t=ne(s[7],s[10]))||c(e,"src",t),c(e,"alt","Sender"),c(e,"class","svelte-4w57jv")},m(r,a){I(r,e,a),l||(n=Y(e,"error",s[23]),l=!0)},p(r,a){a[0]&128&&!te(e.src,t=ne(r[7],r[10]))&&c(e,"src",t)},d(r){r&&h(e),l=!1,n()}}}function al(s){let e,t,l=se(s[7],s[11],s[12])+"",n,r,a,o;return a=new Qt({props:{handle:we(s[12])}}),{c(){e=v("span"),t=new ve(!1),n=U(),r=v("a"),ce(a.$$.fragment),this.h()},l(i){e=g(i,"SPAN",{class:!0});var f=w(e);t=ge(f,!1),f.forEach(h),n=H(i),r=g(i,"A",{href:!0,class:!0});var d=w(r);fe(a.$$.fragment,d),d.forEach(h),this.h()},h(){t.a=null,c(e,"class","svelte-4w57jv"),c(r,"href","/"+we(s[12])),c(r,"class","svelte-4w57jv")},m(i,f){I(i,e,f),t.m(l,e),I(i,n,f),I(i,r,f),ue(a,r,null),o=!0},p(i,f){(!o||f[0]&128)&&l!==(l=se(i[7],i[11],i[12])+"")&&t.p(l)},i(i){o||(G(a.$$.fragment,i),o=!0)},o(i){B(a.$$.fragment,i),o=!1},d(i){i&&(h(e),h(n),h(r)),he(a)}}}function rl(s){let e,t,l=se(s[7],s[0].note.content,s[0].note)+"";return{c(){e=v("section"),t=new ve(!1),this.h()},l(n){e=g(n,"SECTION",{class:!0});var r=w(e);t=ge(r,!1),r.forEach(h),this.h()},h(){t.a=null,c(e,"class","svelte-4w57jv")},m(n,r){I(n,e,r),t.m(l,e)},p(n,r){r[0]&129&&l!==(l=se(n[7],n[0].note.content,n[0].note)+"")&&t.p(l)},d(n){n&&h(e)}}}function il(s){let e,t,l=se(s[7],Me(s[7],s[0].activity),s[0].note)+"";return{c(){e=v("section"),t=new ve(!1),this.h()},l(n){e=g(n,"SECTION",{class:!0});var r=w(e);t=ge(r,!1),r.forEach(h),this.h()},h(){t.a=null,c(e,"class","svelte-4w57jv")},m(n,r){I(n,e,r),t.m(l,e)},p(n,r){r[0]&129&&l!==(l=se(n[7],Me(n[7],n[0].activity),n[0].note)+"")&&t.p(l)},d(n){n&&h(e)}}}function ol(s){let e,t;return e=new Zt({props:{links:s[0].note.ephemeral?.metadata}}),{c(){ce(e.$$.fragment)},l(l){fe(e.$$.fragment,l)},m(l,n){ue(e,l,n),t=!0},p(l,n){const r={};n[0]&1&&(r.links=l[0].note.ephemeral?.metadata),e.$set(r)},i(l){t||(G(e.$$.fragment,l),t=!0)},o(l){B(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function cl(s){let e,t;return e=new dt({props:{note:s[0].note}}),{c(){ce(e.$$.fragment)},l(l){fe(e.$$.fragment,l)},m(l,n){ue(e,l,n),t=!0},p(l,n){const r={};n[0]&1&&(r.note=l[0].note),e.$set(r)},i(l){t||(G(e.$$.fragment,l),t=!0)},o(l){B(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function fl(s){let e,t='<i class="fa-solid fa-at svelte-4w57jv"></i>';return{c(){e=v("span"),e.innerHTML=t,this.h()},l(l){e=g(l,"SPAN",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-3zcmeb"&&(e.innerHTML=t),this.h()},h(){c(e,"class","svelte-4w57jv")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function ul(s){let e,t='<i class="fa-solid fa-lock svelte-4w57jv"></i>';return{c(){e=v("span"),e.innerHTML=t,this.h()},l(l){e=g(l,"SPAN",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-3h2sdp"&&(e.innerHTML=t),this.h()},h(){c(e,"class","svelte-4w57jv")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function hl(s){let e,t='<i class="fa-solid fa-globe svelte-4w57jv"></i>';return{c(){e=v("span"),e.innerHTML=t,this.h()},l(l){e=g(l,"SPAN",{class:!0,"data-svelte-h":!0}),me(e)!=="svelte-1oshps7"&&(e.innerHTML=t),this.h()},h(){c(e,"class","svelte-4w57jv")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function it(s){let e,t,l,n,r,a,o,i=(s[0].note.ephemeral?.announces?.length||"")+"",f,d,u,_,k=(s[0].note.ephemeral?.likes?.length||"")+"",b,T,N,C,L,O,m=s[0].replies?.size&&ot(s);function P(A,F){return A[0].note.ephemeral?.announced?_l:dl}let R=P(s),y=R(s);function j(A,F){return A[0].note.ephemeral?.liked?pl:ml}let q=j(s),M=q(s),K=s[0].actor&&ct(s),W=s[0].note.id&&ft(s);return{c(){e=v("nav"),t=v("span"),l=v("i"),n=U(),m&&m.c(),r=U(),a=v("span"),y.c(),o=U(),f=Z(i),d=U(),u=v("span"),M.c(),_=U(),b=Z(k),T=U(),K&&K.c(),N=U(),W&&W.c(),this.h()},l(A){e=g(A,"NAV",{class:!0});var F=w(e);t=g(F,"SPAN",{class:!0});var ee=w(t);l=g(ee,"I",{class:!0}),w(l).forEach(h),n=H(ee),m&&m.l(ee),ee.forEach(h),r=H(F),a=g(F,"SPAN",{class:!0});var re=w(a);y.l(re),o=H(re),f=$(re,i),re.forEach(h),d=H(F),u=g(F,"SPAN",{class:!0});var D=w(u);M.l(D),_=H(D),b=$(D,k),D.forEach(h),T=H(F),K&&K.l(F),N=H(F),W&&W.l(F),F.forEach(h),this.h()},h(){c(l,"class","fa-solid fa-comments svelte-4w57jv"),c(t,"class","comments svelte-4w57jv"),c(a,"class","svelte-4w57jv"),c(u,"class","svelte-4w57jv"),c(e,"class","svelte-4w57jv")},m(A,F){I(A,e,F),p(e,t),p(t,l),p(t,n),m&&m.m(t,null),p(e,r),p(e,a),y.m(a,null),p(a,o),p(a,f),p(e,d),p(e,u),M.m(u,null),p(u,_),p(u,b),p(e,T),K&&K.m(e,null),p(e,N),W&&W.m(e,null),C=!0,L||(O=Y(t,"click",ae(s[24])),L=!0)},p(A,F){A[0].replies?.size?m?m.p(A,F):(m=ot(A),m.c(),m.m(t,null)):m&&(m.d(1),m=null),R===(R=P(A))&&y?y.p(A,F):(y.d(1),y=R(A),y&&(y.c(),y.m(a,o))),(!C||F[0]&1)&&i!==(i=(A[0].note.ephemeral?.announces?.length||"")+"")&&le(f,i),q===(q=j(A))&&M?M.p(A,F):(M.d(1),M=q(A),M&&(M.c(),M.m(u,_))),(!C||F[0]&1)&&k!==(k=(A[0].note.ephemeral?.likes?.length||"")+"")&&le(b,k),A[0].actor?K?K.p(A,F):(K=ct(A),K.c(),K.m(e,N)):K&&(K.d(1),K=null),A[0].note.id?W?(W.p(A,F),F[0]&1&&G(W,1)):(W=ft(A),W.c(),G(W,1),W.m(e,null)):W&&(ie(),B(W,1,1,()=>{W=null}),oe())},i(A){C||(G(W),C=!0)},o(A){B(W),C=!1},d(A){A&&h(e),m&&m.d(),y.d(),M.d(),K&&K.d(),W&&W.d(),L=!1,O()}}}function ot(s){let e=Ie(s[0])+"",t;return{c(){t=Z(e)},l(l){t=$(l,e)},m(l,n){I(l,t,n)},p(l,n){n[0]&1&&e!==(e=Ie(l[0])+"")&&le(t,e)},d(l){l&&h(t)}}}function dl(s){let e,t,l,n;return{c(){e=v("i"),this.h()},l(r){e=g(r,"I",{class:!0,"data-object":!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-repeat svelte-4w57jv"),c(e,"data-object",t=s[0].note.id)},m(r,a){I(r,e,a),l||(n=Y(e,"click",ae(s[17])),l=!0)},p(r,a){a[0]&1&&t!==(t=r[0].note.id)&&c(e,"data-object",t)},d(r){r&&h(e),l=!1,n()}}}function _l(s){let e,t,l,n,r;return{c(){e=v("i"),this.h()},l(a){e=g(a,"I",{class:!0,"data-object":!0,"data-activity":!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-repeat selected svelte-4w57jv"),c(e,"data-object",t=s[0].note.id),c(e,"data-activity",l=s[0].note.ephemeral?.announced)},m(a,o){I(a,e,o),n||(r=Y(e,"click",ae(s[16])),n=!0)},p(a,o){o[0]&1&&t!==(t=a[0].note.id)&&c(e,"data-object",t),o[0]&1&&l!==(l=a[0].note.ephemeral?.announced)&&c(e,"data-activity",l)},d(a){a&&h(e),n=!1,r()}}}function ml(s){let e,t,l,n,r;return{c(){e=v("i"),this.h()},l(a){e=g(a,"I",{class:!0,"data-actor":!0,"data-object":!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-star svelte-4w57jv"),c(e,"data-actor",t=s[0].note.attributedTo),c(e,"data-object",l=s[0].note.id)},m(a,o){I(a,e,o),n||(r=Y(e,"click",ae(s[15])),n=!0)},p(a,o){o[0]&1&&t!==(t=a[0].note.attributedTo)&&c(e,"data-actor",t),o[0]&1&&l!==(l=a[0].note.id)&&c(e,"data-object",l)},d(a){a&&h(e),n=!1,r()}}}function pl(s){let e,t,l,n,r,a;return{c(){e=v("i"),this.h()},l(o){e=g(o,"I",{class:!0,"data-actor":!0,"data-object":!0,"data-activity":!0}),w(e).forEach(h),this.h()},h(){c(e,"class","fa-solid fa-star selected svelte-4w57jv"),c(e,"data-actor",t=s[0].note.attributedTo),c(e,"data-object",l=s[0].note.id),c(e,"data-activity",n=s[0].note.ephemeral?.liked)},m(o,i){I(o,e,i),r||(a=Y(e,"click",ae(s[14])),r=!0)},p(o,i){i[0]&1&&t!==(t=o[0].note.attributedTo)&&c(e,"data-actor",t),i[0]&1&&l!==(l=o[0].note.id)&&c(e,"data-object",l),i[0]&1&&n!==(n=o[0].note.ephemeral?.liked)&&c(e,"data-activity",n)},d(o){o&&h(e),r=!1,a()}}}function ct(s){let e,t,l,n;return{c(){e=v("span"),t=v("i"),this.h()},l(r){e=g(r,"SPAN",{class:!0});var a=w(e);t=g(a,"I",{class:!0}),w(t).forEach(h),a.forEach(h),this.h()},h(){c(t,"class","fa-solid fa-reply svelte-4w57jv"),c(e,"class","svelte-4w57jv")},m(r,a){I(r,e,a),p(e,t),l||(n=Y(t,"click",s[25]),l=!0)},p:E,d(r){r&&h(e),l=!1,n()}}}function ft(s){let e,t,l,n={ctx:s,current:null,token:null,hasCatch:!1,pending:bl,then:gl,catch:vl,value:31,blocks:[,,,]};return _e(t=s[7]?.get_ap_id(),n),{c(){e=x(),n.block.c()},l(r){e=x(),n.block.l(r)},m(r,a){I(r,e,a),n.block.m(r,n.anchor=a),n.mount=()=>e.parentNode,n.anchor=e,l=!0},p(r,a){s=r,n.ctx=s,a[0]&128&&t!==(t=s[7]?.get_ap_id())&&_e(t,n)||Ce(n,s,a)},i(r){l||(G(n.block),l=!0)},o(r){for(let a=0;a<3;a+=1){const o=n.blocks[a];B(o)}l=!1},d(r){r&&h(e),n.block.d(r),n.token=null,n=null}}}function vl(s){return{c:E,l:E,m:E,p:E,i:E,o:E,d:E}}function gl(s){let e,t;return e=new mt({props:{remove:s[3],object:s[0].note.id,owner:s[31]==s[0].note.attributedTo}}),{c(){ce(e.$$.fragment)},l(l){fe(e.$$.fragment,l)},m(l,n){ue(e,l,n),t=!0},p(l,n){const r={};n[0]&8&&(r.remove=l[3]),n[0]&1&&(r.object=l[0].note.id),n[0]&129&&(r.owner=l[31]==l[0].note.attributedTo),e.$set(r)},i(l){t||(G(e.$$.fragment,l),t=!0)},o(l){B(e.$$.fragment,l),t=!1},d(l){he(e,l)}}}function bl(s){return{c:E,l:E,m:E,p:E,i:E,o:E,d:E}}function kl(s){let e,t,l,n,r,a,o,i,f,d,u,_,k,b,T,N,C,L,O,m,P,R,y,j=s[7]&&st(s),q=s[10]&&sl(s),M=s[11]&&s[12]&&al(s);function K(S,z){if(S[0].activity)return il;if(S[0].note&&S[0].note.content)return rl}let W=K(s),A=W&&W(s);const F=[cl,ol],ee=[];function re(S,z){return S[0].note.attachment&&S[0].note.attachment.length>0?0:S[0].note.ephemeral?.metadata&&S[0].note.ephemeral?.metadata.length?1:-1}~(f=re(s))&&(d=ee[f]=F[f](s));function D(S,z){return S[0].public?hl:S[0].note.type=="EncryptedNote"?ul:fl}let J=D(s),Q=J(s);N=new _t({props:{timestamp:s[13]}});let V=s[1]&&it(s);return{c(){e=v("article"),j&&j.c(),t=U(),l=v("header"),n=v("div"),q&&q.c(),r=U(),a=v("address"),M&&M.c(),o=U(),A&&A.c(),i=U(),d&&d.c(),u=U(),_=v("div"),Q.c(),k=U(),b=v("time"),T=v("a"),ce(N.$$.fragment),O=U(),V&&V.c(),this.h()},l(S){e=g(S,"ARTICLE",{"data-conversation":!0,id:!0,class:!0});var z=w(e);j&&j.l(z),t=H(z),l=g(z,"HEADER",{class:!0});var de=w(l);n=g(de,"DIV",{class:!0});var Pe=w(n);q&&q.l(Pe),Pe.forEach(h),r=H(de),a=g(de,"ADDRESS",{class:!0});var Ue=w(a);M&&M.l(Ue),Ue.forEach(h),de.forEach(h),o=H(z),A&&A.l(z),i=H(z),d&&d.l(z),u=H(z),_=g(z,"DIV",{class:!0});var Se=w(_);Q.l(Se),k=H(Se),b=g(Se,"TIME",{datetime:!0,class:!0});var He=w(b);T=g(He,"A",{href:!0,target:!0,rel:!0,class:!0});var Ve=w(T);fe(N.$$.fragment,Ve),Ve.forEach(h),He.forEach(h),Se.forEach(h),O=H(z),V&&V.l(z),z.forEach(h),this.h()},h(){c(n,"class","svelte-4w57jv"),c(a,"class","svelte-4w57jv"),c(l,"class","svelte-4w57jv"),c(T,"href",C=s[0].note.url),c(T,"target",s[4]),c(T,"rel",s[5]),c(T,"class","svelte-4w57jv"),c(b,"datetime",L=s[0].published),c(b,"class","svelte-4w57jv"),c(_,"class","visibility svelte-4w57jv"),c(e,"data-conversation",m=s[0].note.conversation),c(e,"id",s[6]),c(e,"class","svelte-4w57jv")},m(S,z){I(S,e,z),j&&j.m(e,null),p(e,t),p(e,l),p(l,n),q&&q.m(n,null),p(l,r),p(l,a),M&&M.m(a,null),p(e,o),A&&A.m(e,null),p(e,i),~f&&ee[f].m(e,null),p(e,u),p(e,_),Q.m(_,null),p(_,k),p(_,b),p(b,T),ue(N,T,null),p(e,O),V&&V.m(e,null),P=!0,R||(y=wt(s[2].call(null,e)),R=!0)},p(S,z){S[7]?j?j.p(S,z):(j=st(S),j.c(),j.m(e,t)):j&&(j.d(1),j=null),S[10]&&q.p(S,z),S[11]&&S[12]&&M.p(S,z),W===(W=K(S))&&A?A.p(S,z):(A&&A.d(1),A=W&&W(S),A&&(A.c(),A.m(e,i)));let de=f;f=re(S),f===de?~f&&ee[f].p(S,z):(d&&(ie(),B(ee[de],1,1,()=>{ee[de]=null}),oe()),~f?(d=ee[f],d?d.p(S,z):(d=ee[f]=F[f](S),d.c()),G(d,1),d.m(e,u)):d=null),J!==(J=D(S))&&(Q.d(1),Q=J(S),Q&&(Q.c(),Q.m(_,k))),(!P||z[0]&1&&C!==(C=S[0].note.url))&&c(T,"href",C),(!P||z[0]&16)&&c(T,"target",S[4]),(!P||z[0]&32)&&c(T,"rel",S[5]),(!P||z[0]&1&&L!==(L=S[0].published))&&c(b,"datetime",L),S[1]?V?(V.p(S,z),z[0]&2&&G(V,1)):(V=it(S),V.c(),G(V,1),V.m(e,null)):V&&(ie(),B(V,1,1,()=>{V=null}),oe()),(!P||z[0]&1&&m!==(m=S[0].note.conversation))&&c(e,"data-conversation",m),(!P||z[0]&64)&&c(e,"id",S[6])},i(S){P||(G(M),G(d),G(N.$$.fragment,S),G(V),P=!0)},o(S){B(M),B(d),B(N.$$.fragment,S),B(V),P=!1},d(S){S&&h(e),j&&j.d(),q&&q.d(),M&&M.d(),A&&A.d(),~f&&ee[f].d(),Q.d(),he(N),V&&V.d(),R=!1,y()}}}function wl(s,e,t){let l,n,r;Ee(s,jt,D=>t(26,n=D)),Ee(s,Te,D=>t(22,r=D));const a=Le(),o=Le();je(()=>{l&&i&&i.note&&i.note.id&&t(6,A=l.get_url_safe_base64(i.note.id))});let{note:i}=e,{username:f}=e,{renderAction:d}=e,{refresh:u}=e,{remove:_}=e,{cachedNote:k}=e;const b=async D=>{if(D.inReplyTo){const J=await k(D.inReplyTo);if(J){const V=JSON.parse(String(J)).ephemeral?.attributedTo?.at(0);return V&&l?se(l,V.name||V.preferredUsername,V):null}else return null}else return null},T=async D=>{if(D.ephemeral?.announces){const J=D.ephemeral.announces[0];let Q="";if(D.ephemeral.announces.length==2?Q=` and ${D.ephemeral.announces.length-1} other`:D.ephemeral.announces.length>2&&(Q=` and ${D.ephemeral.announces.length-1} others`),J&&l){const V=se(l,J.name||J.preferredUsername,J);return{url:J.url,name:V,others:Q}}else return null}else return null};let N=i.note.ephemeral?.attributedTo??[i.actor],C=N[0].icon?.url,L=N[0].name??N[0].preferredUsername;N[0].id;let O=N[0];const m=new Date(i.published||i.created_at),P=async D=>{const J=String(D.target.dataset.object),Q=String(D.target.dataset.actor),V=String(D.target.dataset.activity);console.debug(`UNDOING ${V}`),l&&l.send_unlike(Q,J,V).then(S=>{console.debug("UNLIKE SENT");let z=i.note.ephemeral||{};z.liked=null,t(0,i.note.ephemeral=z,i),t(0,i)})},R=D=>{const J=String(D.target.dataset.object),Q=String(D.target.dataset.actor);l&&l.send_like(Q,J).then(V=>{if(console.debug(V),V){let S=JSON.parse(V);console.debug(`Like sent: ${S.id}`);let z=i.note.ephemeral||{};z.liked=S.id,t(0,i.note.ephemeral=z,i),t(0,i)}})},y=D=>{const J=String(D.target.dataset.object),Q=String(D.target.dataset.activity);l&&J?l.send_unannounce(J,Q).then(V=>{console.debug(`Undo Announce sent: ${V}`);let S=i.note.ephemeral||{};S.announced=null,t(0,i.note.ephemeral=S,i),t(0,i)}):console.error("Object invalid")},j=D=>{const J=String(D.target.dataset.object);l&&J?l.send_announce(J).then(Q=>{if(console.debug(Q),Q){let V=JSON.parse(Q);console.debug(`Announce sent: ${V.id}`);let S=i.note.ephemeral||{};S.announced=V.id,t(0,i.note.ephemeral=S,i),t(0,i)}}):console.error("Object invalid")},q=(D,J)=>{console.log("DISPATCHING NOTE_SELECT"),o("noteSelect",{replyToNote:D,replyToActor:J,openAside:!1})},M=(D,J)=>{console.log("DISPATCHING REPLY_TO"),a("replyTo",{replyToNote:D,replyToActor:J,openAside:!0})};let K=null,W=null;i&&i.note&&i.note.url&&!Et(n.url.toString(),i.note.url)&&(K="_blank",W="noreferrer");let A="";const F=D=>console.log(D),ee=()=>q(i,i.actor),re=()=>M(i,i.actor);return s.$$set=D=>{"note"in D&&t(0,i=D.note),"username"in D&&t(1,f=D.username),"renderAction"in D&&t(2,d=D.renderAction),"refresh"in D&&t(20,u=D.refresh),"remove"in D&&t(3,_=D.remove),"cachedNote"in D&&t(21,k=D.cachedNote)},s.$$.update=()=>{s.$$.dirty[0]&4194304&&t(7,l=r)},[i,f,d,_,K,W,A,l,b,T,C,L,O,m,P,R,y,j,q,M,u,k,r,F,ee,re]}class Dl extends be{constructor(e){super(),ke(this,e,wl,kl,pe,{note:0,username:1,renderAction:2,refresh:20,remove:3,cachedNote:21},null,[-1,-1])}}export{Dl as A,Ft as R,_e as h,Ce as u};
