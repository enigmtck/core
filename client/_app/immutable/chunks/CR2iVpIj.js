class c{constructor(t,r,s,n){var u,i;this.note=r,this.activity=s,this.actor=t,r.published?this.published=String(r.published):(u=r.ephemeral)!=null&&u.timestamp?this.published=r.ephemeral.timestamp:this.published=new Date().toISOString(),(i=r.ephemeral)!=null&&i.timestamp?this.created_at=r.ephemeral.timestamp:this.created_at=new Date().toISOString(),this.replies=n||new Map,this.public=this.isPublic()}jsonTo(){let t=[];return this.note.to&&t.push(...o(this.note.to)),this.note.cc&&t.push(...o(this.note.cc)),JSON.stringify(t)}jsonSender(){return JSON.stringify(this.actor)}isPublic(){const t=["https://www.w3.org/ns/activitystreams#Public","as:Public","Public"];let r=[];return this.note.to&&r.push(...o(this.note.to)),this.note.cc&&r.push(...o(this.note.cc)),r.map(n=>typeof n=="string"?n:n&&typeof n=="object"?"href"in n&&n.href?String(n.href):"id"in n&&n.id?String(n.id):"url"in n&&n.url?String(n.url):String(n):String(n)).some(n=>t.includes(n))}}const f=e=>typeof e=="object"&&e!==null&&e.type==="Note",h=e=>typeof e=="object"&&e!==null&&e.type==="EncryptedNote",p=e=>typeof e=="object"&&e!==null&&e.type==="Article",m=e=>typeof e=="object"&&e!==null&&"type"in e&&e.type==="Question",b=e=>typeof e=="object"&&e!==null&&"chessState"in e;function d(e){if(!e)return null;if(Array.isArray(e)){const t=e[0];return typeof t=="string"?t:t&&typeof t=="object"&&"href"in t&&t.href||null}else{if(typeof e=="string")return e;if(typeof e=="object"&&"href"in e)return e.href||null}return null}function g(e){const t=["","k","M","B","T"];let r=0;for(;e>=1e3&&r<t.length-1;)e/=1e3,r++;return r===0?Math.floor(e).toString():e.toFixed(1)+t[r]}function y(e){if(typeof e=="string")return e;if(Array.isArray(e))return e[0]}const j=(e,t)=>{try{const r=new URL(e);let s=r.pathname.slice(1);const n=r.hostname;if(s=s.endsWith("/")?s.slice(0,-1):s,!s.startsWith("@"))return null;if(!t)return`${s}@${n}`}catch(r){return console.error("Error parsing URL:",r),null}};function A(e){return new Promise(t=>setTimeout(t,e))}function S(e){const t=/^https:\/\/([a-zA-Z0-9\-.]+?)\/[A-Za-z0-9/\-._]+$/;if(e.id){const r=e.id.match(t);if(r)return`@${e.preferredUsername}@${r[1]}`}return String(e.url)}function _(e,t,r){return e&&r.tag&&o(r.tag).forEach(n=>{n.type==="Emoji"&&n.icon&&t&&(t=t.replaceAll(n.name,`<img class="emoji" src="${l(e,n.icon.url)}"/>`))}),t}function x(e,t){return Date.parse(e.created_at)<Date.parse(t.created_at)?-1:Date.parse(e.created_at)>Date.parse(t.created_at)?1:0}function I(e){const t=new URL(e),r=t.searchParams.get("max"),s=t.searchParams.get("min");return r?{value:r,type:"max"}:s?{value:s,type:"min"}:{value:null,type:null}}function N(e){const t=/https:\/\/(?:[a-zA-Z0-9.-]+)(?:\.[a-zA-Z0-9.-]+)+\/(?:notes|conversation)\/([a-zA-Z0-9-]+)/,r=e.match(t);return r&&r[1]?r[1]:null}function U(e,t){const r=/(https:\/\/(?:[a-zA-Z0-9.-]+)(?:\.[a-zA-Z0-9.-]+)+)\/.*/,s=e.match(r),n=t.match(r);return s!==null&&n!==null&&s[1]==n[1]}function l(e,t){return e?"/api/cache?url="+e.get_url_safe_base64(t):t}function a(e){return e.instrument&&e.instrument.find(r=>r.type==="VaultItem")||null}const w=(e,t)=>{if(t!=null&&t.object&&typeof t.object=="object"&&t.object!==null&&"type"in t.object&&t.object.type=="EncryptedNote"){let r;return e&&(r=a(t))?e.decrypt_text(r.content)||"":'<span class"failure">Message could not be decrypted</span>'}else return t!=null&&t.object&&typeof t.object=="object"&&t.object!==null&&"content"in t.object&&t.object.content||""},D=e=>e?e.replace(/<[^>]*>/g," "):"",M=e=>e?Array.isArray(e)?e[0]||null:e:null,o=e=>e==null?[]:Array.isArray(e)?e:[e];export{c as D,b as a,_ as b,l as c,I as d,N as e,M as f,S as g,j as h,p as i,y as j,g as k,w as l,d as m,x as n,f as o,m as p,U as q,D as r,A as s,o as t,h as u};
