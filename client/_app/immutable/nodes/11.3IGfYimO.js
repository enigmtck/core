import{S as qe,i as Je,s as Xe,n as Te,d as M,v as Ce,b as Z,c as y,m as J,o as b,e as D,f as P,h as j,B as $,j as L,k as F,a as xe,g as Ie,t as Ne,D as ae,L as we,w as Ye,I as q,J as O,K as De,A as Re,N as ye,O as Ee,P as Me,l as Ae,q as et,X as Ke,M as Le,r as He,y as tt,C as ne}from"../chunks/DR2rOELM.js";import{e as fe,s as Oe,d as lt,D as Ve,f as st}from"../chunks/CV3kTBDU.js";import"../chunks/IHki7fMi.js";import{a as nt,e as at}from"../chunks/B4kYsGbE.js";import{A as Qe}from"../chunks/B-rSUPNY.js";import{C as ot}from"../chunks/DXHvQewm.js";import{b as rt,g as it}from"../chunks/eEFvHPNh.js";import{r as Be}from"../chunks/rTf68i7C.js";import"../chunks/DwxQ6Sg5.js";const ct=e=>typeof window>"u"||!e?Be(!1):Be(!1,s=>{const l=window.matchMedia(e);s(l.matches);const o=f=>s(f.matches);return l.addEventListener("change",o),()=>{l.removeEventListener("change",o)}});function ze(e,t,s){const l=e.slice();return l[6]=t[s],l}function je(e){let t,s,l=e[6]+"",o,f,c,i;return{c(){t=L("a"),s=Ne("#"),o=Ne(l),this.h()},l(h){t=D(h,"A",{href:!0,title:!0,"data-tag":!0,class:!0});var r=P(t);s=Ie(r,"#"),o=Ie(r,l),r.forEach(M),this.h()},h(){b(t,"href","#filters"),b(t,"title","Delete"),b(t,"data-tag",f=e[6]),b(t,"class","svelte-1g70ie2")},m(h,r){Z(h,t,r),y(t,s),y(t,o),c||(i=J(t,"click",e[3]),c=!0)},p(h,r){r&1&&l!==(l=h[6]+"")&&xe(o,l),r&1&&f!==(f=h[6])&&b(t,"data-tag",f)},d(h){h&&M(t),c=!1,i()}}}function ft(e){let t,s,l,o,f='<input type="text" name="statement" placeholder="Filter Statement (e.g., #Enigmatick)" class="svelte-1g70ie2"/>',c,i,h=fe(e[0]),r=[];for(let _=0;_<h.length;_+=1)r[_]=je(ze(e,h,_));return{c(){t=L("div"),s=L("div");for(let _=0;_<r.length;_+=1)r[_].c();l=F(),o=L("form"),o.innerHTML=f,this.h()},l(_){t=D(_,"DIV",{class:!0});var u=P(t);s=D(u,"DIV",{class:!0});var p=P(s);for(let V=0;V<r.length;V+=1)r[V].l(p);p.forEach(M),l=j(u),o=D(u,"FORM",{class:!0,"data-svelte-h":!0}),$(o)!=="svelte-ghbe8s"&&(o.innerHTML=f),u.forEach(M),this.h()},h(){b(s,"class","svelte-1g70ie2"),b(o,"class","svelte-1g70ie2"),b(t,"class","filters svelte-1g70ie2")},m(_,u){Z(_,t,u),y(t,s);for(let p=0;p<r.length;p+=1)r[p]&&r[p].m(s,null);y(t,l),y(t,o),e[5](o),c||(i=J(o,"submit",e[2]),c=!0)},p(_,[u]){if(u&9){h=fe(_[0]);let p;for(p=0;p<h.length;p+=1){const V=ze(_,h,p);r[p]?r[p].p(V,u):(r[p]=je(V),r[p].c(),r[p].m(s,null))}for(;p<r.length;p+=1)r[p].d(1);r.length=h.length}},i:Te,o:Te,d(_){_&&M(t),Ce(r,_),e[5](null),c=!1,i()}}}function ut(e,t,s){let{resetData:l}=t,{hashtags:o}=t,f;const c=r=>{var p;r.preventDefault();const _=new FormData(f);let u;(u=(p=_.get("statement"))==null?void 0:p.toString().trim())&&(u=u.startsWith("#")?u.slice(1):u,o.add(u.toString().toLowerCase()),s(0,o),l()),f.reset()},i=r=>{r.preventDefault();let u=r.target.dataset.tag;u&&(o.delete(u),s(0,o),l())};function h(r){ae[r?"unshift":"push"](()=>{f=r,s(1,f)})}return e.$$set=r=>{"resetData"in r&&s(4,l=r.resetData),"hashtags"in r&&s(0,o=r.hashtags)},[o,f,c,i,l,h]}class ht extends qe{constructor(t){super(),Je(this,t,ut,ft,Xe,{resetData:4,hashtags:0})}}function Fe(e,t,s){const l=e.slice();return l[51]=t[s],l[52]=t,l[53]=s,l}function Pe(e,t,s){const l=e.slice();return l[51]=t[s],l[54]=t,l[53]=s,l}function dt(e){let t,s='<i class="fa-solid fa-house svelte-d25ehx"></i>',l,o,f='<i class="fa-solid fa-hotel svelte-d25ehx"></i>',c,i,h='<i class="fa-solid fa-at svelte-d25ehx"></i>',r,_;return{c(){t=L("button"),t.innerHTML=s,l=F(),o=L("button"),o.innerHTML=f,c=F(),i=L("button"),i.innerHTML=h,this.h()},l(u){t=D(u,"BUTTON",{class:!0,"data-view":!0,"data-svelte-h":!0}),$(t)!=="svelte-1agtoqw"&&(t.innerHTML=s),l=j(u),o=D(u,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),$(o)!=="svelte-173hbjd"&&(o.innerHTML=f),c=j(u),i=D(u,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),$(i)!=="svelte-1jv3lro"&&(i.innerHTML=h),this.h()},h(){b(t,"class","selected svelte-d25ehx"),b(t,"data-view","home"),b(o,"data-view","local"),b(o,"class","svelte-d25ehx"),b(i,"data-view","direct"),b(i,"class","svelte-d25ehx")},m(u,p){Z(u,t,p),Z(u,l,p),Z(u,o,p),Z(u,c,p),Z(u,i,p),r||(_=[J(t,"click",e[13]),J(o,"click",e[13]),J(i,"click",e[13])],r=!0)},p:Te,d(u){u&&(M(t),M(l),M(o),M(c),M(i)),r=!1,Ye(_)}}}function Ze(e){let t,s=e[53],l;const o=()=>e[26](t,s),f=()=>e[26](null,s);let c={parentArticle:e[7][e[53]],remove:e[18],note:e[51],cachedNote:e[16]};return t=new Qe({props:c}),o(),t.$on("replyTo",function(){Ke(e[0].handleReplyToMessage)&&e[0].handleReplyToMessage.apply(this,arguments)}),{c(){Me(t.$$.fragment)},l(i){Ee(t.$$.fragment,i)},m(i,h){ye(t,i,h),l=!0},p(i,h){e=i,s!==e[53]&&(f(),s=e[53],o());const r={};h[0]&128&&(r.parentArticle=e[7][e[53]]),h[0]&256&&(r.note=e[51]),t.$set(r)},i(i){l||(O(t.$$.fragment,i),l=!0)},o(i){q(t.$$.fragment,i),l=!1},d(i){f(),we(t,i)}}}function We(e){let t,s=e[53],l;const o=()=>e[27](t,s),f=()=>e[27](null,s);let c={parentArticle:e[7][e[53]],remove:e[18],note:e[51],cachedNote:e[16]};return t=new Qe({props:c}),o(),t.$on("replyTo",function(){Ke(e[0].handleReplyToMessage)&&e[0].handleReplyToMessage.apply(this,arguments)}),{c(){Me(t.$$.fragment)},l(i){Ee(t.$$.fragment,i)},m(i,h){ye(t,i,h),l=!0},p(i,h){e=i,s!==e[53]&&(f(),s=e[53],o());const r={};h[0]&128&&(r.parentArticle=e[7][e[53]]),h[0]&512&&(r.note=e[51]),t.$set(r)},i(i){l||(O(t.$$.fragment,i),l=!0)},o(i){q(t.$$.fragment,i),l=!1},d(i){f(),we(t,i)}}}function Ue(e){var o,f;let t,s,l=e[51].note&&(!e[3]&&(!e[51].note.inReplyTo||((f=(o=e[51].note.ephemeral)==null?void 0:o.announces)==null?void 0:f.length))||e[51].note.id==e[3])&&We(e);return{c(){l&&l.c(),t=He()},l(c){l&&l.l(c),t=He()},m(c,i){l&&l.m(c,i),Z(c,t,i),s=!0},p(c,i){var h,r;c[51].note&&(!c[3]&&(!c[51].note.inReplyTo||(r=(h=c[51].note.ephemeral)==null?void 0:h.announces)!=null&&r.length)||c[51].note.id==c[3])?l?(l.p(c,i),i[0]&520&&O(l,1)):(l=We(c),l.c(),O(l,1),l.m(t.parentNode,t)):l&&(Le(),q(l,1,1,()=>{l=null}),De())},i(c){s||(O(l),s=!0)},o(c){q(l),s=!1},d(c){c&&M(t),l&&l.d(c)}}}function Ge(e){let t,s='<i class="fa-solid fa-angles-left svelte-d25ehx"></i>',l,o;return{c(){t=L("div"),t.innerHTML=s,this.h()},l(f){t=D(f,"DIV",{class:!0,"data-svelte-h":!0}),$(t)!=="svelte-1x9brsn"&&(t.innerHTML=s),this.h()},h(){b(t,"class","back svelte-d25ehx")},m(f,c){Z(f,t,c),l||(o=J(t,"click",tt(e[14])),l=!0)},p:Te,d(f){f&&M(t),l=!1,o()}}}function mt(e){let t,s,l,o,f,c,i,h,r='<i class="fa-solid fa-globe svelte-d25ehx"></i>',_,u,p='<i class="fa-solid fa-chevron-up svelte-d25ehx"></i>',V,k,oe,le,x,W,N,X,ue="Filters",he,U,de,Y,R,pe="Â ",se,re,ee,_e={senderFunction:e[17],direct:e[10]==="direct"};t=new ot({props:_e}),e[25](t),t.$on("publish",e[21]);let H=e[22]&&dt(e),B=fe(e[8]),T=[];for(let a=0;a<B.length;a+=1)T[a]=Ze(Pe(e,B,a));const me=a=>q(T[a],1,1,()=>{T[a]=null});let G=fe(Array.from(e[9].values())),v=[];for(let a=0;a<G.length;a+=1)v[a]=Ue(Fe(e,G,a));const ve=a=>q(v[a],1,1,()=>{v[a]=null});let C=(e[3]||e[4])&&Ge(e);return U=new ht({props:{hashtags:e[2],resetData:e[19]}}),{c(){Me(t.$$.fragment),s=F(),l=L("main"),o=L("div"),f=L("header"),c=L("nav"),H&&H.c(),i=F(),h=L("button"),h.innerHTML=r,_=F(),u=L("div"),u.innerHTML=p,V=F(),k=L("div");for(let a=0;a<T.length;a+=1)T[a].c();oe=F();for(let a=0;a<v.length;a+=1)v[a].c();le=F(),C&&C.c(),x=F(),W=L("div"),N=L("div"),X=L("h1"),X.textContent=ue,he=F(),Me(U.$$.fragment),de=F(),Y=L("div"),R=L("a"),R.textContent=pe,this.h()},l(a){Ee(t.$$.fragment,a),s=j(a),l=D(a,"MAIN",{class:!0});var g=P(l);o=D(g,"DIV",{class:!0});var w=P(o);f=D(w,"HEADER",{class:!0});var K=P(f);c=D(K,"NAV",{class:!0});var m=P(c);H&&H.l(m),i=j(m),h=D(m,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),$(h)!=="svelte-1446o8e"&&(h.innerHTML=r),m.forEach(M),_=j(K),u=D(K,"DIV",{class:!0,"data-svelte-h":!0}),$(u)!=="svelte-iaaual"&&(u.innerHTML=p),K.forEach(M),V=j(w),k=D(w,"DIV",{class:!0});var z=P(k);for(let Q=0;Q<T.length;Q+=1)T[Q].l(z);oe=j(z);for(let Q=0;Q<v.length;Q+=1)v[Q].l(z);z.forEach(M),le=j(w),C&&C.l(w),w.forEach(M),x=j(g),W=D(g,"DIV",{class:!0});var ie=P(W);N=D(ie,"DIV",{style:!0,class:!0});var ce=P(N);X=D(ce,"H1",{class:!0,"data-svelte-h":!0}),$(X)!=="svelte-lvj8b"&&(X.textContent=ue),he=j(ce),Ee(U.$$.fragment,ce),ce.forEach(M),de=j(ie),Y=D(ie,"DIV",{class:!0});var be=P(Y);R=D(be,"A",{href:!0,class:!0,"data-svelte-h":!0}),$(R)!=="svelte-o9t9r9"&&(R.textContent=pe),be.forEach(M),ie.forEach(M),g.forEach(M),this.h()},h(){b(h,"data-view","global"),b(h,"class","svelte-d25ehx"),b(c,"class","svelte-d25ehx"),b(u,"class","scroll svelte-d25ehx"),b(f,"class","svelte-d25ehx"),b(k,"class","scrollable svelte-d25ehx"),b(o,"class","content svelte-d25ehx"),b(X,"class","svelte-d25ehx"),Re(N,"display",e[11]?"none":"flex"),b(N,"class","svelte-d25ehx"),b(R,"href","#filters"),b(R,"class","svelte-d25ehx"),b(Y,"class","handle svelte-d25ehx"),b(W,"class","context svelte-d25ehx"),b(l,"class","svelte-d25ehx")},m(a,g){ye(t,a,g),Z(a,s,g),Z(a,l,g),y(l,o),y(o,f),y(f,c),H&&H.m(c,null),y(c,i),y(c,h),y(f,_),y(f,u),y(o,V),y(o,k);for(let w=0;w<T.length;w+=1)T[w]&&T[w].m(k,null);y(k,oe);for(let w=0;w<v.length;w+=1)v[w]&&v[w].m(k,null);e[28](k),y(o,le),C&&C.m(o,null),y(l,x),y(l,W),y(W,N),y(N,X),y(N,he),ye(U,N,null),e[29](N),y(W,de),y(W,Y),y(Y,R),e[30](Y),se=!0,re||(ee=[J(h,"click",e[13]),J(u,"click",e[15]),J(k,"scroll",e[23]),J(R,"click",e[20])],re=!0)},p(a,g){const w={};if(g[0]&1024&&(w.direct=a[10]==="direct"),t.$set(w),a[22]&&H.p(a,g),g[0]&328065){B=fe(a[8]);let m;for(m=0;m<B.length;m+=1){const z=Pe(a,B,m);T[m]?(T[m].p(z,g),O(T[m],1)):(T[m]=Ze(z),T[m].c(),O(T[m],1),T[m].m(k,oe))}for(Le(),m=B.length;m<T.length;m+=1)me(m);De()}if(g[0]&328329){G=fe(Array.from(a[9].values()));let m;for(m=0;m<G.length;m+=1){const z=Fe(a,G,m);v[m]?(v[m].p(z,g),O(v[m],1)):(v[m]=Ue(z),v[m].c(),O(v[m],1),v[m].m(k,null))}for(Le(),m=G.length;m<v.length;m+=1)ve(m);De()}a[3]||a[4]?C?C.p(a,g):(C=Ge(a),C.c(),C.m(o,null)):C&&(C.d(1),C=null);const K={};g[0]&4&&(K.hashtags=a[2]),U.$set(K),(!se||g[0]&2048)&&Re(N,"display",a[11]?"none":"flex")},i(a){if(!se){O(t.$$.fragment,a);for(let g=0;g<B.length;g+=1)O(T[g]);for(let g=0;g<G.length;g+=1)O(v[g]);O(U.$$.fragment,a),se=!0}},o(a){q(t.$$.fragment,a),T=T.filter(Boolean);for(let g=0;g<T.length;g+=1)q(T[g]);v=v.filter(Boolean);for(let g=0;g<v.length;g+=1)q(v[g]);q(U.$$.fragment,a),se=!1},d(a){a&&(M(s),M(l)),e[25](null),we(t,a),H&&H.d(),Ce(T,a),Ce(v,a),e[28](null),C&&C.d(),we(U),e[29](null),e[30](null),re=!1,Ye(ee)}}}let gt=0;function pt(e,t,s){let l,o,f,c,i,h,r;Ae(e,nt,n=>s(40,i=n)),Ae(e,at,n=>s(24,h=n));let _,u;const p=ct("(max-width: 1000px)");Ae(e,p,n=>s(11,r=n)),et(async()=>{a&&a.addEventListener("scroll",he),G?s(10,l="home"):s(10,l="global"),await le()});const V=async n=>{if(!n.note.inReplyTo&&n.note.id){f.has(n.note.id)||f.set(n.note.id,n),await k(!0,0);return}const d=E=>{for(const[,A]of E.entries()){if(A.note.id===n.note.inReplyTo&&n.note.id)return A.replies.has(n.note.id)||A.replies.set(n.note.id,n),!0;if(d(A.replies))return!0}return!1};if(n.note.inReplyTo&&d(f)){await k(!1);return}await k(!1)},k=async(n,d)=>{try{let E=g;if(console.log(`SCROLL TOP ${E}`),s(9,f),n&&d){for(let A=0;A<d;A++)await ne();console.log(`SCROLLING TO ${E}`),a.scrollTo({top:E,left:0,behavior:"instant"})}}catch(E){console.debug("Error updating notes"),console.error(E)}},oe=async n=>{var d,E;if(n.object.attributedTo){const A=(E=(d=n.object.ephemeral)==null?void 0:d.attributedTo)==null?void 0:E.at(0);if(A){const S=new Ve(A,n.object,n);await V(S)}}},le=async()=>{let n=0;if(f.forEach(d=>{d.note.inReplyTo||(n+=1)}),n<10)try{let d=await x();console.debug("TIMELINE LENGTH: "+d),d&&d>0&&await le()}catch(d){console.error(d)}},x=async()=>{var E;let d=0;if(o&&l&&a){re||(console.debug("INSTANTIATING CACHE"),re=new o.EnigmatickCache,console.debug("Cache instantiated"));let A=await o.get_timeline(T,void 0,20,l,ee);console.debug("X!"),console.debug(A);try{let S=JSON.parse(String(A));if(console.debug("RETRIEVED TIMELINE DATA"),console.debug(S),S.next){const I=lt(S.next);I.type==="max"&&I.value&&(T=I.value)}try{(E=S.orderedItems)==null||E.forEach(I=>{oe(I)})}catch(I){console.error(I)}return length}catch(S){for(console.error(S),console.debug(A);d++<10;)await Oe(1e3),await x(),console.debug("RETRYING TIMELINE")}}else console.error("NO WASM OR VIEW YET"),await Oe(500),await x()};rt(async n=>{if(console.log(n),n.to&&n.to.route.id===null){let d=n.to.url.href;const E=/^https:\/\/(?:[a-zA-Z0-9\-]+)(?:\.[a-zA-Z0-9\-]+)+?\/@[a-zA-Z0-9_]+$/,A=/^https:\/\/(?:[a-zA-Z0-9\-]+)(?:\.[a-zA-Z0-9\-]+)+?\/tags\/([a-zA-Z0-9\-_]+)$/,S=/^https:\/\/(?:[a-zA-Z0-9\-]+)(?:\.[a-zA-Z0-9\-]+)+?\/search\?tag=([a-zA-Z0-9\-_]+)$/;let I;if(d.match(E)){let ge=st(d);ge&&(console.log(`WEBFINGER: ${ge}`),n.cancel(),it(`/${ge}`))}else((I=d.match(A))||(I=d.match(S)))&&(ee.add(I[1].toLowerCase()),n.cancel(),s(2,ee),R())}console.log(ee)});const W=async n=>{if(console.log(n),n.target){let d=n.target.dataset.view;d&&(Array.from(document.getElementsByTagName("header")[0].getElementsByTagName("nav")[0].getElementsByTagName("button")).forEach(E=>E.classList.remove("selected")),n.target.classList.add("selected"),s(10,l=d),await R())}},N=async()=>{s(4,ve=null),s(3,v=null),_.resetCompose(),await X(),H=!1},X=async()=>{await ne(),await ne(),await ne(),a.scrollTo({top:gt,left:0,behavior:"instant"})},ue=async()=>{let n=a.scrollTop;return console.debug(`CURRENT: ${n}`),await ne(),await ne(),await ne(),a.scrollTo({top:0,left:0,behavior:"instant"}),console.debug("SCROLLED TO TOP"),n},he=async()=>{if(!B&&!H&&!v){B=!0;let d=1;for(;!H&&a.scrollTop+a.offsetHeight>=a.scrollHeight*.8&&d>0;)d=await x()||0;B=!1}const n=document.getElementsByClassName("scroll")[0];a.scrollTop<50?(_e=!0,n.style.display="none"):(_e=!1,n.style.display="revert")},U=async n=>(o&&!me.has(n)&&me.set(n,await o.get_note(n)),me.get(n)),de=async(n,d,E,A,S,I,ge)=>{var ke;if(o){let te=(await o.SendParams.new()).set_content(E);ge||te.set_public(),te.set_attachments(JSON.stringify(A)),te.set_hashtags(I);for(const[$e,Se]of S)te.add_mention($e,Se.id||"",((ke=Se.capabilities)==null?void 0:ke.enigmatickEncryption)||!1);return d&&(te.set_in_reply_to(String(d.note.id)),te.set_conversation(String(d.note.conversation))),console.log(te),await o.send_note(te)}else return null},Y=()=>{console.debug("REMOVE")},R=async()=>{N(),s(9,f=new Map),s(8,c=new Array),await ue(),T=void 0;const n=document.getElementsByClassName("scroll")[0];n.style.display="none",await le()},pe=n=>{n&&n.preventDefault(),console.debug("Toggling Filters"),u.style.display==="none"?s(1,u.style.display="flex",u):s(1,u.style.display="none",u)},se=async n=>{var E,A;console.debug("Handling dispatched Publish in Timeline"),console.debug(n);const d=n.detail.activity;if(d.object.attributedTo){const S=(A=(E=d.object.ephemeral)==null?void 0:E.attributedTo)==null?void 0:A.at(0);if(S){const I=new Ve(S,d.object,d);c.unshift(I),s(8,c)}}};let re=null,ee=new Set,_e=!0,H=!1,B=!1,T,me=new Map,G=i.username,v=null,ve=null,C,a,g=0,w=[];const K=n=>{!B&&!v&&(g=a.scrollTop)};function m(n){ae[n?"unshift":"push"](()=>{_=n,s(0,_)})}function z(n,d){ae[n?"unshift":"push"](()=>{w[d]=n,s(7,w)})}function ie(n,d){ae[n?"unshift":"push"](()=>{w[d]=n,s(7,w)})}function ce(n){ae[n?"unshift":"push"](()=>{a=n,s(6,a)})}function be(n){ae[n?"unshift":"push"](()=>{u=n,s(1,u)})}function Q(n){ae[n?"unshift":"push"](()=>{C=n,s(5,C)})}return e.$$.update=()=>{e.$$.dirty[0]&16777216&&(o=h)},s(10,l=""),s(9,f=new Map),s(8,c=new Array),[_,u,ee,v,ve,C,a,w,c,f,l,r,p,W,N,ue,U,de,Y,R,pe,se,G,K,h,m,z,ie,ce,be,Q]}class Ct extends qe{constructor(t){super(),Je(this,t,pt,mt,Xe,{},null,[-1,-1])}}export{Ct as component};
