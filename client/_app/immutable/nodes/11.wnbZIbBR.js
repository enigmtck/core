import{_ as ze}from"../chunks/preload-helper.0HuHagjb.js";import{s as Fe,a as F,f as j,c as G,g as J,h as Y,u as se,d as N,j as H,i as W,v as V,D as ne,I as Ue,M as Ve,w as Ae,o as Ge,G as _,e as X,E as Ze,p as qe,J as je}from"../chunks/scheduler.tnyNm5U0.js";import{h as ae,u as Je,R as Ye,A as Ke}from"../chunks/Article.hxzUsjyw.js";import{e as ie}from"../chunks/each.-oqiv04n.js";import{S as Qe,i as Xe,b as Te,d as Se,m as ke,a as M,c as de,t as $,e as Oe,g as pe}from"../chunks/index.R_ElRwcJ.js";import{C as xe}from"../chunks/Compose.wT4Gt7uh.js";import{b as et,g as tt}from"../chunks/navigation.ht3DkHMI.js";import{a as nt,e as ot}from"../chunks/stores.bABpd-zC.js";import{r as ce}from"../chunks/index.R4pWNgh9.js";import{c as ue,D as rt,s as le,i as Le}from"../chunks/common.wRqRBlgV.js";async function lt(t,n){const r=t.getReader();let e;for(;!(e=await r.read()).done;)n(e.value)}function st(t){let n,r,e,o=!1;return function(c){n===void 0?(n=c,r=0,e=-1):n=it(n,c);const s=n.length;let i=0;for(;r<s;){o&&(n[r]===10&&(i=++r),o=!1);let u=-1;for(;r<s&&u===-1;++r)switch(n[r]){case 58:e===-1&&(e=r-i);break;case 13:o=!0;case 10:u=r;break}if(u===-1)break;t(n.subarray(i,u),e),i=r,e=-1}i===s?n=void 0:i!==0&&(n=n.subarray(i),r-=i)}}function at(t,n,r){let e=Ne();const o=new TextDecoder;return function(c,s){if(c.length===0)r?.(e),e=Ne();else if(s>0){const i=o.decode(c.subarray(0,s)),u=s+(c[s+1]===32?2:1),b=o.decode(c.subarray(u));switch(i){case"data":e.data=e.data?e.data+`
`+b:b;break;case"event":e.event=b;break;case"id":t(e.id=b);break;case"retry":const T=parseInt(b,10);isNaN(T)||n(e.retry=T);break}}}}function it(t,n){const r=new Uint8Array(t.length+n.length);return r.set(t),r.set(n,t.length),r}function Ne(){return{data:"",event:"",id:"",retry:void 0}}var ct=function(t,n){var r={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.indexOf(e)<0&&(r[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,e=Object.getOwnPropertySymbols(t);o<e.length;o++)n.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(t,e[o])&&(r[e[o]]=t[e[o]]);return r};const ye="text/event-stream",ut=1e3,Ce="last-event-id";function ft(t,n){var{signal:r,headers:e,onopen:o,onmessage:l,onclose:c,onerror:s,openWhenHidden:i,fetch:u}=n,b=ct(n,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((T,R)=>{const m=Object.assign({},e);m.accept||(m.accept=ye);let E;function k(){E.abort(),document.hidden||g()}i||document.addEventListener("visibilitychange",k);let A=ut,D=0;function I(){document.removeEventListener("visibilitychange",k),window.clearTimeout(D),E.abort()}r?.addEventListener("abort",()=>{I(),T()});const O=u??window.fetch,C=o??dt;async function g(){var B;E=new AbortController;try{const w=await O(t,Object.assign(Object.assign({},b),{headers:m,signal:E.signal}));await C(w),await lt(w.body,st(at(d=>{d?m[Ce]=d:delete m[Ce]},d=>{A=d},l))),c?.(),I(),T()}catch(w){if(!E.signal.aborted)try{const d=(B=s?.(w))!==null&&B!==void 0?B:A;window.clearTimeout(D),D=window.setTimeout(g,d)}catch(d){I(),R(d)}}}g()})}function dt(t){const n=t.headers.get("content-type");if(!n?.startsWith(ye))throw new Error(`Expected content-type to be ${ye}, Actual: ${n}`)}const fe=typeof document<"u",pt=0,ht=1,te=2;function mt({resource:t,options:n,onIdFound:r}){const e=new Map;let o=pt;const l=new AbortController,c=!0,s=n?{...n}:{};async function i(){fe&&(await ft(`${t}`,{openWhenHidden:c,...s,method:"POST",async onopen({headers:m}){if(!r)return;const E=m.get("x-sse-id");E&&r(E??"")},onmessage({id:m,event:E,data:k}){R({id:m,event:E,data:k})},onclose(){o=te,T({})},onerror(m){o=te,b(m)},signal:l.signal}),o=ht)}function u({reason:m}){l.abort(m),o=te,T({})}function b({error:m}){const E=e.get("error")??[];for(const k of E)k({id:"",event:"",data:"",error:m,connect:i,close:u})}function T({error:m}){const E=e.get("close")??[];for(const k of E)k({id:"",event:"",data:"",error:m,connect:i,close:u})}function R({id:m,event:E,data:k}){const A=decodeURIComponent(k),D=e.get(E)??[];for(const I of D)I({id:m,event:E,data:A,connect:i,close:u})}return i(),{get url(){return`${t}`},get readyState(){return o},addEventListener(m,E){e.has(m)||e.set(m,[]),(e.get(m)??[]).push(E)},removeEventListener(m,E){if(!e.has(m))return;const A=(e.get(m)??[]).filter(function(I){return I!==E});e.set(m,A)},close:u}}const Q=new Map;async function Ee({resource:t}){const n=`${t}`,r=Q.get(n);if(r){const{eventSource:e}=r;e.readyState!==te&&(r.eventSource.close({}),r.stopBeacon()),r.connectionsCounter--,r.connectionsCounter<0&&(r.connectionsCounter=0),r.connectionsCounter===0&&Q.delete(n)}}function gt({resource:t,beacon:n=5e3,options:r={}}){const e=`${t}`;if(!Q.has(e)){let s=!1;const i=mt({resource:t,beacon:n,options:r,onIdFound(T){n<=0||(s=setInterval(function(){navigator.sendBeacon(t.toString()+"?"+T)},n))}}),u=function(){s&&clearInterval(s)};i.addEventListener("close",u),i.addEventListener("error",u);const b={resource:t,eventSource:i,connectionsCounter:0,stopBeacon:u};return Q.set(e,b),b}const o=Q.get(e);if(!o)throw new Error(`Could not find reference for ${e}.`);const{eventSource:l,stopBeacon:c}=o;if(l.readyState===te){const s={resource:t,eventSource:l,connectionsCounter:0,stopBeacon:c};return Q.set(e,s),s}return o.connectionsCounter<0?o.connectionsCounter=1:o.connectionsCounter++,o}function vt({connected:t,eventName:n,readables:r,state:e}){const{eventSource:o,resource:l}=t;return ce("",function(s){function i(u){s(u.data)}return o.addEventListener(n,i),async function(){e.eventsCounter--,await Ee({resource:l}),o.removeEventListener(n,i),r.delete(n)}})}function bt({connected:t,eventName:n}){return function(e){if(!fe)return ce("");const{eventSource:o}=t,l=new ReadableStream({start(c){o.addEventListener(n,function(i){c.enqueue(i.data)})}});return e(l)}}function _t({error:t,previous:n}){return console.error(t),n}function yt(t,{close:n,error:r,beacon:e=5e3,options:o={}}={}){let l={eventsCounter:0},c=new Map;const s=gt({resource:t,beacon:e,options:o}),{eventSource:i}=s;return r&&i.addEventListener("error",r),n&&i.addEventListener("close",n),{close(){return fe?Ee({resource:t}):Promise.resolve()},select(u){if(u.includes(`
`))throw new Error(`The name of the event must not contain new line characters, received "${u}"`);const b=typeof u;if(b!=="string")throw new Error(`Event name must be of type \`string\`, received \`${b}\`.`);c.has(u)||c.set(u,vt({connected:s,eventName:u,readables:c,state:l})),l.eventsCounter++;const T=c.get(u);if(!T)throw new Error(`Could not find event ${u}.`);return{subscribe:T.subscribe,transform:bt({connected:s,eventName:u}),json(R=_t){return fe?this.transform(function(k){let A=null;const D=k.getReader();return ce(A,function(O){const C=async function(){try{const{done:B,value:w}=await D.read();if(B)return;try{A=JSON.parse(w),O(A)}catch(d){O(R({previous:A,raw:w,error:d}))}C()}catch(B){O(R({previous:A,raw:"",error:B}))}};return C(),function(){Ee({resource:t}),D.cancel()}})}):ce(null)}}}}}function Me(t,n,r){const e=t.slice();return e[40]=n[r],e}function Ie(t,n,r){const e=t.slice();return e[43]=n[r],e}function Et(t){let n,r='<i class="fa-solid fa-house svelte-1f6ptaa"></i>Home',e,o,l='<i class="fa-solid fa-city svelte-1f6ptaa"></i>Local',c,s;return{c(){n=j("button"),n.innerHTML=r,e=F(),o=j("button"),o.innerHTML=l,this.h()},l(i){n=J(i,"BUTTON",{class:!0,"data-view":!0,"data-svelte-h":!0}),se(n)!=="svelte-e533dz"&&(n.innerHTML=r),e=G(i),o=J(i,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),se(o)!=="svelte-bi7xl3"&&(o.innerHTML=l),this.h()},h(){H(n,"class","selected svelte-1f6ptaa"),H(n,"data-view","home"),H(o,"data-view","local"),H(o,"class","svelte-1f6ptaa")},m(i,u){W(i,n,u),W(i,e,u),W(i,o,u),c||(s=[ne(n,"click",t[7]),ne(o,"click",t[7])],c=!0)},p:_,d(i){i&&(N(n),N(e),N(o)),c=!1,Ve(s)}}}function De(t){let n,r,e,o,l={ctx:t,current:null,token:null,hasCatch:!1,pending:Rt,then:Tt,catch:wt,value:46,blocks:[,,,]};ae(n=t[5](t[40].note),l);let c=t[40].note.id==t[1]&&t[40].replies?.size&&He(t);return{c(){l.block.c(),r=F(),c&&c.c(),e=X()},l(s){l.block.l(s),r=G(s),c&&c.l(s),e=X()},m(s,i){l.block.m(s,l.anchor=i),l.mount=()=>r.parentNode,l.anchor=r,W(s,r,i),c&&c.m(s,i),W(s,e,i),o=!0},p(s,i){t=s,l.ctx=t,i[0]&8&&n!==(n=t[5](t[40].note))&&ae(n,l)||Je(l,t,i),t[40].note.id==t[1]&&t[40].replies?.size?c?(c.p(t,i),i[0]&10&&M(c,1)):(c=He(t),c.c(),M(c,1),c.m(e.parentNode,e)):c&&(pe(),$(c,1,1,()=>{c=null}),de())},i(s){o||(M(l.block),M(c),o=!0)},o(s){for(let i=0;i<3;i+=1){const u=l.blocks[i];$(u)}$(c),o=!1},d(s){s&&(N(r),N(e)),l.block.d(s),l.token=null,l=null,c&&c.d(s)}}}function wt(t){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function Tt(t){let n,r,e,o={ctx:t,current:null,token:null,hasCatch:!1,pending:Ot,then:kt,catch:St,value:47,blocks:[,,,]};return ae(r=t[6](t[40].note),o),{c(){n=X(),o.block.c()},l(l){n=X(),o.block.l(l)},m(l,c){W(l,n,c),o.block.m(l,o.anchor=c),o.mount=()=>n.parentNode,o.anchor=n,e=!0},p(l,c){t=l,o.ctx=t,c[0]&8&&r!==(r=t[6](t[40].note))&&ae(r,o)||Je(o,t,c)},i(l){e||(M(o.block),e=!0)},o(l){for(let c=0;c<3;c+=1){const s=o.blocks[c];$(s)}e=!1},d(l){l&&N(n),o.block.d(l),o.token=null,o=null}}}function St(t){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function kt(t){let n,r;return n=new Ke({props:{remove:Nt,refresh:Lt,note:t[40],username:t[11],replyToHeader:t[46],announceHeader:t[47],renderAction:t[4]}}),n.$on("replyTo",function(){je(t[0].handleReplyToMessage)&&t[0].handleReplyToMessage.apply(this,arguments)}),n.$on("noteSelect",t[8]),{c(){Te(n.$$.fragment)},l(e){Se(n.$$.fragment,e)},m(e,o){ke(n,e,o),r=!0},p(e,o){t=e;const l={};o[0]&8&&(l.note=t[40]),o[0]&8&&(l.replyToHeader=t[46]),o[0]&8&&(l.announceHeader=t[47]),n.$set(l)},i(e){r||(M(n.$$.fragment,e),r=!0)},o(e){$(n.$$.fragment,e),r=!1},d(e){Oe(n,e)}}}function Ot(t){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function Rt(t){return{c:_,l:_,m:_,p:_,i:_,o:_,d:_}}function He(t){let n,r,e,o=ie(Array.from(t[40].replies.values()).sort(ue)),l=[];for(let s=0;s<o.length;s+=1)l[s]=$e(Ie(t,o,s));const c=s=>$(l[s],1,1,()=>{l[s]=null});return{c(){n=j("div");for(let s=0;s<l.length;s+=1)l[s].c();r=F(),this.h()},l(s){n=J(s,"DIV",{class:!0});var i=Y(n);for(let u=0;u<l.length;u+=1)l[u].l(i);r=G(i),i.forEach(N),this.h()},h(){H(n,"class","replies svelte-1f6ptaa")},m(s,i){W(s,n,i);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(n,null);V(n,r),e=!0},p(s,i){if(i[0]&2313){o=ie(Array.from(s[40].replies.values()).sort(ue));let u;for(u=0;u<o.length;u+=1){const b=Ie(s,o,u);l[u]?(l[u].p(b,i),M(l[u],1)):(l[u]=$e(b),l[u].c(),M(l[u],1),l[u].m(n,r))}for(pe(),u=o.length;u<l.length;u+=1)c(u);de()}},i(s){if(!e){for(let i=0;i<o.length;i+=1)M(l[i]);e=!0}},o(s){l=l.filter(Boolean);for(let i=0;i<l.length;i+=1)$(l[i]);e=!1},d(s){s&&N(n),Ue(l,s)}}}function $e(t){let n,r;return n=new Ye({props:{note:t[43],username:t[11]}}),n.$on("replyTo",function(){je(t[0].handleReplyToMessage)&&t[0].handleReplyToMessage.apply(this,arguments)}),n.$on("noteSelect",t[8]),{c(){Te(n.$$.fragment)},l(e){Se(n.$$.fragment,e)},m(e,o){ke(n,e,o),r=!0},p(e,o){t=e;const l={};o[0]&8&&(l.note=t[43]),n.$set(l)},i(e){r||(M(n.$$.fragment,e),r=!0)},o(e){$(n.$$.fragment,e),r=!1},d(e){Oe(n,e)}}}function Be(t){let n,r,e=t[40].note&&(!t[1]&&(!t[40].note.inReplyTo||t[40].note.ephemeralAnnounces?.length)||t[40].note.id==t[1])&&De(t);return{c(){e&&e.c(),n=X()},l(o){e&&e.l(o),n=X()},m(o,l){e&&e.m(o,l),W(o,n,l),r=!0},p(o,l){o[40].note&&(!o[1]&&(!o[40].note.inReplyTo||o[40].note.ephemeralAnnounces?.length)||o[40].note.id==o[1])?e?(e.p(o,l),l[0]&10&&M(e,1)):(e=De(o),e.c(),M(e,1),e.m(n.parentNode,n)):e&&(pe(),$(e,1,1,()=>{e=null}),de())},i(o){r||(M(e),r=!0)},o(o){$(e),r=!1},d(o){o&&N(n),e&&e.d(o)}}}function Pe(t){let n,r,e,o;return{c(){n=j("div"),r=j("i"),this.h()},l(l){n=J(l,"DIV",{class:!0});var c=Y(n);r=J(c,"I",{class:!0}),Y(r).forEach(N),c.forEach(N),this.h()},h(){H(r,"class","fa-solid fa-angles-left svelte-1f6ptaa"),H(n,"class","back svelte-1f6ptaa")},m(l,c){W(l,n,c),V(n,r),e||(o=ne(r,"click",Ze(t[9])),e=!0)},p:_,d(l){l&&N(n),e=!1,o()}}}function At(t){let n,r,e,o,l,c,s,i='<i class="fa-solid fa-globe svelte-1f6ptaa"></i>Global',u,b,T,R,m='<i class="fa-solid fa-chevron-up svelte-1f6ptaa"></i>',E,k,A,D,I={senderFunction:t[10]};n=new xe({props:I}),t[15](n);let O=t[11]&&Et(t),C=ie(Array.from(t[3].values()).sort(ue).reverse()),g=[];for(let d=0;d<C.length;d+=1)g[d]=Be(Me(t,C,d));const B=d=>$(g[d],1,1,()=>{g[d]=null});let w=(t[1]||t[2])&&Pe(t);return{c(){Te(n.$$.fragment),r=F(),e=j("main"),o=j("header"),l=j("nav"),O&&O.c(),c=F(),s=j("button"),s.innerHTML=i,u=F(),b=j("div");for(let d=0;d<g.length;d+=1)g[d].c();T=F(),R=j("div"),R.innerHTML=m,E=F(),w&&w.c(),this.h()},l(d){Se(n.$$.fragment,d),r=G(d),e=J(d,"MAIN",{class:!0});var y=Y(e);o=J(y,"HEADER",{class:!0});var P=Y(o);l=J(P,"NAV",{class:!0});var S=Y(l);O&&O.l(S),c=G(S),s=J(S,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),se(s)!=="svelte-v94doe"&&(s.innerHTML=i),S.forEach(N),P.forEach(N),u=G(y),b=J(y,"DIV",{class:!0});var Z=Y(b);for(let z=0;z<g.length;z+=1)g[z].l(Z);Z.forEach(N),T=G(y),R=J(y,"DIV",{class:!0,"data-svelte-h":!0}),se(R)!=="svelte-14v484t"&&(R.innerHTML=m),E=G(y),w&&w.l(y),y.forEach(N),this.h()},h(){H(s,"data-view","global"),H(s,"class","svelte-1f6ptaa"),H(l,"class","svelte-1f6ptaa"),H(o,"class","svelte-1f6ptaa"),H(b,"class","scrollable svelte-1f6ptaa"),H(R,"class","scroll svelte-1f6ptaa"),H(e,"class","svelte-1f6ptaa")},m(d,y){ke(n,d,y),W(d,r,y),W(d,e,y),V(e,o),V(o,l),O&&O.m(l,null),V(l,c),V(l,s),V(e,u),V(e,b);for(let P=0;P<g.length;P+=1)g[P]&&g[P].m(b,null);V(e,T),V(e,R),V(e,E),w&&w.m(e,null),k=!0,A||(D=[ne(s,"click",t[7]),ne(R,"click",we)],A=!0)},p(d,y){const P={};if(n.$set(P),d[11]&&O.p(d,y),y[0]&2427){C=ie(Array.from(d[3].values()).sort(ue).reverse());let S;for(S=0;S<C.length;S+=1){const Z=Me(d,C,S);g[S]?(g[S].p(Z,y),M(g[S],1)):(g[S]=Be(Z),g[S].c(),M(g[S],1),g[S].m(b,null))}for(pe(),S=C.length;S<g.length;S+=1)B(S);de()}d[1]||d[2]?w?w.p(d,y):(w=Pe(d),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i(d){if(!k){M(n.$$.fragment,d);for(let y=0;y<C.length;y+=1)M(g[y]);k=!0}},o(d){$(n.$$.fragment,d),g=g.filter(Boolean);for(let y=0;y<g.length;y+=1)$(g[y]);k=!1},d(d){d&&(N(r),N(e)),t[15](null),Oe(n,d),O&&O.d(),Ue(g,d),w&&w.d(),A=!1,Ve(D)}}}function _e(t){if(t)try{return JSON.parse(t)}catch{return console.error("UNABLE TO PARSE PROFILE"),console.debug(t),null}else return console.error("UNABLE TO PARSE NULL OR UNDEFINED"),null}function we(){const t=document.getElementsByClassName("scrollable")[0];let n=t.scrollTop;return t.scrollTop=0,n}function Lt(){console.debug("REFRESH")}function Nt(){console.debug("REMOVE")}function Ct(t,n,r){let e,o,l,c,s;Ae(t,nt,a=>r(13,c=a)),Ae(t,ot,a=>r(14,s=a));let i,u=null,b=null,T=new Set;function R(a){for(let f of a)if(f.isIntersecting&&f.target){let p=f.target;if(p.dataset){let h=p.dataset;if(console.log(h.conversation),o&&h.conversation){let v=h.conversation;T.has(v)||(T.add(v),o.get_conversation(h.conversation,0,50).then(L=>{if(L){let U=JSON.parse(L);U.forEach(Re=>{Re.inReplyTo&&I(Re)}),console.log(U),m(!0)}}))}}}}function m(a){new Map(K).forEach((p,h)=>{p.note.inReplyTo&&(l.has(p.note.inReplyTo)?(K.delete(h),D(p)):a&&K.has(p.note.inReplyTo)&&m(!1))})}function E(a){b&&b.observe(a)}Ge(async()=>{const{Buffer:a}=await ze(()=>import("../chunks/index.aMiLl7Je.js").then(p=>p.i),__vite__mapDeps([0,1]),import.meta.url);window.Buffer=a;let f=document.getElementsByClassName("scrollable")[0];b=new IntersectionObserver(R,{root:null,threshold:.3}),f&&f.addEventListener("scroll",d),me?(e="home",yt("/api/user/"+me+"/events",{close({connect:p}){console.log("event stream closed"),le(500).then(()=>{p()})}}).select("message").subscribe(p=>{if(p)try{let h=JSON.parse(p);if(console.log(h),h.type==="Note"){let v=h;z||v.inReplyTo?I(v):re.push(v),ee+=1}else if(o&&h.uuid)u=h.uuid,o.send_authorization(u).then(v=>{console.info(`AUTHORIZATION SENT FOR ${u}`)});else if(o&&h.type=="Announce"){let v=h;o.get_note(v.object).then(L=>{try{let U=JSON.parse(String(L));U.ephemeralAnnounces=[v.actor],U.id=v.id,U.published=v.published,U.ephemeralTimestamp=v.published,z?I(U):re.push(U),ee+=1}catch{console.error("FAILED TO ADD NOTE"),console.error(L)}})}}catch{console.error("FAILED TO PARSE SSE MESSAGE"),console.error(p)}})):e="global"});async function k(a){if(a.inReplyTo){const f=await P(a.inReplyTo);if(f){const p=JSON.parse(String(f)),h=await y(p.attributedTo),v=_e(h);return v&&o?Le(o,v.name||v.preferredUsername,v):null}else return null}else return null}async function A(a){if(a.ephemeralAnnounces){const f=await y(a.ephemeralAnnounces[0]);let p="";if(a.ephemeralAnnounces.length==2?p=` and ${a.ephemeralAnnounces.length-1} other`:a.ephemeralAnnounces.length>2&&(p=` and ${a.ephemeralAnnounces.length-1} others`),f){const h=_e(f);if(h&&o){const v=Le(o,h.name||h.preferredUsername,h);return{url:h.url,name:v,others:p}}else return null}else return null}else return null}function D(a){const f=a.note;if(f.inReplyTo){let p=x.get(String(f.inReplyTo));if(p){let h=l.get(p[0]);if(p.forEach((v,L,U)=>{L>0&&(h=h?.replies.get(v))}),h?.note.id==f.inReplyTo){h.replies.set(String(f.id),a);let v=[...p];v.push(String(f.id)),x.set(String(f.id),v)}else console.error("TRAVERSAL ENDED SOMEWHERE UNEXPECTED")}else a.note.id&&K.set(a.note.id,a)}else l.get(String(f.id))||(l.set(String(f.id),a),x.set(String(f.id),[String(f.id)]))}async function I(a){if(a.ephemeralActors&&a.ephemeralActors.forEach(f=>{f.id&&q.set(f.id,JSON.stringify(f))}),a.ephemeralLikes&&(console.debug("EPHEMERAL LIKES"),console.debug(a.ephemeralLikes)),a.attributedTo){const f=await y(a.attributedTo);if(f){const p=_e(f);if(p){const h=new rt(p,a);D(h)}r(3,l)}}}function O(){let a=0;if(l.forEach(f=>{f.note.inReplyTo||(a+=1)}),a<10)try{C().then(f=>{console.debug("TIMELINE LENGTH: "+f),f>0&&O()})}catch(f){console.error(f)}}async function C(){let f=0;if(o&&e){let p=await o.get_timeline(ee,20,e);console.debug("WASM RESPONSE"),console.debug(p);try{let h=JSON.parse(String(p));console.debug(h);try{h.forEach(v=>{I(v)})}catch(v){console.error(v),console.debug(h)}return m(!0),console.log(x),console.info(K),ee+=20,h.length}catch(h){for(console.error(h),console.debug(p);f++<10;)await le(1e3),await C(),console.debug("RETRYING TIMELINE")}}else console.error("NO WASM OR VIEW YET"),await le(500),await C()}et(a=>{if(console.log(a),a.to&&a.to.route.id===null){let f=a.to.url.href;const p=/^https:\/\/(:?[a-zA-Z0-9\-]+)(:?\.[a-zA-Z0-9\-]+)+?\/@[a-zA-Z0-9_]+$/;f.match(p)&&(console.log(f),a.cancel(),tt(`/search?actor=${f}`))}});async function g(a){if(console.log(a),a.target){let f=a.target.dataset.view;f&&(Array.from(document.getElementsByTagName("header")[0].getElementsByTagName("nav")[0].getElementsByTagName("button")).forEach(p=>p.classList.remove("selected")),a.target.classList.add("selected"),e=f,Z(),await O())}}function B(a){console.debug("NOTE SELECT"),console.debug(a),r(2,ve=a.detail.replyToConversation),r(1,ge=a.detail.replyToNote),console.debug(`setting focusNote to ${a.detail.replyToNote}`),be=we(),oe=!0,console.debug("MESSAGE DETAIL"),console.debug(a.detail),i.handleReplyToMessage({detail:a.detail})}function w(){r(2,ve=null),r(1,ge=null),i.resetCompose(),le(500).then(()=>{const a=document.getElementsByTagName("main")[0];a.scrollTop=be}),oe=!1}async function d(){const a=document.getElementsByClassName("scrollable")[0];if(!he&&!oe){he=!0;let p=1;for(;!oe&&a.scrollTop+a.offsetHeight>=a.scrollHeight*.8&&p>0;)p=await C();he=!1}const f=document.getElementsByClassName("scroll")[0];if(a.scrollTop<50){z=!0;let p;for(;(p=re.shift())!==void 0;)I(p);f.style.display="none"}else z=!1,f.style.display="revert"}async function y(a){return o&&!q.has(a)&&q.set(a,await o.get_actor(a)),q.get(a)}async function P(a){return o&&!q.has(a)&&q.set(a,await o.get_note(a)),q.get(a)}async function S(a,f,p,h,v){if(o){let L=(await o.SendParams.new()).set_content(h).set_public();return L=L.set_attachments(JSON.stringify(v)),f&&(L=await L.add_recipient_id(String(a),!0),L=L.set_in_reply_to(String(f)),L=L.set_conversation(String(p))),await o.send_note(L)}else return!1}function Z(){re=[],x=new Map,K=new Map,ee=0,r(3,l=new Map),T=new Set,be=we();const a=document.getElementsByClassName("scroll")[0];a.style.display="none"}let z=!0,oe=!1,re=[],x=new Map,K=new Map,he=!1,ee=0,q=new Map,me=c.username,ge=null,ve=null,be=0;function We(a){qe[a?"unshift":"push"](()=>{i=a,r(0,i)})}return t.$$.update=()=>{t.$$.dirty[0]&16384&&r(12,o=s),t.$$.dirty[0]&8192&&c.avatar,t.$$.dirty[0]&4096&&o&&O()},e="",r(3,l=new Map),[i,ge,ve,l,E,k,A,g,B,w,S,me,o,c,s,We]}class Jt extends Qe{constructor(n){super(),Xe(this,n,Ct,At,Fe,{},null,[-1,-1])}}export{Jt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["../chunks/index.aMiLl7Je.js","../chunks/_commonjsHelpers.5-cIlDoe.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}