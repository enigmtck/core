import{s as ke,f as p,a as M,g as h,h as T,u as G,c as O,d as m,j as f,i as j,v as u,D as J,E as R,G as q,w as ie,O as we,o as ye,x as ne,l as oe,K as Ie,m as re,L as Ee,n as fe,F as Z}from"../chunks/scheduler.tnyNm5U0.js";import{S as Fe,i as Ce}from"../chunks/index.R_ElRwcJ.js";import{p as Se}from"../chunks/stores.9cqK4bRg.js";import{g as Te}from"../chunks/navigation.Aa8VnD0g.js";import{e as De,a as ce}from"../chunks/stores.bABpd-zC.js";import{g as ue}from"../chunks/common.DsDv12mj.js";function de(s){let e,l,t,i,c,o,a,d,g=s[3].name+"",U,W,D,N=s[3].url+"",V,P,H,A,n,x,_,b,k,B,K,z,Q=s[3].summary+"",w=s[3].image&&me(s),y=s[3].icon&&pe(s),I=!s[0]&&!s[2]&&!s[1]&&he(s),E=(s[0]||s[2])&&_e(s),F=s[3].ephemeralFollowing===void 0&&ve(s),S=s[3].ephemeralFollowing!==void 0&&!s[3].ephemeralFollowing&&ge(),C=s[3].ephemeralFollowing!==void 0&&s[3].ephemeralFollowing&&be(s);return{c(){e=p("div"),l=p("div"),w&&w.c(),t=M(),i=p("div"),c=p("div"),y&&y.c(),o=M(),a=p("div"),d=p("span"),U=oe(g),W=M(),D=p("a"),V=oe(N),H=M(),A=p("div"),n=p("ul"),I&&I.c(),x=M(),E&&E.c(),_=M(),F&&F.c(),b=M(),S&&S.c(),k=M(),C&&C.c(),B=M(),K=p("div"),z=new Ie(!1),this.h()},l(r){e=h(r,"DIV",{class:!0});var v=T(e);l=h(v,"DIV",{class:!0});var $=T(l);w&&w.l($),$.forEach(m),t=O(v),i=h(v,"DIV",{class:!0});var X=T(i);c=h(X,"DIV",{class:!0});var ee=T(c);y&&y.l(ee),ee.forEach(m),o=O(X),a=h(X,"DIV",{class:!0});var Y=T(a);d=h(Y,"SPAN",{class:!0});var le=T(d);U=re(le,g),le.forEach(m),W=O(Y),D=h(Y,"A",{href:!0,class:!0});var te=T(D);V=re(te,N),te.forEach(m),Y.forEach(m),X.forEach(m),H=O(v),A=h(v,"DIV",{class:!0});var se=T(A);n=h(se,"UL",{class:!0});var L=T(n);I&&I.l(L),x=O(L),E&&E.l(L),_=O(L),F&&F.l(L),b=O(L),S&&S.l(L),k=O(L),C&&C.l(L),L.forEach(m),se.forEach(m),B=O(v),K=h(v,"DIV",{class:!0});var ae=T(K);z=Ee(ae,!1),ae.forEach(m),v.forEach(m),this.h()},h(){f(l,"class","banner svelte-1eanlpx"),f(c,"class","avatar svelte-1eanlpx"),f(d,"class","svelte-1eanlpx"),f(D,"href",P=ue(s[3])),f(D,"class","svelte-1eanlpx"),f(a,"class","contact svelte-1eanlpx"),f(i,"class","identity svelte-1eanlpx"),f(n,"class","svelte-1eanlpx"),f(A,"class","controls svelte-1eanlpx"),z.a=null,f(K,"class","summary svelte-1eanlpx"),f(e,"class","profile svelte-1eanlpx")},m(r,v){j(r,e,v),u(e,l),w&&w.m(l,null),u(e,t),u(e,i),u(i,c),y&&y.m(c,null),u(i,o),u(i,a),u(a,d),u(d,U),u(a,W),u(a,D),u(D,V),u(e,H),u(e,A),u(A,n),I&&I.m(n,null),u(n,x),E&&E.m(n,null),u(n,_),F&&F.m(n,null),u(n,b),S&&S.m(n,null),u(n,k),C&&C.m(n,null),u(e,B),u(e,K),z.m(Q,K)},p(r,v){r[3].image?w?w.p(r,v):(w=me(r),w.c(),w.m(l,null)):w&&(w.d(1),w=null),r[3].icon?y?y.p(r,v):(y=pe(r),y.c(),y.m(c,null)):y&&(y.d(1),y=null),v&8&&g!==(g=r[3].name+"")&&fe(U,g),v&8&&N!==(N=r[3].url+"")&&fe(V,N),v&8&&P!==(P=ue(r[3]))&&f(D,"href",P),!r[0]&&!r[2]&&!r[1]?I?I.p(r,v):(I=he(r),I.c(),I.m(n,x)):I&&(I.d(1),I=null),r[0]||r[2]?E?E.p(r,v):(E=_e(r),E.c(),E.m(n,_)):E&&(E.d(1),E=null),r[3].ephemeralFollowing===void 0?F?F.p(r,v):(F=ve(r),F.c(),F.m(n,b)):F&&(F.d(1),F=null),r[3].ephemeralFollowing!==void 0&&!r[3].ephemeralFollowing?S||(S=ge(),S.c(),S.m(n,k)):S&&(S.d(1),S=null),r[3].ephemeralFollowing!==void 0&&r[3].ephemeralFollowing?C?C.p(r,v):(C=be(r),C.c(),C.m(n,null)):C&&(C.d(1),C=null),v&8&&Q!==(Q=r[3].summary+"")&&z.p(Q)},d(r){r&&m(e),w&&w.d(),y&&y.d(),I&&I.d(),E&&E.d(),F&&F.d(),S&&S.d(),C&&C.d()}}}function me(s){let e,l;return{c(){e=p("img"),this.h()},l(t){e=h(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Z(e.src,l=s[3].image.url)||f(e,"src",l),f(e,"alt","Banner"),f(e,"class","svelte-1eanlpx")},m(t,i){j(t,e,i)},p(t,i){i&8&&!Z(e.src,l=t[3].image.url)&&f(e,"src",l)},d(t){t&&m(e)}}}function pe(s){let e,l;return{c(){e=p("img"),this.h()},l(t){e=h(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Z(e.src,l=s[3].icon.url)||f(e,"src",l),f(e,"alt","Avatar"),f(e,"class","svelte-1eanlpx")},m(t,i){j(t,e,i)},p(t,i){i&8&&!Z(e.src,l=t[3].icon.url)&&f(e,"src",l)},d(t){t&&m(e)}}}function he(s){let e,l,t="Exchange Keys",i,c;return{c(){e=p("li"),l=p("button"),l.textContent=t,this.h()},l(o){e=h(o,"LI",{class:!0});var a=T(e);l=h(a,"BUTTON",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-1xj8rcg"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-1eanlpx"),f(e,"class","svelte-1eanlpx")},m(o,a){j(o,e,a),u(e,l),i||(c=J(l,"click",R(s[7])),i=!0)},p:q,d(o){o&&m(e),i=!1,c()}}}function _e(s){let e,l,t="Message",i,c;return{c(){e=p("li"),l=p("button"),l.textContent=t,this.h()},l(o){e=h(o,"LI",{class:!0});var a=T(e);l=h(a,"BUTTON",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-29nnst"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-1eanlpx"),f(e,"class","svelte-1eanlpx")},m(o,a){j(o,e,a),u(e,l),i||(c=J(l,"click",R(s[8])),i=!0)},p:q,d(o){o&&m(e),i=!1,c()}}}function ve(s){let e,l,t="Follow",i,c;return{c(){e=p("li"),l=p("button"),l.textContent=t,this.h()},l(o){e=h(o,"LI",{class:!0});var a=T(e);l=h(a,"BUTTON",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-1uh055h"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-1eanlpx"),f(e,"class","svelte-1eanlpx")},m(o,a){j(o,e,a),u(e,l),i||(c=J(l,"click",R(s[5])),i=!0)},p:q,d(o){o&&m(e),i=!1,c()}}}function ge(s){let e,l='<button class="svelte-1eanlpx">Pending</button>';return{c(){e=p("li"),e.innerHTML=l,this.h()},l(t){e=h(t,"LI",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-thka56"&&(e.innerHTML=l),this.h()},h(){f(e,"class","svelte-1eanlpx")},m(t,i){j(t,e,i)},d(t){t&&m(e)}}}function be(s){let e,l,t="Unfollow",i,c;return{c(){e=p("li"),l=p("button"),l.textContent=t,this.h()},l(o){e=h(o,"LI",{class:!0});var a=T(e);l=h(a,"BUTTON",{class:!0,"data-svelte-h":!0}),G(l)!=="svelte-zy8uxx"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-1eanlpx"),f(e,"class","svelte-1eanlpx")},m(o,a){j(o,e,a),u(e,l),i||(c=J(l,"click",R(s[6])),i=!0)},p:q,d(o){o&&m(e),i=!1,c()}}}function Le(s){let e,l,t='<label class="svelte-1eanlpx"><input type="text" id="address" name="address" placeholder="@address@server.url" class="svelte-1eanlpx"/></label>',i,c,o,a=s[3]&&de(s);return{c(){e=p("main"),l=p("form"),l.innerHTML=t,i=M(),a&&a.c(),this.h()},l(d){e=h(d,"MAIN",{class:!0});var g=T(e);l=h(g,"FORM",{id:!0,method:!0,class:!0,"data-svelte-h":!0}),G(l)!=="svelte-1m58q31"&&(l.innerHTML=t),i=O(g),a&&a.l(g),g.forEach(m),this.h()},h(){f(l,"id","profile"),f(l,"method","POST"),f(l,"class","svelte-1eanlpx"),f(e,"class","svelte-1eanlpx")},m(d,g){j(d,e,g),u(e,l),u(e,i),a&&a.m(e,null),c||(o=J(l,"submit",R(s[4])),c=!0)},p(d,[g]){d[3]?a?a.p(d,g):(a=de(d),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:q,o:q,d(d){d&&m(e),a&&a.d(),c=!1,o()}}}function Me(s,e,l){let t,i,c,o;ie(s,Se,_=>l(10,c=_)),ie(s,De,_=>l(11,o=_));let a,d=null;we(()=>{d&&d.close()}),ye(()=>(d=new EventSource("/api/user/"+x+"/events"),d.onmessage=_=>{console.log("event: "+_.data);let b=JSON.parse(_.data);if(console.log(b),b.uuid)t?.send_authorization(b.uuid);else if(b.type){let k=b;k.type=="Follow"&&k.object!==void 0&&String(k.object)==n?.id||k.type=="Accept"&&k.actor&&k.actor==n?.id?g():k.type=="Undo"&&k.object&&typeof k.object=="object"&&k.object.id==n?.ephemeralLeaderApId&&g().then(()=>{console.log("profile loaded")})}},()=>{d&&d.readyState===1&&d.close()}));async function g(){if(l(0,P=!1),l(1,H=!1),l(2,A=!1),l(3,n=null),i){const _=await t?.get_actor(i);_&&l(3,n=JSON.parse(_))}}async function U(_){let b=new FormData(_.target);console.log("looking up: "+b.get("address")),l(9,i=String(b.get("address"))),await g()}function W(_){n&&n.id?(console.log("following: "+n.id),t?.send_follow(n.id)):console.log("no profile loaded")}function D(_){n&&n.id?(console.log("unfollowing: "+n.id),t?.send_unfollow(n.id,String(n.ephemeralFollowActivityApId))):console.log("no profile loaded")}async function N(_){console.log(_);let b=t?.KexInitParams.new();if(t&&n&&n.id&&b){let k=(await t.get_state()).get_olm_pickled_account();console.log(k);let B=a(String(k));console.log("idk"),console.log(B),b.set_recipient_id(n.id),b.set_identity_key(String(B)),t?.send_kex_init(b).then(()=>{console.log("kexinit sent")})}}function V(_){console.log(_),n&&n.id&&Te(`/message?address=${n.id}`)}let P=!1,H=!1,A=!1,n=null,x=ne(ce).username;return ne(ce).display_name,s.$$.update=()=>{s.$$.dirty&2048&&(t=o),s.$$.dirty&1024&&l(9,i=c.url.searchParams.get("actor")),s.$$.dirty&512&&i&&g().then(()=>{console.debug("LOADED")})},[P,H,A,n,U,W,D,N,V,i,c,o]}class Ve extends Fe{constructor(e){super(),Ce(this,e,Me,Le,ke,{})}}export{Ve as component};
