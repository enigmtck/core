import"../chunks/CWj6FrbW.js";import"../chunks/BfK2I2Fg.js";import{p as I,l as j,i as L,j as b,m as g,n as q,v as e,r as v,t as S,q as C,u as N,ae as F,ad as G,z as k,D as U}from"../chunks/iAwc3qQu.js";import{i as x}from"../chunks/BeCdKdsH.js";import{D as _,a as V,e as B,i as H,c as A}from"../chunks/y_H1LLdF.js";import{i as K}from"../chunks/CmZ756AE.js";import{s as Q,a as z}from"../chunks/CTRaWkmf.js";import{p as X}from"../chunks/CH6Mh4UC.js";import{A as Y,R as Z}from"../chunks/ZP8CHS7V.js";import{e as ee}from"../chunks/BjbtEI9d.js";var ae=b('<div class="replies svelte-zu9b5f"></div>'),te=b("<!> <!>",1),oe=b('<main class="svelte-zu9b5f"><!></main>');function de(D,E){I(E,!1);const h=()=>z(ee,"$enigmatickWasm",w),m=()=>z(X,"$page",w),[w,R]=Q(),t=S();async function J(){if(e(t)){console.log("LOADING PROFILE");let r=await(await fetch("/objects/"+m().url.searchParams.get("uuid"),{headers:{Accept:"application/activity+json"}})).json(),c=await e(t).get_actor(r.attributedTo);if(c){const p=JSON.parse(c);if(v(o,new _(p,r)),console.log(e(o)),r.conversation){const f=V(r.conversation);if(f){let n=await e(t).get_local_conversation(f);if(n){const s=JSON.parse(n);let l=new Map;for(const i of s)if(i.id&&i.id!=r.id){const O=i.attributedTo;if(typeof O=="string"){let $=await e(t).get_actor(O);if($){const W=JSON.parse($);l.set(String(i.id),new _(W,i)),v(o,new _(p,r,void 0,l))}}}console.info(l)}}}}}}function y(){console.debug("REMOVE")}let o=S(null),u=new Map;async function M(a){return e(t)&&!u.has(a)&&u.set(a,await e(t).get_note(a)),u.get(a)}j(()=>h(),()=>{v(t,h())}),j(()=>(e(t),m()),()=>{e(t)&&m().url.searchParams.get("uuid")&&(async()=>{try{await J(),console.log("loadObject")}catch(a){console.error("Error loading object:",a)}})()}),L(),K();var d=oe(),P=C(d);{var T=a=>{var r=te(),c=F(r);Y(c,{remove:y,get note(){return e(o)},cachedNote:M});var p=G(c,2);{var f=n=>{var s=ae();B(s,5,()=>(e(o),U(A),k(()=>Array.from(e(o).replies.values()).sort(A))),H,(l,i)=>{Z(l,{get note(){return e(i)},username:null,remove:y})}),N(s),g(n,s)};x(p,n=>{e(o),k(()=>{var s;return(s=e(o).replies)==null?void 0:s.size})&&n(f)})}g(a,r)};x(P,a=>{e(t)&&e(o)&&a(T)})}N(d),g(D,d),q(),R()}export{de as component};
