import{_ as We}from"../chunks/preload-helper.0HuHagjb.js";import{s as Fe,a as F,f as V,c as G,g as J,h as Y,u as se,d as C,j,i as z,v as U,D as ne,I as Pe,M as Ue,w as Le,o as Ge,G as b,e as X,E as Ze,p as qe,J as Ve}from"../chunks/scheduler.tnyNm5U0.js";import{h as ae,u as Je,R as Ye,A as Ke}from"../chunks/Article.yc8txHN0.js";import{e as ie}from"../chunks/each.-oqiv04n.js";import{S as Qe,i as Xe,b as Te,d as Se,m as ke,a as I,c as de,t as D,e as Oe,g as pe}from"../chunks/index.R_ElRwcJ.js";import{C as xe}from"../chunks/Compose.qy77mOn2.js";import{b as et,g as tt}from"../chunks/navigation.Xn9zHXao.js";import{a as nt,e as ot}from"../chunks/stores.bABpd-zC.js";import{r as ce}from"../chunks/index.R4pWNgh9.js";import{c as ue,D as rt,s as le,i as Ae}from"../chunks/common.zKe3wBQm.js";async function lt(t,n){const r=t.getReader();let e;for(;!(e=await r.read()).done;)n(e.value)}function st(t){let n,r,e,o=!1;return function(c){n===void 0?(n=c,r=0,e=-1):n=it(n,c);const s=n.length;let i=0;for(;r<s;){o&&(n[r]===10&&(i=++r),o=!1);let u=-1;for(;r<s&&u===-1;++r)switch(n[r]){case 58:e===-1&&(e=r-i);break;case 13:o=!0;case 10:u=r;break}if(u===-1)break;t(n.subarray(i,u),e),i=r,e=-1}i===s?n=void 0:i!==0&&(n=n.subarray(i),r-=i)}}function at(t,n,r){let e=Ce();const o=new TextDecoder;return function(c,s){if(c.length===0)r?.(e),e=Ce();else if(s>0){const i=o.decode(c.subarray(0,s)),u=s+(c[s+1]===32?2:1),_=o.decode(c.subarray(u));switch(i){case"data":e.data=e.data?e.data+`
`+_:_;break;case"event":e.event=_;break;case"id":t(e.id=_);break;case"retry":const T=parseInt(_,10);isNaN(T)||n(e.retry=T);break}}}}function it(t,n){const r=new Uint8Array(t.length+n.length);return r.set(t),r.set(n,t.length),r}function Ce(){return{data:"",event:"",id:"",retry:void 0}}var ct=function(t,n){var r={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.indexOf(e)<0&&(r[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,e=Object.getOwnPropertySymbols(t);o<e.length;o++)n.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(t,e[o])&&(r[e[o]]=t[e[o]]);return r};const ye="text/event-stream",ut=1e3,Ne="last-event-id";function ft(t,n){var{signal:r,headers:e,onopen:o,onmessage:l,onclose:c,onerror:s,openWhenHidden:i,fetch:u}=n,_=ct(n,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((T,R)=>{const m=Object.assign({},e);m.accept||(m.accept=ye);let E;function k(){E.abort(),document.hidden||g()}i||document.addEventListener("visibilitychange",k);let L=ut,H=0;function M(){document.removeEventListener("visibilitychange",k),window.clearTimeout(H),E.abort()}r?.addEventListener("abort",()=>{M(),T()});const O=u??window.fetch,N=o??dt;async function g(){var $;E=new AbortController;try{const w=await O(t,Object.assign(Object.assign({},_),{headers:m,signal:E.signal}));await N(w),await lt(w.body,st(at(d=>{d?m[Ne]=d:delete m[Ne]},d=>{L=d},l))),c?.(),M(),T()}catch(w){if(!E.signal.aborted)try{const d=($=s?.(w))!==null&&$!==void 0?$:L;window.clearTimeout(H),H=window.setTimeout(g,d)}catch(d){M(),R(d)}}}g()})}function dt(t){const n=t.headers.get("content-type");if(!n?.startsWith(ye))throw new Error(`Expected content-type to be ${ye}, Actual: ${n}`)}const fe=typeof document<"u",pt=0,ht=1,te=2;function mt({resource:t,options:n,onIdFound:r}){const e=new Map;let o=pt;const l=new AbortController,c=!0,s=n?{...n}:{};async function i(){fe&&(await ft(`${t}`,{openWhenHidden:c,...s,method:"POST",async onopen({headers:m}){if(!r)return;const E=m.get("x-sse-id");E&&r(E??"")},onmessage({id:m,event:E,data:k}){R({id:m,event:E,data:k})},onclose(){o=te,T({})},onerror(m){o=te,_(m)},signal:l.signal}),o=ht)}function u({reason:m}){l.abort(m),o=te,T({})}function _({error:m}){const E=e.get("error")??[];for(const k of E)k({id:"",event:"",data:"",error:m,connect:i,close:u})}function T({error:m}){const E=e.get("close")??[];for(const k of E)k({id:"",event:"",data:"",error:m,connect:i,close:u})}function R({id:m,event:E,data:k}){const L=decodeURIComponent(k),H=e.get(E)??[];for(const M of H)M({id:m,event:E,data:L,connect:i,close:u})}return i(),{get url(){return`${t}`},get readyState(){return o},addEventListener(m,E){e.has(m)||e.set(m,[]),(e.get(m)??[]).push(E)},removeEventListener(m,E){if(!e.has(m))return;const L=(e.get(m)??[]).filter(function(M){return M!==E});e.set(m,L)},close:u}}const Q=new Map;async function Ee({resource:t}){const n=`${t}`,r=Q.get(n);if(r){const{eventSource:e}=r;e.readyState!==te&&(r.eventSource.close({}),r.stopBeacon()),r.connectionsCounter--,r.connectionsCounter<0&&(r.connectionsCounter=0),r.connectionsCounter===0&&Q.delete(n)}}function gt({resource:t,beacon:n=5e3,options:r={}}){const e=`${t}`;if(!Q.has(e)){let s=!1;const i=mt({resource:t,beacon:n,options:r,onIdFound(T){n<=0||(s=setInterval(function(){navigator.sendBeacon(t.toString()+"?"+T)},n))}}),u=function(){s&&clearInterval(s)};i.addEventListener("close",u),i.addEventListener("error",u);const _={resource:t,eventSource:i,connectionsCounter:0,stopBeacon:u};return Q.set(e,_),_}const o=Q.get(e);if(!o)throw new Error(`Could not find reference for ${e}.`);const{eventSource:l,stopBeacon:c}=o;if(l.readyState===te){const s={resource:t,eventSource:l,connectionsCounter:0,stopBeacon:c};return Q.set(e,s),s}return o.connectionsCounter<0?o.connectionsCounter=1:o.connectionsCounter++,o}function vt({connected:t,eventName:n,readables:r,state:e}){const{eventSource:o,resource:l}=t;return ce("",function(s){function i(u){s(u.data)}return o.addEventListener(n,i),async function(){e.eventsCounter--,await Ee({resource:l}),o.removeEventListener(n,i),r.delete(n)}})}function _t({connected:t,eventName:n}){return function(e){if(!fe)return ce("");const{eventSource:o}=t,l=new ReadableStream({start(c){o.addEventListener(n,function(i){c.enqueue(i.data)})}});return e(l)}}function bt({error:t,previous:n}){return console.error(t),n}function yt(t,{close:n,error:r,beacon:e=5e3,options:o={}}={}){let l={eventsCounter:0},c=new Map;const s=gt({resource:t,beacon:e,options:o}),{eventSource:i}=s;return r&&i.addEventListener("error",r),n&&i.addEventListener("close",n),{close(){return fe?Ee({resource:t}):Promise.resolve()},select(u){if(u.includes(`
`))throw new Error(`The name of the event must not contain new line characters, received "${u}"`);const _=typeof u;if(_!=="string")throw new Error(`Event name must be of type \`string\`, received \`${_}\`.`);c.has(u)||c.set(u,vt({connected:s,eventName:u,readables:c,state:l})),l.eventsCounter++;const T=c.get(u);if(!T)throw new Error(`Could not find event ${u}.`);return{subscribe:T.subscribe,transform:_t({connected:s,eventName:u}),json(R=bt){return fe?this.transform(function(k){let L=null;const H=k.getReader();return ce(L,function(O){const N=async function(){try{const{done:$,value:w}=await H.read();if($)return;try{L=JSON.parse(w),O(L)}catch(d){O(R({previous:L,raw:w,error:d}))}N()}catch($){O(R({previous:L,raw:"",error:$}))}};return N(),function(){Ee({resource:t}),H.cancel()}})}):ce(null)}}}}}function Ie(t,n,r){const e=t.slice();return e[40]=n[r],e}function Me(t,n,r){const e=t.slice();return e[43]=n[r],e}function Et(t){let n,r='<i class="fa-solid fa-house svelte-1ae825j"></i>Home',e,o,l='<i class="fa-solid fa-city svelte-1ae825j"></i>Local',c,s;return{c(){n=V("button"),n.innerHTML=r,e=F(),o=V("button"),o.innerHTML=l,this.h()},l(i){n=J(i,"BUTTON",{class:!0,"data-view":!0,"data-svelte-h":!0}),se(n)!=="svelte-e533dz"&&(n.innerHTML=r),e=G(i),o=J(i,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),se(o)!=="svelte-bi7xl3"&&(o.innerHTML=l),this.h()},h(){j(n,"class","selected svelte-1ae825j"),j(n,"data-view","home"),j(o,"data-view","local"),j(o,"class","svelte-1ae825j")},m(i,u){z(i,n,u),z(i,e,u),z(i,o,u),c||(s=[ne(n,"click",t[7]),ne(o,"click",t[7])],c=!0)},p:b,d(i){i&&(C(n),C(e),C(o)),c=!1,Ue(s)}}}function He(t){let n,r,e,o,l={ctx:t,current:null,token:null,hasCatch:!1,pending:Rt,then:Tt,catch:wt,value:46,blocks:[,,,]};ae(n=t[5](t[40].note),l);let c=t[40].note.id==t[1]&&t[40].replies?.size&&je(t);return{c(){l.block.c(),r=F(),c&&c.c(),e=X()},l(s){l.block.l(s),r=G(s),c&&c.l(s),e=X()},m(s,i){l.block.m(s,l.anchor=i),l.mount=()=>r.parentNode,l.anchor=r,z(s,r,i),c&&c.m(s,i),z(s,e,i),o=!0},p(s,i){t=s,l.ctx=t,i[0]&8&&n!==(n=t[5](t[40].note))&&ae(n,l)||Je(l,t,i),t[40].note.id==t[1]&&t[40].replies?.size?c?(c.p(t,i),i[0]&10&&I(c,1)):(c=je(t),c.c(),I(c,1),c.m(e.parentNode,e)):c&&(pe(),D(c,1,1,()=>{c=null}),de())},i(s){o||(I(l.block),I(c),o=!0)},o(s){for(let i=0;i<3;i+=1){const u=l.blocks[i];D(u)}D(c),o=!1},d(s){s&&(C(r),C(e)),l.block.d(s),l.token=null,l=null,c&&c.d(s)}}}function wt(t){return{c:b,l:b,m:b,p:b,i:b,o:b,d:b}}function Tt(t){let n,r,e,o={ctx:t,current:null,token:null,hasCatch:!1,pending:Ot,then:kt,catch:St,value:47,blocks:[,,,]};return ae(r=t[6](t[40].note),o),{c(){n=X(),o.block.c()},l(l){n=X(),o.block.l(l)},m(l,c){z(l,n,c),o.block.m(l,o.anchor=c),o.mount=()=>n.parentNode,o.anchor=n,e=!0},p(l,c){t=l,o.ctx=t,c[0]&8&&r!==(r=t[6](t[40].note))&&ae(r,o)||Je(o,t,c)},i(l){e||(I(o.block),e=!0)},o(l){for(let c=0;c<3;c+=1){const s=o.blocks[c];D(s)}e=!1},d(l){l&&C(n),o.block.d(l),o.token=null,o=null}}}function St(t){return{c:b,l:b,m:b,p:b,i:b,o:b,d:b}}function kt(t){let n,r;return n=new Ke({props:{remove:Ct,refresh:At,note:t[40],username:t[11],replyToHeader:t[46],announceHeader:t[47],renderAction:t[4]}}),n.$on("reply_to",function(){Ve(t[0].handleReplyToMessage)&&t[0].handleReplyToMessage.apply(this,arguments)}),n.$on("note_select",t[8]),{c(){Te(n.$$.fragment)},l(e){Se(n.$$.fragment,e)},m(e,o){ke(n,e,o),r=!0},p(e,o){t=e;const l={};o[0]&8&&(l.note=t[40]),o[0]&8&&(l.replyToHeader=t[46]),o[0]&8&&(l.announceHeader=t[47]),n.$set(l)},i(e){r||(I(n.$$.fragment,e),r=!0)},o(e){D(n.$$.fragment,e),r=!1},d(e){Oe(n,e)}}}function Ot(t){return{c:b,l:b,m:b,p:b,i:b,o:b,d:b}}function Rt(t){return{c:b,l:b,m:b,p:b,i:b,o:b,d:b}}function je(t){let n,r,e,o=ie(Array.from(t[40].replies.values()).sort(ue)),l=[];for(let s=0;s<o.length;s+=1)l[s]=De(Me(t,o,s));const c=s=>D(l[s],1,1,()=>{l[s]=null});return{c(){n=V("div");for(let s=0;s<l.length;s+=1)l[s].c();r=F(),this.h()},l(s){n=J(s,"DIV",{class:!0});var i=Y(n);for(let u=0;u<l.length;u+=1)l[u].l(i);r=G(i),i.forEach(C),this.h()},h(){j(n,"class","replies svelte-1ae825j")},m(s,i){z(s,n,i);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(n,null);U(n,r),e=!0},p(s,i){if(i[0]&2313){o=ie(Array.from(s[40].replies.values()).sort(ue));let u;for(u=0;u<o.length;u+=1){const _=Me(s,o,u);l[u]?(l[u].p(_,i),I(l[u],1)):(l[u]=De(_),l[u].c(),I(l[u],1),l[u].m(n,r))}for(pe(),u=o.length;u<l.length;u+=1)c(u);de()}},i(s){if(!e){for(let i=0;i<o.length;i+=1)I(l[i]);e=!0}},o(s){l=l.filter(Boolean);for(let i=0;i<l.length;i+=1)D(l[i]);e=!1},d(s){s&&C(n),Pe(l,s)}}}function De(t){let n,r;return n=new Ye({props:{note:t[43],username:t[11]}}),n.$on("reply_to",function(){Ve(t[0].handleReplyToMessage)&&t[0].handleReplyToMessage.apply(this,arguments)}),n.$on("note_select",t[8]),{c(){Te(n.$$.fragment)},l(e){Se(n.$$.fragment,e)},m(e,o){ke(n,e,o),r=!0},p(e,o){t=e;const l={};o[0]&8&&(l.note=t[43]),n.$set(l)},i(e){r||(I(n.$$.fragment,e),r=!0)},o(e){D(n.$$.fragment,e),r=!1},d(e){Oe(n,e)}}}function $e(t){let n,r,e=t[40].note&&(!t[1]&&(!t[40].note.inReplyTo||t[40].note.ephemeralAnnounces?.length)||t[40].note.id==t[1])&&He(t);return{c(){e&&e.c(),n=X()},l(o){e&&e.l(o),n=X()},m(o,l){e&&e.m(o,l),z(o,n,l),r=!0},p(o,l){o[40].note&&(!o[1]&&(!o[40].note.inReplyTo||o[40].note.ephemeralAnnounces?.length)||o[40].note.id==o[1])?e?(e.p(o,l),l[0]&10&&I(e,1)):(e=He(o),e.c(),I(e,1),e.m(n.parentNode,n)):e&&(pe(),D(e,1,1,()=>{e=null}),de())},i(o){r||(I(e),r=!0)},o(o){D(e),r=!1},d(o){o&&C(n),e&&e.d(o)}}}function Be(t){let n,r,e,o;return{c(){n=V("div"),r=V("i"),this.h()},l(l){n=J(l,"DIV",{class:!0});var c=Y(n);r=J(c,"I",{class:!0}),Y(r).forEach(C),c.forEach(C),this.h()},h(){j(r,"class","fa-solid fa-angles-left svelte-1ae825j"),j(n,"class","back svelte-1ae825j")},m(l,c){z(l,n,c),U(n,r),e||(o=ne(r,"click",Ze(t[9])),e=!0)},p:b,d(l){l&&C(n),e=!1,o()}}}function Lt(t){let n,r,e,o,l,c,s,i='<i class="fa-solid fa-globe svelte-1ae825j"></i>Global',u,_,T,R,m='<i class="fa-solid fa-chevron-up svelte-1ae825j"></i>',E,k,L,H,M={sender:t[10]};n=new xe({props:M}),t[15](n);let O=t[11]&&Et(t),N=ie(Array.from(t[3].values()).sort(ue).reverse()),g=[];for(let d=0;d<N.length;d+=1)g[d]=$e(Ie(t,N,d));const $=d=>D(g[d],1,1,()=>{g[d]=null});let w=(t[1]||t[2])&&Be(t);return{c(){Te(n.$$.fragment),r=F(),e=V("main"),o=V("header"),l=V("nav"),O&&O.c(),c=F(),s=V("button"),s.innerHTML=i,u=F(),_=V("div");for(let d=0;d<g.length;d+=1)g[d].c();T=F(),R=V("div"),R.innerHTML=m,E=F(),w&&w.c(),this.h()},l(d){Se(n.$$.fragment,d),r=G(d),e=J(d,"MAIN",{class:!0});var y=Y(e);o=J(y,"HEADER",{class:!0});var B=Y(o);l=J(B,"NAV",{class:!0});var S=Y(l);O&&O.l(S),c=G(S),s=J(S,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),se(s)!=="svelte-v94doe"&&(s.innerHTML=i),S.forEach(C),B.forEach(C),u=G(y),_=J(y,"DIV",{class:!0});var Z=Y(_);for(let W=0;W<g.length;W+=1)g[W].l(Z);Z.forEach(C),T=G(y),R=J(y,"DIV",{class:!0,"data-svelte-h":!0}),se(R)!=="svelte-14v484t"&&(R.innerHTML=m),E=G(y),w&&w.l(y),y.forEach(C),this.h()},h(){j(s,"data-view","global"),j(s,"class","svelte-1ae825j"),j(l,"class","svelte-1ae825j"),j(o,"class","svelte-1ae825j"),j(_,"class","scrollable svelte-1ae825j"),j(R,"class","scroll svelte-1ae825j"),j(e,"class","svelte-1ae825j")},m(d,y){ke(n,d,y),z(d,r,y),z(d,e,y),U(e,o),U(o,l),O&&O.m(l,null),U(l,c),U(l,s),U(e,u),U(e,_);for(let B=0;B<g.length;B+=1)g[B]&&g[B].m(_,null);U(e,T),U(e,R),U(e,E),w&&w.m(e,null),k=!0,L||(H=[ne(s,"click",t[7]),ne(R,"click",we)],L=!0)},p(d,y){const B={};if(n.$set(B),d[11]&&O.p(d,y),y[0]&2427){N=ie(Array.from(d[3].values()).sort(ue).reverse());let S;for(S=0;S<N.length;S+=1){const Z=Ie(d,N,S);g[S]?(g[S].p(Z,y),I(g[S],1)):(g[S]=$e(Z),g[S].c(),I(g[S],1),g[S].m(_,null))}for(pe(),S=N.length;S<g.length;S+=1)$(S);de()}d[1]||d[2]?w?w.p(d,y):(w=Be(d),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i(d){if(!k){I(n.$$.fragment,d);for(let y=0;y<N.length;y+=1)I(g[y]);k=!0}},o(d){D(n.$$.fragment,d),g=g.filter(Boolean);for(let y=0;y<g.length;y+=1)D(g[y]);k=!1},d(d){d&&(C(r),C(e)),t[15](null),Oe(n,d),O&&O.d(),Pe(g,d),w&&w.d(),L=!1,Ue(H)}}}function be(t){if(t)try{return JSON.parse(t)}catch{return console.error("UNABLE TO PARSE PROFILE"),console.debug(t),null}else return console.error("UNABLE TO PARSE NULL OR UNDEFINED"),null}function we(){const t=document.getElementsByClassName("scrollable")[0];let n=t.scrollTop;return t.scrollTop=0,n}function At(){console.debug("REFRESH")}function Ct(){console.debug("REMOVE")}function Nt(t,n,r){let e,o,l,c,s;Le(t,nt,a=>r(13,c=a)),Le(t,ot,a=>r(14,s=a));let i,u=null,_=null,T=new Set;function R(a){for(let f of a)if(f.isIntersecting&&f.target){let p=f.target;if(p.dataset){let h=p.dataset;if(console.log(h.conversation),o&&h.conversation){let v=h.conversation;T.has(v)||(T.add(v),o.get_conversation(h.conversation,0,50).then(A=>{if(A){let P=JSON.parse(A);P.forEach(Re=>{Re.inReplyTo&&M(Re)}),console.log(P),m(!0)}}))}}}}function m(a){new Map(K).forEach((p,h)=>{p.note.inReplyTo&&(l.has(p.note.inReplyTo)?(K.delete(h),H(p)):a&&K.has(p.note.inReplyTo)&&m(!1))})}function E(a){_&&_.observe(a)}Ge(async()=>{const{Buffer:a}=await We(()=>import("../chunks/index.aMiLl7Je.js").then(p=>p.i),__vite__mapDeps([0,1]),import.meta.url);window.Buffer=a;let f=document.getElementsByClassName("scrollable")[0];_=new IntersectionObserver(R,{root:null,threshold:.3}),f&&f.addEventListener("scroll",d),me?(e="home",yt("/api/user/"+me+"/events",{close({connect:p}){console.log("event stream closed"),le(500).then(()=>{p()})}}).select("message").subscribe(p=>{if(p)try{let h=JSON.parse(p);if(console.log(h),h.type==="Note"){let v=h;W||v.inReplyTo?M(v):re.push(v),ee+=1}else if(o&&h.uuid)u=h.uuid,o.send_authorization(u).then(v=>{console.info(`AUTHORIZATION SENT FOR ${u}`)});else if(o&&h.type=="Announce"){let v=h;o.get_note(v.object).then(A=>{try{let P=JSON.parse(String(A));P.ephemeralAnnounces=[v.actor],P.id=v.id,P.published=v.published,P.ephemeralTimestamp=v.published,W?M(P):re.push(P),ee+=1}catch{console.error("FAILED TO ADD NOTE"),console.error(A)}})}}catch{console.error("FAILED TO PARSE SSE MESSAGE"),console.error(p)}})):e="global"});async function k(a){if(a.inReplyTo){const f=await B(a.inReplyTo);if(f){const p=JSON.parse(String(f)),h=await y(p.attributedTo),v=be(h);return v&&o?Ae(o,v.name||v.preferredUsername,v):null}else return null}else return null}async function L(a){if(a.ephemeralAnnounces){const f=await y(a.ephemeralAnnounces[0]);let p="";if(a.ephemeralAnnounces.length==2?p=` and ${a.ephemeralAnnounces.length-1} other`:a.ephemeralAnnounces.length>2&&(p=` and ${a.ephemeralAnnounces.length-1} others`),f){const h=be(f);if(h&&o){const v=Ae(o,h.name||h.preferredUsername,h);return{url:h.url,name:v,others:p}}else return null}else return null}else return null}function H(a){const f=a.note;if(f.inReplyTo){let p=x.get(String(f.inReplyTo));if(p){let h=l.get(p[0]);if(p.forEach((v,A,P)=>{A>0&&(h=h?.replies.get(v))}),h?.note.id==f.inReplyTo){h.replies.set(String(f.id),a);let v=[...p];v.push(String(f.id)),x.set(String(f.id),v)}else console.error("TRAVERSAL ENDED SOMEWHERE UNEXPECTED")}else a.note.id&&K.set(a.note.id,a)}else l.get(String(f.id))||(l.set(String(f.id),a),x.set(String(f.id),[String(f.id)]))}async function M(a){if(a.ephemeralActors&&a.ephemeralActors.forEach(f=>{f.id&&q.set(f.id,JSON.stringify(f))}),a.ephemeralLikes&&(console.debug("EPHEMERAL LIKES"),console.debug(a.ephemeralLikes)),a.attributedTo){const f=await y(a.attributedTo);if(f){const p=be(f);if(p){const h=new rt(p,a);H(h)}r(3,l)}}}function O(){let a=0;if(l.forEach(f=>{f.note.inReplyTo||(a+=1)}),a<10)try{N().then(f=>{console.debug("TIMELINE LENGTH: "+f),f>0&&O()})}catch(f){console.error(f)}}async function N(){let f=0;if(o&&e){let p=await o.get_timeline(ee,50,e);try{let h=JSON.parse(String(p));console.debug(h);try{h.forEach(v=>{M(v)})}catch(v){console.error(v),console.debug(h)}return m(!0),console.log(x),console.info(K),ee+=50,h.length}catch(h){for(console.error(h),console.debug(p);f++<10;)await le(1e3),await N(),console.debug("RETRYING TIMELINE")}}else console.error("NO WASM OR VIEW YET"),await le(500),await N()}et(a=>{if(console.log(a),a.to&&a.to.route.id===null){let f=a.to.url.href;const p=/^https:\/\/(:?[a-zA-Z0-9\-]+)(:?\.[a-zA-Z0-9\-]+)+?\/@[a-zA-Z0-9_]+$/;f.match(p)&&(console.log(f),a.cancel(),tt(`/search?actor=${f}`))}});async function g(a){if(console.log(a),a.target){let f=a.target.dataset.view;f&&(Array.from(document.getElementsByTagName("header")[0].getElementsByTagName("nav")[0].getElementsByTagName("button")).forEach(p=>p.classList.remove("selected")),a.target.classList.add("selected"),e=f,Z(),await O())}}function $(a){console.debug("NOTE SELECT"),console.debug(a),r(2,ve=a.detail.conversation),r(1,ge=a.detail.note),_e=we(),oe=!0}function w(){r(2,ve=null),r(1,ge=null),le(500).then(()=>{const a=document.getElementsByTagName("main")[0];a.scrollTop=_e}),oe=!1}async function d(){const a=document.getElementsByClassName("scrollable")[0];if(!he&&!oe){he=!0;let p=1;for(;!oe&&a.scrollTop+a.offsetHeight>=a.scrollHeight*.8&&p>0;)p=await N();he=!1}const f=document.getElementsByClassName("scroll")[0];if(a.scrollTop<50){W=!0;let p;for(;(p=re.shift())!==void 0;)M(p);f.style.display="none"}else W=!1,f.style.display="revert"}async function y(a){return o&&!q.has(a)&&q.set(a,await o.get_actor(a)),q.get(a)}async function B(a){return o&&!q.has(a)&&q.set(a,await o.get_note(a)),q.get(a)}async function S(a,f,p,h,v){if(o){let A=(await o.SendParams.new()).set_content(h).set_public();return A=A.set_attachments(JSON.stringify(v)),f&&(A=await A.add_recipient_id(String(a),!0),A=A.set_in_reply_to(String(f)),A=A.set_conversation(String(p))),await o.send_note(A)}else return!1}function Z(){re=[],x=new Map,K=new Map,ee=0,r(3,l=new Map),T=new Set,_e=we();const a=document.getElementsByClassName("scroll")[0];a.style.display="none"}let W=!0,oe=!1,re=[],x=new Map,K=new Map,he=!1,ee=0,q=new Map,me=c.username,ge=null,ve=null,_e=0;function ze(a){qe[a?"unshift":"push"](()=>{i=a,r(0,i)})}return t.$$.update=()=>{t.$$.dirty[0]&16384&&r(12,o=s),t.$$.dirty[0]&8192&&c.avatar,t.$$.dirty[0]&4096&&o&&O()},e="",r(3,l=new Map),[i,ge,ve,l,E,k,L,g,$,w,S,me,o,c,s,ze]}class Jt extends Qe{constructor(n){super(),Xe(this,n,Nt,Lt,Fe,{},null,[-1,-1])}}export{Jt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["../chunks/index.aMiLl7Je.js","../chunks/_commonjsHelpers.5-cIlDoe.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}