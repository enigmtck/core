import"../chunks/CWj6FrbW.js";import{aW as Lt,g as Ht,h as Bt,a4 as zt,aw as Rt,aL as Ye,p as Ve,I as Je,E as e,aJ as G,A as i,aC as C,S as $e,w as p,aH as z,aI as N,z as S,D as y,y as v,a as Ze,aM as de,aE as re,aO as Kt,aG as Pe,x as ze,aN as pt,o as Xt}from"../chunks/CPBLXjHw.js";import{i as _}from"../chunks/DQNDscH3.js";import{C as Yt,P as Vt,h as Ue,s as Zt,a as qt}from"../chunks/B4BXaNBM.js";import{s as Ce}from"../chunks/BjYZIULF.js";import{s as Re,c as Ke}from"../chunks/DSGZP5v2.js";import{b as Oe}from"../chunks/CD7duDpS.js";import{a as We,s as qe}from"../chunks/DmKqPpxj.js";import{p as Gt}from"../chunks/DfJuBoyc.js";import{a as yt,e as Ge}from"../chunks/CS4B0N_g.js";import{f as Xe,D as rt,d as Qt,i as Le,b as He,t as ea,c as nt,g as kt,h as ta,j as aa,k as bt}from"../chunks/CR2iVpIj.js";import{e as ot,i as xt}from"../chunks/J1mst6rE.js";import{g as St,b as ra}from"../chunks/2w9f54dl.js";import{F as na,s as oa}from"../chunks/663Jjc3J.js";import{A as la}from"../chunks/ClYLzRSr.js";import{H as sa}from"../chunks/CKBTCsS-.js";function ia(Te,$,be){Bt&&zt();var je=new Rt(Te),K=!Lt();Ht(()=>{var I=$();K&&I!==null&&typeof I=="object"&&(I={}),je.ensure(I,be)})}var ca=p('<button aria-label="Load more" class="svelte-12oyd1x"><i class="fa-solid fa-ellipsis"></i></button>'),va=p("<!> <!>",1),da=p('<!> <div class="svelte-12oyd1x"><!></div>',1);function ua(Te,$){Ve($,!0);const be=()=>We(Ge,"$enigmatickWasm",K),je=()=>We(yt,"$appData",K),[K,I]=qe();let ie=C(void 0),k=G(be);Je(()=>{e(k)&&Y($.handle,$.local).then(()=>{})});async function W(n,r=!1){const a=n.orderedItems;if(a){const s=[],f=[];for(let l=0;l<a.length;l++){const t=a[l];if(t.type==="Create"||t.type==="Announce"){let b="";typeof t.object=="object"&&t.object!==null&&"id"in t.object&&t.object.id?b=t.object.id:b=String(t.object),s.push({item:t,noteId:b,originalIndex:l}),f.push(b)}}r?i(se,[...f,...e(se)],!0):i(se,[...e(se),...f],!0);const d=async({item:l,noteId:t})=>{var b;try{const T=await ee(t);if(T)try{const x=JSON.parse(T);if((typeof l.object!="object"||l.object===null)&&(l.object=x),x.id&&x.id!==t&&console.warn(`Note ID mismatch: expected ${t}, got ${x.id}`),typeof l.object=="object"&&l.object!==null&&"ephemeral"in l.object&&l.object.ephemeral){const{attributedTo:H,...te}=l.object.ephemeral;x.ephemeral={...x.ephemeral||{},...te}}if((!((b=x.ephemeral)!=null&&b.attributedTo)||x.ephemeral.attributedTo.length===0)&&e(k)&&fe){const H=typeof x.attributedTo=="string"?x.attributedTo:Xe(x.attributedTo);if(H)try{const te=e(k).get_actor_cached(fe,H);if(te){const ge=await te;if(ge){const o=JSON.parse(ge);x.ephemeral||(x.ephemeral={}),x.ephemeral.attributedTo=[o]}}}catch(te){console.error(`Failed to fetch actor ${H} for note ${t}:`,te)}}l.object=x}catch(x){console.error(`Failed to parse note ${t}:`,x)}}catch(T){console.error(`Failed to fetch note ${t}:`,T)}le(l)};s.forEach(d)}i(Ae,n.next||null,!0),i(we,n.prev||null,!0)}async function Y(n,r){var s,f,d;i(Z,new Map,!0),i(se,[],!0),!fe&&e(k)&&(fe=new(e(k)).EnigmatickCache);let a=(s=e(k))==null?void 0:s.get_state();if(a)if(a.get_server_url(),r&&n){const l=await((f=e(k))==null?void 0:f.get_outbox(n,[]));if(l){const t=JSON.parse(l);W(t).then(()=>{i(M,!1)})}}else(d=e(k))==null||d.get_remote_outbox(`@${n}`).then(l=>{var t;if(l){const b=JSON.parse(l);(t=e(k))==null||t.get_remote_outbox(`@${n}`,b.first).then(T=>{if(T){const x=JSON.parse(T);W(x).then(()=>{i(M,!1)})}})}})}async function V(){var a,s;let n=null,r=!1;if(e(Ae)?(n=e(Ae),r=!1):e(we)&&(n=e(we),r=!0),n)if(i(M,!0),$.local&&$.handle){let f=Qt(n);f&&f.type&&f.value&&((a=e(k))==null||a.get_outbox($.handle,[],f.type,f.value).then(d=>{if(d){const l=JSON.parse(d);W(l,r).then(()=>{i(M,!1)})}}))}else(s=e(k))==null||s.get_remote_outbox(`@${$.handle}`,n).then(f=>{if(f){const d=JSON.parse(f);W(d,r).then(()=>{i(M,!1)})}})}async function L(n){const r=n.note,a=String(r.id);if(!e(Z).get(a))i(Z,new Map(e(Z)).set(a,n),!0),ue.set(a,JSON.stringify(r));else{const f=new rt(n.actor,n.note,n.activity,n.replies);i(Z,new Map(e(Z)).set(a,f),!0)}}const le=async n=>{if(typeof n.object=="string")return;const r=n.object;if("attributedTo"in r&&r.attributedTo){const a=Xe("ephemeral"in r&&r.ephemeral?r.ephemeral.attributedTo:null);if(a){const s=new rt(a,r,n);await L(s)}}};async function Q(n,r,a,s,f,d,l){var t;if(e(k)){let b=(await e(k).NoteParams.new()).set_content(a).set_public();l||b.set_public(),b.set_attachments(JSON.stringify(s)),b.set_hashtags(d);for(const[T,x]of f)b.add_mention(T,x.id||"",((t=x.capabilities)==null?void 0:t.enigmatickEncryption)||!1);return r&&(b.set_in_reply_to(String(r.note.id)),b.set_conversation(String(r.note.conversation))),await e(k).send_note(b)}else return null}async function ee(n){e(k)&&!ue.has(n)&&ue.set(n,e(k).get_note(n));const r=ue.get(n);return r instanceof Promise?await r:r}let Z=C($e(new Map)),se=C($e([])),De=G(()=>(e(Z).size,e(se).length,e(se).map(n=>e(Z).get(n)).filter(n=>n!==void 0))),ue=new Map,fe=null;je().username;let Ae=C(null),we=C(null),M=C(!0),me=$e([]);var ye=da(),ke=z(ye);{var F=n=>{Oe(Yt(n,{senderFunction:Q,direct:!1,cachedNoteFunction:ee}),r=>i(ie,r,!0),()=>e(ie))};_(ke,n=>{e(k)&&n(F)})}var w=N(ke,2),B=S(w);{var q=n=>{var r=va(),a=z(r);ot(a,17,()=>e(De),xt,(d,l,t)=>{var b=de(),T=z(b);{var x=H=>{{let te=G(()=>{var o;return(o=e(ie))==null?void 0:o.handleReplyToMessage}),ge=G(()=>{var o;return(o=e(ie))==null?void 0:o.handleEditNote});Oe(Vt(H,{get parentArticle(){return me[t]},get note(){return e(l)},get onReplyTo(){return e(te)},get onEdit(){return e(ge)},cachedNote:ee}),(o,u)=>me[u]=o,o=>me==null?void 0:me[o],()=>[t])}};_(T,H=>{e(l).note&&H(x)})}v(d,b)});var s=N(a,2);{var f=d=>{var l=ca();l.__click=t=>{t.preventDefault(),V()},re(()=>l.disabled=e(M)),v(d,l)};_(s,d=>{e(Ae)&&d(f)})}v(n,r)};_(B,n=>{e(k)&&n(q)})}y(w),v(Te,ye),Ze(),I()}Ye(["click"]);var fa=p('<div class="loading svelte-1g6x823">Loading articles...</div>'),ma=p('<span class="nav-title svelte-1g6x823"> </span>'),_a=p('<span class="nav-title svelte-1g6x823"> </span>'),ha=p('<div class="article-navigation svelte-1g6x823"><button class="nav-button prev svelte-1g6x823" title="Next newest article"><i class="fa-solid fa-arrow-left svelte-1g6x823"></i> <!></button> <button class="nav-button next svelte-1g6x823" title="Next oldest article"><!> <i class="fa-solid fa-arrow-right svelte-1g6x823"></i></button></div>'),ga=p('<h1 class="article-title svelte-1g6x823"><a class="svelte-1g6x823"><!></a></h1>'),pa=p('<h1 class="article-title svelte-1g6x823"><!></h1>'),ba=p('<time class="article-date svelte-1g6x823"> </time>'),wa=p('<span class="hashtag svelte-1g6x823"> </span>'),ya=p('<div class="hashtags svelte-1g6x823"></div>'),ka=p('<div class="article-content svelte-1g6x823"><!></div>'),xa=p('<!> <article class="article-display svelte-1g6x823"><!> <!> <!> <!></article>',1),Sa=p('<div class="empty-state svelte-1g6x823"><p>No articles found.</p></div>'),ja=p('<div class="articles-container svelte-1g6x823"><!></div>');function Aa(Te,$){Ve($,!0);const be=()=>We(Ge,"$enigmatickWasm",je),[je,K]=qe();let I=G(be),ie=C($e(new Map)),k=C(null),W=C(!1),Y=null,V=G(()=>(e(ie).size,Array.from(e(ie).values()).filter(F=>Le(F.note)).sort((F,w)=>{const B=new Date(F.published).getTime();return new Date(w.published).getTime()-B}))),L=G(()=>e(k)?e(ie).get(e(k))||null:e(V).length>0?e(V)[0]:null),le=G(()=>!e(k)||e(V).length===0?-1:e(V).findIndex(F=>F.note.id===e(k))),Q=G(()=>e(le)>0?e(V)[e(le)-1]:null),ee=G(()=>e(le)>=0&&e(le)<e(V).length-1?e(V)[e(le)+1]:null);Je(()=>{e(I)&&se($.handle)});async function Z(F){var q;const w=F.orderedItems;if(!w)return;const B=[];for(const n of w)if(n.type==="Create"||n.type==="Announce"){let r="";typeof n.object=="object"&&n.object!==null&&"id"in n.object&&n.object.id?r=n.object.id:r=String(n.object),typeof n.object=="object"&&n.object!==null&&"type"in n.object&&n.object.type==="Article"&&B.push({item:n,noteId:r})}for(const{item:n,noteId:r}of B)try{const a=await De(r);if(a)try{const s=JSON.parse(a);if(Le(s)){if((typeof n.object!="object"||n.object===null)&&(n.object=s),typeof n.object=="object"&&n.object!==null&&"ephemeral"in n.object&&n.object.ephemeral){const{attributedTo:f,...d}=n.object.ephemeral;s.ephemeral={...s.ephemeral||{},...d}}if((!((q=s.ephemeral)!=null&&q.attributedTo)||s.ephemeral.attributedTo.length===0)&&e(I)&&Y){const f=typeof s.attributedTo=="string"?s.attributedTo:Xe(s.attributedTo);if(f)try{const d=e(I).get_actor_cached(Y,f);if(d){const l=await d;if(l){const t=JSON.parse(l);s.ephemeral||(s.ephemeral={}),s.ephemeral.attributedTo=[t]}}}catch(d){console.error(`Failed to fetch actor ${f} for note ${r}:`,d)}}n.object=s,await ue(n)}}catch(s){console.error(`Failed to parse article ${r}:`,s)}}catch(a){console.error(`Failed to fetch article ${r}:`,a)}}async function se(F){if(i(W,!0),i(ie,new Map,!0),!Y&&e(I)&&(Y=new(e(I)).EnigmatickCache),$.local&&F&&e(I)){const w=await e(I).get_outbox(F,[],void 0,void 0,"article");if(w)try{const B=JSON.parse(w);await Z(B),e(V).length>0&&!e(k)&&i(k,e(V)[0].note.id||null,!0)}catch(B){console.error("Failed to parse outbox collection:",B)}}i(W,!1)}async function De(F){e(I)&&!we.has(F)&&we.set(F,e(I).get_note(F));const w=we.get(F);return w instanceof Promise?await w:w}const ue=async F=>{if(typeof F.object=="string")return;const w=F.object;if(Le(w)&&"attributedTo"in w&&w.attributedTo){const B=Xe("ephemeral"in w&&w.ephemeral?w.ephemeral.attributedTo:null);if(B){const q=new rt(B,w,F),n=String(w.id);i(ie,new Map(e(ie)).set(n,q),!0)}}};function fe(){e(Q)&&i(k,e(Q).note.id||null,!0)}function Ae(){e(ee)&&i(k,e(ee).note.id||null,!0)}let we=new Map;var M=ja(),me=S(M);{var ye=F=>{var w=fa();v(F,w)},ke=F=>{var w=de(),B=z(w);{var q=r=>{var a=xa(),s=z(a);{var f=o=>{var u=ha(),c=S(u);c.__click=fe;var h=N(S(c),2);{var J=j=>{var ce=ma(),Fe=S(ce,!0);y(ce),re(()=>Pe(Fe,e(Q).note.name||"Untitled Article")),v(j,ce)};_(h,j=>{e(Q)&&Le(e(Q).note)&&j(J)})}y(c);var D=N(c,2);D.__click=Ae;var A=S(D);{var O=j=>{var ce=_a(),Fe=S(ce,!0);y(ce),re(()=>Pe(Fe,e(ee).note.name||"Untitled Article")),v(j,ce)};_(A,j=>{e(ee)&&Le(e(ee).note)&&j(O)})}Kt(2),y(D),y(u),re(()=>{c.disabled=!e(Q),D.disabled=!e(ee)}),v(o,u)};_(s,o=>{e(V).length>1&&o(f)})}var d=N(s,2),l=S(d);{var t=o=>{const u=G(()=>{var A;return(A=e(L).note.ephemeral)==null?void 0:A.internalUuid});var c=de(),h=z(c);{var J=A=>{var O=ga(),j=S(O);j.__click=Fe=>{Fe.preventDefault(),St(`/objects?uuid=${e(u)}`)};var ce=S(j);Ue(ce,()=>He(e(I),e(L).note.name,e(L).note)),y(j),y(O),re(()=>Ce(j,"href",`/objects?uuid=${e(u)??""}`)),v(A,O)},D=A=>{var O=pa(),j=S(O);Ue(j,()=>He(e(I),e(L).note.name,e(L).note)),y(O),v(A,O)};_(h,A=>{e(u)?A(J):A(D,!1)})}v(o,c)};_(l,o=>{e(L).note.name&&o(t)})}var b=N(l,2);{var T=o=>{var u=ba(),c=S(u);y(u),re(h=>{Ce(u,"datetime",e(L).note.published),Pe(c,`Published ${h??""}`)},[()=>new Date(e(L).note.published).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"})]),v(o,u)};_(b,o=>{e(L).note.published&&o(T)})}var x=N(b,2);{var H=o=>{const u=G(()=>ea(e(L).note.tag)),c=G(()=>e(u).filter(A=>A.type==="Hashtag"));var h=de(),J=z(h);{var D=A=>{var O=ya();ot(O,21,()=>e(c),j=>j.name||j.href,(j,ce)=>{var Fe=wa(),Qe=S(Fe,!0);y(Fe),re(Ee=>Pe(Qe,Ee),[()=>{var Ee;return(Ee=e(ce).name)!=null&&Ee.startsWith("#")?e(ce).name:`#${e(ce).name}`}]),v(j,Fe)}),y(O),v(A,O)};_(J,A=>{e(c).length>0&&A(D)})}v(o,h)};_(x,o=>{e(L).note.tag&&o(H)})}var te=N(x,2);{var ge=o=>{var u=ka(),c=S(u);Ue(c,()=>He(e(I),e(L).note.content,e(L).note)),y(u),v(o,u)};_(te,o=>{e(L).note.content&&o(ge)})}y(d),v(r,a)},n=r=>{var a=de(),s=z(a);{var f=d=>{var l=Sa();v(d,l)};_(s,d=>{e(V).length===0&&d(f)},!0)}v(r,a)};_(B,r=>{e(L)&&Le(e(L).note)?r(q):r(n,!1)},!0)}v(F,w)};_(me,F=>{e(W)?F(ye):F(ke,!1)})}y(M),v(Te,M),Ze(),K()}Ye(["click"]);var Fa=p('<img class="follow-avatar svelte-1lwtw4"/>'),Na=p('<img class="follow-avatar svelte-1lwtw4"/>'),Ca=p('<div class="follow-avatar placeholder svelte-1lwtw4"><i class="fa-solid fa-user svelte-1lwtw4"></i></div>'),Ta=p('<span class="follow-user-handle svelte-1lwtw4"><!></span>'),Da=p('<span class="follow-user-handle svelte-1lwtw4"> </span>'),Oa=p('<a class="follow-user svelte-1lwtw4"><!> <div class="follow-user-info svelte-1lwtw4"><span class="follow-user-name svelte-1lwtw4"><!></span> <!></div></a>'),Pa=p('<button aria-label="Load more" class="svelte-1lwtw4"><i class="fa-solid fa-ellipsis svelte-1lwtw4"></i></button>'),Ea=p('<div class="loading-overlay svelte-1lwtw4"><div class="loading-spinner svelte-1lwtw4"></div></div>'),$a=p('<div class="actor-card-popup svelte-1lwtw4" role="dialog" aria-modal="true" tabindex="-1"><!> <!></div>'),Ia=p('<div class="svelte-1lwtw4"><!> <!></div> <!>',1);function wt(Te,$){Ve($,!0);const be=()=>We(Ge,"$enigmatickWasm",je),[je,K]=qe();let I=C(void 0),ie=!1,k=G(be);Je(()=>{e(k)&&$.handle&&(i(le,[],!0),i(I,void 0),V($.handle,$.local).then(()=>{console.debug("RELOADED FOLLOWS",e(le).length)}))});const W=async(r,a)=>{var s,f;if($.view=="Followers"){let d=await((s=e(k))==null?void 0:s.get_remote_followers(r));if(console.debug(d),d)return JSON.parse(d).first}else if($.view=="Following"){let d=await((f=e(k))==null?void 0:f.get_remote_following(r));if(d)return JSON.parse(d).first}},Y=async(r,a)=>{var t,b;const s=$.view==="Followers"?"get_remote_followers":"get_remote_following",f=await((t=e(k))==null?void 0:t[s](r,a));if(!f)return null;const d=JSON.parse(f);let l=[];return(b=d.ephemeral)!=null&&b.actors?l=d.ephemeral.actors:d.orderedItems&&(l=await Promise.all(d.orderedItems.map(async T=>{try{const x=await $.cachedActor(T,$.cache);return JSON.parse(x)}catch{return console.error(`Failed to retrieve ${T}`),null}})).then(T=>T.filter(Boolean))),{profiles:l,next:d.next}},V=async(r,a)=>{var l;const s=a?await((l=e(k))==null?void 0:l.get_webfinger_from_handle(r))||r:`@${r}`,f=await W(s);if(!f)return;const d=await Y(s,f);d&&(i(le,d.profiles,!0),i(I,d.next,!0))},L=async()=>{var s;const r=$.local?await((s=e(k))==null?void 0:s.get_webfinger_from_handle($.handle))||$.handle:`@${$.handle}`;if(!r||!e(I))return;const a=await Y(r,e(I));a&&(i(le,[...e(le),...a.profiles],!0),i(I,a.next,!0))};let le=C($e([])),Q=C(null),ee=C(!1),Z=C(!1),se=C($e({x:0,y:0})),De=C(""),ue=C(null),fe=C($e(new Set));const Ae=(r,a,s,f)=>{const d=s||500,l=f||600,t=20,b=window.innerWidth,T=window.innerHeight;let x=r,H=a;const te=d/2,ge=t+te,o=b-t-te;x<ge?x=ge:x>o&&(x=o);const u=l/2,c=t+u,h=T-t-u;return H<c?H=c:H>h&&(H=h),`position: fixed; left: ${x}px; top: ${H}px; z-index: 1000; transform: translate(-50%, -50%);`};Je(()=>{e(ee)&&e(ue)&&e(Q)&&setTimeout(()=>{if(e(ue)){const r=e(ue).getBoundingClientRect(),a=r.width,s=r.height;i(De,Ae(e(se).x,e(se).y,a,s),!0)}},0)});const we=async(r,a)=>{var s;a.preventDefault(),a.stopPropagation(),i(se,{x:a.clientX,y:a.clientY},!0),i(De,Ae(a.clientX,a.clientY),!0),i(Q,r,!0),i(ee,!0),i(Z,!0);try{const f=r.id||(typeof r.url=="string"?r.url:(s=r.url)==null?void 0:s[0]);if(f&&e(k)&&$.cache){const d=e(k).get_actor_cached($.cache,String(f));if(d){const l=await d;if(l){const t=JSON.parse(l);t.ephemeral||(t.ephemeral={});const b=t.ephemeral;if(!b.webfinger&&r.webfinger)b.webfinger=r.webfinger;else if(!b.webfinger)try{const T=kt(t);T&&T.startsWith("@")&&(b.webfinger=T)}catch{}i(Q,t,!0),i(Z,!1);return}}}i(Z,!1)}catch(f){console.error(`Failed to fetch full profile for ${r.id}:`,f),i(Z,!1)}},M=()=>{i(ee,!1),i(Q,null),i(Z,!1)},me=r=>{r.key==="Escape"&&M()};Je(()=>{if(e(ee)){const r=a=>{const s=a.target;s&&!s.closest(".actor-card-popup")&&M()};return document.addEventListener("click",r),document.addEventListener("keydown",me),()=>{document.removeEventListener("click",r),document.removeEventListener("keydown",me)}}});var ye=Ia(),ke=z(ye),F=S(ke);ot(F,17,()=>e(le),xt,(r,a)=>{const s=G(()=>e(a).webfinger&&e(a).webfinger.trim()?e(a).webfinger.trim():null),f=G(()=>{var c;return e(a).id||((c=e(a).icon)==null?void 0:c.url)||e(a).preferredUsername}),d=G(()=>e(fe).has(String(e(f))));var l=Oa();l.__click=c=>we(e(a),c),l.__keydown=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),we(e(a),c))};var t=S(l);{var b=c=>{var h=Fa();re(J=>{Ce(h,"src",J),Ce(h,"alt",e(a).name||e(a).preferredUsername)},[()=>nt(e(k),e(a).icon.url)]),ze("error",h,()=>{i(fe,new Set(e(fe)).add(String(e(f))),!0)}),pt(h),v(c,h)},T=c=>{var h=de(),J=z(h);{var D=O=>{var j=Na();re(()=>{Ce(j,"src",e(a).icon.url),Ce(j,"alt",e(a).name||e(a).preferredUsername)}),ze("error",j,()=>{i(fe,new Set(e(fe)).add(String(e(f))),!0)}),pt(j),v(O,j)},A=O=>{var j=Ca();v(O,j)};_(J,O=>{var j;!e(d)&&((j=e(a).icon)!=null&&j.url)?O(D):O(A,!1)},!0)}v(c,h)};_(t,c=>{var h;!e(d)&&((h=e(a).icon)!=null&&h.url)&&e(k)?c(b):c(T,!1)})}var x=N(t,2),H=S(x),te=S(H);Ue(te,()=>e(k)?He(e(k),e(a).name||e(a).preferredUsername,e(a)):e(a).name||e(a).preferredUsername),y(H);var ge=N(H,2);{var o=c=>{var h=Ta(),J=S(h);na(J,{get handle(){return e(s)}}),y(h),v(c,h)},u=c=>{var h=de(),J=z(h);{var D=A=>{var O=Da(),j=S(O);y(O),re(()=>Pe(j,`@${e(a).preferredUsername??""}`)),v(A,O)};_(J,A=>{e(a).preferredUsername&&A(D)},!0)}v(c,h)};_(ge,c=>{e(s)&&e(s).includes("@")?c(o):c(u,!1)})}y(x),y(l),re(()=>Ce(l,"href",e(s)?`/${e(s)}`:"#")),v(r,l)});var w=N(F,2);{var B=r=>{var a=Pa();a.__click=s=>{s.preventDefault(),L()},a.disabled=ie,v(r,a)};_(w,r=>{e(I)!==void 0&&r(B)})}y(ke);var q=N(ke,2);{var n=r=>{var a=$a();a.__click=l=>l.stopPropagation();var s=S(a);la(s,{get actor(){return e(Q)},onClose:M});var f=N(s,2);{var d=l=>{var t=Ea();v(l,t)};_(f,l=>{e(Z)&&l(d)})}y(a),Oe(a,l=>i(ue,l),()=>e(ue)),re(()=>oa(a,e(De))),v(r,a)};_(q,r=>{e(ee)&&e(Q)&&r(n)})}v(Te,ye),Ze(),K()}Ye(["click","keydown"]);var Ma=p('<input style="display:none" type="file" accept=".jpg, .jpeg, .png"/>'),Ja=p('<img alt="Banner" class="svelte-4rchk5"/>'),Ua=p('<input style="display:none" type="file" accept=".jpg, .jpeg, .png"/>'),Wa=p('<h1 class="svelte-4rchk5"><!></h1>'),La=p('<button title="Follow" class="svelte-4rchk5"><i class="fa-solid fa-user-plus svelte-4rchk5"></i></button>'),Ha=p('<button title="Unfollow" class="svelte-4rchk5"><i class="fa-solid fa-user-minus svelte-4rchk5"></i></button>'),Ba=p('<button title="Exchange Keys" class="svelte-4rchk5"><i class="fa-solid fa-key svelte-4rchk5"></i></button>'),za=p('<div class="svelte-4rchk5"><!> <!> <!></div>'),Ra=p('<button title="Update Biography" class="svelte-4rchk5"><i class="fa-solid fa-pencil svelte-4rchk5"></i></button>'),Ka=p('<div class="svelte-4rchk5"><button title="Change Avatar" class="svelte-4rchk5"><i class="fa-solid fa-image-portrait svelte-4rchk5"></i></button> <button title="Change Banner" class="svelte-4rchk5"><i class="fa-solid fa-panorama svelte-4rchk5"></i></button> <!></div>'),Xa=p('<button title="Save" class="svelte-4rchk5"><i class="fa-solid fa-floppy-disk svelte-4rchk5"></i></button>'),Ya=p('<div class="svelte-4rchk5"><button title="Cancel" class="svelte-4rchk5"><i class="fa-solid fa-ban svelte-4rchk5"></i></button> <button title="Preview" class="svelte-4rchk5"><i class="fa-solid fa-eye svelte-4rchk5"></i></button> <!></div>'),Va=p('<div class="svelte-4rchk5"><button title="Save" class="svelte-4rchk5"><i class="fa-solid fa-floppy-disk svelte-4rchk5"></i></button></div>'),Za=p('<div class="controls svelte-4rchk5"><!> <!> <!></div>'),qa=p('<pre id="summary_edit" contenteditable="true" class="svelte-4rchk5"> </pre>'),Ga=p('<div class="svelte-4rchk5"><!></div>'),Qa=p("<span><!></span>"),er=p("<button>Articles</button>"),tr=p("<button>Posts</button>"),ar=p("<button> </button> <button> </button>",1),rr=p('<div class="profile svelte-4rchk5"><div class="banner svelte-4rchk5"><!> <!></div> <div class="identity svelte-4rchk5"><div class="avatar svelte-4rchk5"><!> <img alt="Avatar" class="svelte-4rchk5"/></div> <div class="details svelte-4rchk5"><!> <a class="svelte-4rchk5"> </a></div></div> <!> <div class="summary svelte-4rchk5"><!> <!> <!></div> <div class="tabs svelte-4rchk5"><!> <!> <!></div></div> <section class="svelte-4rchk5"><!></section>',1),nr=p('<main class="svelte-4rchk5"><!></main>'),or=p("<!> <!>",1);function kr(Te,$){Ve($,!0);const be=()=>We(Ge,"$enigmatickWasm",I),je=()=>We(yt,"$appData",I),K=()=>We(Gt,"$page",I),[I,ie]=qe(),{Converter:k}=Zt;let W=G(be),Y=G(()=>je().username);Xt(async()=>{});async function V(o){var u,c,h;if(o.includes("@")){i(b,!1);let J=await L(`@${o}`,e(T));i(t,JSON.parse(J),!0),(u=e(W))==null||u.get_remote_followers(`@${o}`).then(D=>{if(D){let A=JSON.parse(D);i(r,A.totalItems||0,!0)}}),(c=e(W))==null||c.get_remote_following(`@${o}`).then(D=>{if(D){let A=JSON.parse(D);i(a,A.totalItems||0,!0)}})}else i(b,!0),(h=e(W))==null||h.get_profile_by_username(o).then(J=>{var D,A;J&&(i(t,JSON.parse(J),!0),i(n,((A=(D=e(t))==null?void 0:D.ephemeral)==null?void 0:A.summaryMarkdown)||"",!0))})}async function L(o,u){var c;if(u)try{return await((c=e(W))==null?void 0:c.get_actor_cached(u,o))}catch{return console.error(`FAILED TO RETRIEVE: ${o}`),null}return null}function le(o){let u=new k({extensions:[qt({pre:!0,auto_detection:!0})]});return u.setFlavor("github"),u.setOption("tables",!0),u.setOption("requireSpaceBeforeHeadingText",!0),u.makeHtml(o)}function Q(o){(o instanceof KeyboardEvent&&(o.key==="Enter"||o.key===" ")||o instanceof MouseEvent&&o.type==="click")&&i(q,!0)}function ee(o){let u=document.getElementById("summary_edit");if(u){let c=u.innerText;e(t)&&(i(n,c,!0),i(q,!1),e(t).summary=le(c),i(B,!0))}}function Z(o){i(q,!1)}function se(){var o;e(t)&&e(t).summary&&((o=e(W))==null||o.update_summary(e(t).summary,e(n)).then(u=>{i(B,!1)}))}const De=o=>{let u=o.target;if(u.files!==null){let c=u.files[0],h=String(c.name.match(/\.[0-9a-z]+$/i)).slice(1),J=new FileReader;J.readAsArrayBuffer(c),J.onload=D=>{var A;if(D.target!==null){i(me,D.target.result!==null?D.target.result:null,!0);let O=new Uint8Array(e(me));(A=e(W))==null||A.upload_avatar(O,e(me).byteLength,h).then(()=>{const j=K().params.handle;j&&V(j)})}}}},ue=o=>{let u=o.target;if(u.files!==null){let c=u.files[0],h=String(c.name.match(/\.[0-9a-z]+$/i)).slice(1),J=new FileReader;J.readAsArrayBuffer(c),J.onload=D=>{var A;if(D.target!==null){i(ke,D.target.result!==null?D.target.result:null,!0);let O=new Uint8Array(e(ke));(A=e(W))==null||A.upload_banner(O,e(ke).byteLength,h).then(()=>{const j=K().params.handle;j&&V(j)})}}}};function fe(o){var u;e(t)&&e(t).id&&((u=e(W))==null||u.send_follow(e(t).id).then(c=>{if(c&&e(t)){JSON.parse(c);let h=e(t).ephemeral||{};h.following=!0,e(t).ephemeral=h}}))}function Ae(o){var u;o&&e(t)&&e(t).id&&((u=e(W))==null||u.send_unfollow(e(t).id,o).then(c=>{if(c&&e(t)){JSON.parse(c);let h=e(t).ephemeral||{};h.following=!1,e(t).ephemeral=h}}))}async function we(o){}const M={Articles:Symbol("articles"),Posts:Symbol("posts"),Followers:Symbol("followers"),Following:Symbol("following")};let me=C(null),ye=C(void 0),ke=C(null),F=C(void 0),w=C($e(M.Posts)),B=C(!1),q=C(!1),n=C(""),r=C(0),a=C(0),s=C(null),f=C(null),d=C(null),l=C(null),t=C(null),b=C(!0),T=C(null);Je(()=>{be()&&!e(T)&&i(T,new(be()).EnigmatickCache,!0)});let x=C(null);Je(()=>{if(be()&&e(T)){const o=K().params.handle;o&&o!==e(x)&&(i(x,o,!0),V(o))}}),ra(async o=>{if(i(w,M.Posts,!0),o.to&&o.to.route.id===null){let u=o.to.url.href;const c=/^https:\/\/(:?[a-zA-Z0-9\-]+)(:?\.[a-zA-Z0-9\-]+)+?\/@[a-zA-Z0-9_]+\/?$/;if(u.match(c)){let h=ta(u);h&&(o.cancel(),await St(`/${h}`))}}});var H=or(),te=z(H);sa(te,{});var ge=N(te,2);ia(ge,()=>e(t),o=>{var u=nr(),c=S(u);{var h=J=>{var D=rr(),A=z(D),O=S(A),j=S(O);{var ce=m=>{var g=Ma();g.__change=P=>ue(P),Oe(g,P=>i(F,P),()=>e(F)),v(m,g)};_(j,m=>{e(Y)&&m(ce)})}var Fe=N(j,2);{var Qe=m=>{var g=Ja();re(P=>Ce(g,"src",P),[()=>nt(e(W),String(e(t).image.url))]),v(m,g)};_(Fe,m=>{e(t).image&&m(Qe)})}y(O);var Ee=N(O,2),et=S(Ee),lt=S(et);{var jt=m=>{var g=Ua();g.__change=P=>De(P),Oe(g,P=>i(ye,P),()=>e(ye)),v(m,g)};_(lt,m=>{e(Y)&&m(jt)})}var At=N(lt,2);y(et);var st=N(et,2),it=S(st);{var Ft=m=>{var g=Wa(),P=S(g);Ue(P,()=>He(e(W),e(t).name,e(t))),y(g),v(m,g)};_(it,m=>{e(t).name&&m(Ft)})}var tt=N(it,2),Nt=S(tt,!0);y(tt),y(st),y(Ee);var ct=N(Ee,2);{var Ct=m=>{var g=Za(),P=S(g);{var Ie=X=>{var U=za(),ne=S(U);{var _e=R=>{var ae=La();ae.__click=Ne=>{Ne.preventDefault(),fe()},v(R,ae)};_(ne,R=>{var ae;(ae=e(t).ephemeral)!=null&&ae.following||R(_e)})}var he=N(ne,2);{var oe=R=>{var ae=Ha();ae.__click=Ne=>{var ht,gt;Ne.preventDefault(),Ae((gt=(ht=e(t))==null?void 0:ht.ephemeral)==null?void 0:gt.followActivityAsId)},v(R,ae)};_(he,R=>{var ae,Ne;((ae=e(t).ephemeral)==null?void 0:ae.following)!==void 0&&((Ne=e(t).ephemeral)!=null&&Ne.following)&&R(oe)})}var E=N(he,2);{var Se=R=>{var ae=Ba();ae.__click=Ne=>{Ne.preventDefault(),we()},v(R,ae)};_(E,R=>{e(t).capabilities&&e(t).capabilities.enigmatickEncryption&&R(Se)})}y(U),v(X,U)};_(P,X=>{var U;je().domain&&(!((U=e(t).id)!=null&&U.includes(je().domain))||e(t).preferredUsername!==e(Y))&&X(Ie)})}var pe=N(P,2);{var xe=X=>{var U=Ka(),ne=S(U);ne.__click=()=>{var E;(E=e(ye))==null||E.click()};var _e=N(ne,2);_e.__click=()=>{var E;(E=e(F))==null||E.click()};var he=N(_e,2);{var oe=E=>{var Se=Ra();Se.__click=R=>{R.preventDefault(),Q(R)},ze("keypress",Se,R=>{R.preventDefault(),Q(R)}),v(E,Se)};_(he,E=>{e(q)||E(oe)})}y(U),ze("keypress",ne,()=>{var E;(E=e(ye))==null||E.click()}),ze("keypress",_e,()=>{var E;(E=e(F))==null||E.click()}),v(X,U)};_(pe,X=>{e(b)&&e(t).preferredUsername===e(Y)&&X(xe)})}var ve=N(pe,2);{var Me=X=>{var U=Ya(),ne=S(U);ne.__click=E=>{E.preventDefault(),Z()};var _e=N(ne,2);_e.__click=E=>{E.preventDefault(),ee()};var he=N(_e,2);{var oe=E=>{var Se=Xa();Se.__click=R=>{R.preventDefault(),se()},v(E,Se)};_(he,E=>{e(B)&&E(oe)})}y(U),v(X,U)},Be=X=>{var U=de(),ne=z(U);{var _e=he=>{var oe=Va(),E=S(oe);E.__click=Se=>{Se.preventDefault(),se()},y(oe),v(he,oe)};_(ne,he=>{e(B)&&he(_e)},!0)}v(X,U)};_(ve,X=>{e(q)?X(Me):X(Be,!1)})}y(g),v(m,g)};_(ct,m=>{e(Y)&&m(Ct)})}var at=N(ct,2),vt=S(at);{var Tt=m=>{var g=qa(),P=S(g,!0);y(g),re(()=>Pe(P,e(n))),v(m,g)};_(vt,m=>{e(q)&&m(Tt)})}var dt=N(vt,2);{var Dt=m=>{var g=Ga(),P=S(g);Ue(P,()=>He(e(W),e(t).summary||"",e(t))),y(g),v(m,g)};_(dt,m=>{e(Y)&&!e(q)&&m(Dt)})}var Ot=N(dt,2);{var Pt=m=>{var g=Qa(),P=S(g);Ue(P,()=>e(t).summary||""),y(g),v(m,g)};_(Ot,m=>{e(Y)||m(Pt)})}y(at);var ut=N(at,2),ft=S(ut);{var Et=m=>{var g=er();g.__click=()=>{i(w,M.Articles,!0)},re(()=>Re(g,1,Ke(e(w)===M.Articles?"selected":""),"svelte-4rchk5")),v(m,g)};_(ft,m=>{e(b)&&m(Et)})}var mt=N(ft,2);{var $t=m=>{var g=tr();g.__click=()=>{i(w,M.Posts,!0)},re(()=>Re(g,1,Ke(e(w)===M.Posts?"selected":""),"svelte-4rchk5")),v(m,g)};_(mt,m=>{(e(b)||e(Y))&&m($t)})}var It=N(mt,2);{var Mt=m=>{var g=ar(),P=z(g);P.__click=()=>{i(w,M.Following,!0)};var Ie=S(P);y(P);var pe=N(P,2);pe.__click=()=>{i(w,M.Followers,!0)};var xe=S(pe);y(pe),re((ve,Me)=>{Re(P,1,Ke(e(w)===M.Following?"selected":""),"svelte-4rchk5"),Pe(Ie,`Following • ${ve??""}`),Re(pe,1,Ke(e(w)===M.Followers?"selected":""),"svelte-4rchk5"),Pe(xe,`Followers • ${Me??""}`)},[()=>{var ve;return bt(((ve=e(t).ephemeral)==null?void 0:ve.leaders)||e(a))},()=>{var ve;return bt(((ve=e(t).ephemeral)==null?void 0:ve.followers)||e(r))}]),v(m,g)};_(It,m=>{e(Y)&&m(Mt)})}y(ut),y(A);var _t=N(A,2),Jt=S(_t);{var Ut=m=>{var g=de(),P=z(g);{var Ie=pe=>{Oe(ua(pe,{get handle(){return K().params.handle},get local(){return e(b)}}),xe=>i(d,xe,!0),()=>e(d))};_(P,pe=>{K().params.handle&&pe(Ie)})}v(m,g)},Wt=m=>{var g=de(),P=z(g);{var Ie=xe=>{var ve=de(),Me=z(ve);{var Be=X=>{Oe(Aa(X,{get handle(){return K().params.handle},get local(){return e(b)}}),U=>i(l,U,!0),()=>e(l))};_(Me,X=>{K().params.handle&&e(b)&&X(Be)})}v(xe,ve)},pe=xe=>{var ve=de(),Me=z(ve);{var Be=U=>{var ne=de(),_e=z(ne);{var he=oe=>{Oe(wt(oe,{get handle(){return K().params.handle},get local(){return e(b)},view:"Followers",get cache(){return e(T)},cachedActor:L}),E=>i(s,E,!0),()=>e(s))};_(_e,oe=>{K().params.handle&&oe(he)})}v(U,ne)},X=U=>{var ne=de(),_e=z(ne);{var he=oe=>{var E=de(),Se=z(E);{var R=ae=>{Oe(wt(ae,{get handle(){return K().params.handle},get local(){return e(b)},view:"Following",get cache(){return e(T)},cachedActor:L}),Ne=>i(f,Ne,!0),()=>e(f))};_(Se,ae=>{K().params.handle&&ae(R)})}v(oe,E)};_(_e,oe=>{e(w)==M.Following&&oe(he)},!0)}v(U,ne)};_(Me,U=>{e(w)==M.Followers?U(Be):U(X,!1)},!0)}v(xe,ve)};_(P,xe=>{e(w)===M.Articles?xe(Ie):xe(pe,!1)},!0)}v(m,g)};_(Jt,m=>{e(w)===M.Posts?m(Ut):m(Wt,!1)})}y(_t),re((m,g,P)=>{Ce(At,"src",m),Ce(tt,"href",g),Pe(Nt,P)},[()=>{var m;return nt(e(W),String((m=e(t).icon)==null?void 0:m.url))},()=>aa(e(t).url),()=>kt(e(t))]),v(J,D)};_(c,J=>{e(t)&&J(h)})}y(u),v(o,u)}),v(Te,H),Ze(),ie()}Ye(["change","click"]);export{kr as component};
