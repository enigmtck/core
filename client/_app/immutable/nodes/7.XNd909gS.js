import{s as ke,f as h,a as L,g,h as S,u as W,c as M,d as m,j as f,i as A,v as u,D as R,E as Q,G,w as ie,O as be,o as we,x as ne,l as oe,K as ye,m as re,L as Ie,n as fe,F as $}from"../chunks/scheduler.tnyNm5U0.js";import{S as Ee,i as Fe}from"../chunks/index.R_ElRwcJ.js";import{p as Ce}from"../chunks/stores.lqkY9vaV.js";import{g as Se}from"../chunks/navigation.g998M0x9.js";import{e as Te,a as ce}from"../chunks/stores.bABpd-zC.js";import{g as ue}from"../chunks/common.TJJApE5i.js";function de(s){let e,l,t,i,c,o,a,d,p=s[3].name+"",U,z,T,N=s[3].url+"",V,P,H,O,n,B,_,j,k,K,q,J,X=s[3].summary+"",b=s[3].image&&me(s),w=s[3].icon&&he(s),y=!s[0]&&!s[2]&&!s[1]&&ge(s),I=(s[0]||s[2])&&_e(s),E=s[3].ephemeralFollowing===void 0&&ve(s),C=s[3].ephemeralFollowing!==void 0&&!s[3].ephemeralFollowing&&pe(),F=s[3].ephemeralFollowing!==void 0&&s[3].ephemeralFollowing&&je(s);return{c(){e=h("div"),l=h("div"),b&&b.c(),t=L(),i=h("div"),c=h("div"),w&&w.c(),o=L(),a=h("div"),d=h("span"),U=oe(p),z=L(),T=h("a"),V=oe(N),H=L(),O=h("div"),n=h("ul"),y&&y.c(),B=L(),I&&I.c(),_=L(),E&&E.c(),j=L(),C&&C.c(),k=L(),F&&F.c(),K=L(),q=h("div"),J=new ye(!1),this.h()},l(r){e=g(r,"DIV",{class:!0});var v=S(e);l=g(v,"DIV",{class:!0});var x=S(l);b&&b.l(x),x.forEach(m),t=M(v),i=g(v,"DIV",{class:!0});var Y=S(i);c=g(Y,"DIV",{class:!0});var ee=S(c);w&&w.l(ee),ee.forEach(m),o=M(Y),a=g(Y,"DIV",{class:!0});var Z=S(a);d=g(Z,"SPAN",{class:!0});var le=S(d);U=re(le,p),le.forEach(m),z=M(Z),T=g(Z,"A",{href:!0,class:!0});var te=S(T);V=re(te,N),te.forEach(m),Z.forEach(m),Y.forEach(m),H=M(v),O=g(v,"DIV",{class:!0});var se=S(O);n=g(se,"UL",{class:!0});var D=S(n);y&&y.l(D),B=M(D),I&&I.l(D),_=M(D),E&&E.l(D),j=M(D),C&&C.l(D),k=M(D),F&&F.l(D),D.forEach(m),se.forEach(m),K=M(v),q=g(v,"DIV",{class:!0});var ae=S(q);J=Ie(ae,!1),ae.forEach(m),v.forEach(m),this.h()},h(){f(l,"class","banner svelte-8jjakg"),f(c,"class","avatar svelte-8jjakg"),f(d,"class","svelte-8jjakg"),f(T,"href",P=ue(s[3])),f(T,"class","svelte-8jjakg"),f(a,"class","contact svelte-8jjakg"),f(i,"class","identity svelte-8jjakg"),f(n,"class","svelte-8jjakg"),f(O,"class","controls svelte-8jjakg"),J.a=null,f(q,"class","summary svelte-8jjakg"),f(e,"class","profile svelte-8jjakg")},m(r,v){A(r,e,v),u(e,l),b&&b.m(l,null),u(e,t),u(e,i),u(i,c),w&&w.m(c,null),u(i,o),u(i,a),u(a,d),u(d,U),u(a,z),u(a,T),u(T,V),u(e,H),u(e,O),u(O,n),y&&y.m(n,null),u(n,B),I&&I.m(n,null),u(n,_),E&&E.m(n,null),u(n,j),C&&C.m(n,null),u(n,k),F&&F.m(n,null),u(e,K),u(e,q),J.m(X,q)},p(r,v){r[3].image?b?b.p(r,v):(b=me(r),b.c(),b.m(l,null)):b&&(b.d(1),b=null),r[3].icon?w?w.p(r,v):(w=he(r),w.c(),w.m(c,null)):w&&(w.d(1),w=null),v&8&&p!==(p=r[3].name+"")&&fe(U,p),v&8&&N!==(N=r[3].url+"")&&fe(V,N),v&8&&P!==(P=ue(r[3]))&&f(T,"href",P),!r[0]&&!r[2]&&!r[1]?y?y.p(r,v):(y=ge(r),y.c(),y.m(n,B)):y&&(y.d(1),y=null),r[0]||r[2]?I?I.p(r,v):(I=_e(r),I.c(),I.m(n,_)):I&&(I.d(1),I=null),r[3].ephemeralFollowing===void 0?E?E.p(r,v):(E=ve(r),E.c(),E.m(n,j)):E&&(E.d(1),E=null),r[3].ephemeralFollowing!==void 0&&!r[3].ephemeralFollowing?C||(C=pe(),C.c(),C.m(n,k)):C&&(C.d(1),C=null),r[3].ephemeralFollowing!==void 0&&r[3].ephemeralFollowing?F?F.p(r,v):(F=je(r),F.c(),F.m(n,null)):F&&(F.d(1),F=null),v&8&&X!==(X=r[3].summary+"")&&J.p(X)},d(r){r&&m(e),b&&b.d(),w&&w.d(),y&&y.d(),I&&I.d(),E&&E.d(),C&&C.d(),F&&F.d()}}}function me(s){let e,l;return{c(){e=h("img"),this.h()},l(t){e=g(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){$(e.src,l=s[3].image.url)||f(e,"src",l),f(e,"alt","Banner"),f(e,"class","svelte-8jjakg")},m(t,i){A(t,e,i)},p(t,i){i&8&&!$(e.src,l=t[3].image.url)&&f(e,"src",l)},d(t){t&&m(e)}}}function he(s){let e,l;return{c(){e=h("img"),this.h()},l(t){e=g(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){$(e.src,l=s[3].icon.url)||f(e,"src",l),f(e,"alt","Avatar"),f(e,"class","svelte-8jjakg")},m(t,i){A(t,e,i)},p(t,i){i&8&&!$(e.src,l=t[3].icon.url)&&f(e,"src",l)},d(t){t&&m(e)}}}function ge(s){let e,l,t="Exchange Keys",i,c;return{c(){e=h("li"),l=h("button"),l.textContent=t,this.h()},l(o){e=g(o,"LI",{class:!0});var a=S(e);l=g(a,"BUTTON",{class:!0,"data-svelte-h":!0}),W(l)!=="svelte-1xj8rcg"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-8jjakg"),f(e,"class","svelte-8jjakg")},m(o,a){A(o,e,a),u(e,l),i||(c=R(l,"click",Q(s[7])),i=!0)},p:G,d(o){o&&m(e),i=!1,c()}}}function _e(s){let e,l,t="Message",i,c;return{c(){e=h("li"),l=h("button"),l.textContent=t,this.h()},l(o){e=g(o,"LI",{class:!0});var a=S(e);l=g(a,"BUTTON",{class:!0,"data-svelte-h":!0}),W(l)!=="svelte-29nnst"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-8jjakg"),f(e,"class","svelte-8jjakg")},m(o,a){A(o,e,a),u(e,l),i||(c=R(l,"click",Q(s[8])),i=!0)},p:G,d(o){o&&m(e),i=!1,c()}}}function ve(s){let e,l,t="Follow",i,c;return{c(){e=h("li"),l=h("button"),l.textContent=t,this.h()},l(o){e=g(o,"LI",{class:!0});var a=S(e);l=g(a,"BUTTON",{class:!0,"data-svelte-h":!0}),W(l)!=="svelte-1uh055h"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-8jjakg"),f(e,"class","svelte-8jjakg")},m(o,a){A(o,e,a),u(e,l),i||(c=R(l,"click",Q(s[5])),i=!0)},p:G,d(o){o&&m(e),i=!1,c()}}}function pe(s){let e,l='<button class="svelte-8jjakg">Pending</button>';return{c(){e=h("li"),e.innerHTML=l,this.h()},l(t){e=g(t,"LI",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-thka56"&&(e.innerHTML=l),this.h()},h(){f(e,"class","svelte-8jjakg")},m(t,i){A(t,e,i)},d(t){t&&m(e)}}}function je(s){let e,l,t="Unfollow",i,c;return{c(){e=h("li"),l=h("button"),l.textContent=t,this.h()},l(o){e=g(o,"LI",{class:!0});var a=S(e);l=g(a,"BUTTON",{class:!0,"data-svelte-h":!0}),W(l)!=="svelte-zy8uxx"&&(l.textContent=t),a.forEach(m),this.h()},h(){f(l,"class","svelte-8jjakg"),f(e,"class","svelte-8jjakg")},m(o,a){A(o,e,a),u(e,l),i||(c=R(l,"click",Q(s[6])),i=!0)},p:G,d(o){o&&m(e),i=!1,c()}}}function De(s){let e,l,t='<label class="svelte-8jjakg"><input type="text" id="address" name="address" placeholder="@address@server.url" class="svelte-8jjakg"/></label>',i,c,o,a=s[3]&&de(s);return{c(){e=h("main"),l=h("form"),l.innerHTML=t,i=L(),a&&a.c(),this.h()},l(d){e=g(d,"MAIN",{class:!0});var p=S(e);l=g(p,"FORM",{id:!0,method:!0,class:!0,"data-svelte-h":!0}),W(l)!=="svelte-1m58q31"&&(l.innerHTML=t),i=M(p),a&&a.l(p),p.forEach(m),this.h()},h(){f(l,"id","profile"),f(l,"method","POST"),f(l,"class","svelte-8jjakg"),f(e,"class","svelte-8jjakg")},m(d,p){A(d,e,p),u(e,l),u(e,i),a&&a.m(e,null),c||(o=R(l,"submit",Q(s[4])),c=!0)},p(d,[p]){d[3]?a?a.p(d,p):(a=de(d),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:G,o:G,d(d){d&&m(e),a&&a.d(),c=!1,o()}}}function Le(s,e,l){let t,i,c,o;ie(s,Ce,_=>l(10,c=_)),ie(s,Te,_=>l(11,o=_));let a,d=null;be(()=>{d&&d.close()}),we(()=>(d=new EventSource("/api/user/"+B+"/events"),d.onmessage=_=>{console.log("event: "+_.data);let j=JSON.parse(_.data);if(console.log(j),j.uuid)t?.send_authorization(j.uuid);else if(j.type){let k=j;k.type=="Follow"&&k.object!==void 0&&String(k.object)==n?.id||k.type=="Accept"&&k.actor&&k.actor==n?.id?p():k.type=="Undo"&&k.object&&typeof k.object=="object"&&k.object.id==n?.ephemeralLeaderApId&&p().then(()=>{console.log("profile loaded")})}},()=>{d&&d.readyState===1&&d.close()}));async function p(){if(l(0,P=!1),l(1,H=!1),l(2,O=!1),l(3,n=null),i){const _=await t?.get_actor(i);_&&l(3,n=JSON.parse(_))}}async function U(_){let j=new FormData(_.target);console.log("looking up: "+j.get("address")),l(9,i=String(j.get("address"))),await p()}function z(_){n&&n.id?(console.log("following: "+n.id),t?.send_follow(n.id)):console.log("no profile loaded")}function T(_){n&&n.id?(console.log("unfollowing: "+n.id),t?.send_unfollow(n.id,String(n.ephemeralFollowActivityApId))):console.log("no profile loaded")}async function N(_){console.log(_);let j=t?.KexInitParams.new();if(t&&n&&n.id&&j){let k=(await t.get_state()).get_olm_pickled_account();console.log(k);let K=a(String(k));console.log("idk"),console.log(K),j.set_recipient_id(n.id),j.set_identity_key(String(K)),t?.send_kex_init(j).then(()=>{console.log("kexinit sent")})}}function V(_){console.log(_),n&&n.id&&Se(`/message?address=${n.id}`)}let P=!1,H=!1,O=!1,n=null,B=ne(ce).username;return ne(ce).display_name,s.$$.update=()=>{s.$$.dirty&2048&&(t=o),s.$$.dirty&1024&&l(9,i=c.url.searchParams.get("actor")),s.$$.dirty&512&&i&&p().then(()=>{console.debug("LOADED")})},[P,H,O,n,U,z,T,N,V,i,c,o]}class Ve extends Ee{constructor(e){super(),Fe(this,e,Le,De,ke,{})}}export{Ve as component};
