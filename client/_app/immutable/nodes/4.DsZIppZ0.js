import{S as H,i as A,s as D,n as k,d as f,b as M,c as p,m as O,y as P,o as g,e as v,f as F,B as S,h as w,G,j as _,k as C,l as N,p as T,D as R}from"../chunks/DR2rOELM.js";import"../chunks/IHki7fMi.js";import{a as L,e as U}from"../chunks/B4kYsGbE.js";import{g as I}from"../chunks/eEFvHPNh.js";function W(d){let a,l,t="ENIGMATICK",u,s,y=`<form method="dialog" class="svelte-1t5100b"><h3 class="svelte-1t5100b">Authentication Failed</h3> <p class="svelte-1t5100b">Either the information you submitted was incorrect, or there is a problem with the service.
				If you suspect the latter, please try again later.</p> <button class="svelte-1t5100b">Okay</button></form>`,c,n,o=`<label class="svelte-1t5100b">Username
			<input name="username" type="text" placeholder="bob" class="svelte-1t5100b"/></label> <label class="svelte-1t5100b">Password
			<input name="password" type="password" placeholder="Use a password manager" class="svelte-1t5100b"/></label> <button class="svelte-1t5100b">Sign In</button>`,m,e,i=`body {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  display: block;
  background: white;
}
@media screen and (max-width: 700px) {
  body {
    background: #fafafa;
  }
}`,b,x;return{c(){a=_("main"),l=_("h1"),l.textContent=t,u=C(),s=_("dialog"),s.innerHTML=y,c=C(),n=_("form"),n.innerHTML=o,m=C(),e=_("style"),e.textContent=i,this.h()},l(h){a=v(h,"MAIN",{class:!0});var r=F(a);l=v(r,"H1",{class:!0,"data-svelte-h":!0}),S(l)!=="svelte-1bn9c6g"&&(l.textContent=t),u=w(r),s=v(r,"DIALOG",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-7x3i2c"&&(s.innerHTML=y),c=w(r),n=v(r,"FORM",{id:!0,method:!0,class:!0,"data-svelte-h":!0}),S(n)!=="svelte-1b0v038"&&(n.innerHTML=o),r.forEach(f),m=w(h);const E=G("svelte-skzsmw",document.head);e=v(E,"STYLE",{lang:!0,"data-svelte-h":!0}),S(e)!=="svelte-1m6wti8"&&(e.textContent=i),E.forEach(f),this.h()},h(){g(l,"class","svelte-1t5100b"),g(s,"class","svelte-1t5100b"),g(n,"id","login"),g(n,"method","POST"),g(n,"class","svelte-1t5100b"),g(a,"class","svelte-1t5100b"),g(e,"lang","scss")},m(h,r){M(h,a,r),p(a,l),p(a,u),p(a,s),d[3](s),p(a,c),p(a,n),M(h,m,r),p(document.head,e),b||(x=O(n,"submit",P(d[1])),b=!0)},p:k,i:k,o:k,d(h){h&&(f(a),f(m)),d[3](null),f(e),b=!1,x()}}}function j(d,a,l){let t,u;N(d,U,o=>l(2,u=o));let s=T(L).username;s&&I("/@"+s).then(()=>{console.log("logged in")});async function y(o){let m=new FormData(o.target);console.log("clicked");let e=await(t==null?void 0:t.authenticate(String(m.get("username")),String(m.get("password"))));if(e){let i=await(t==null?void 0:t.load_instance_information());L.set({username:String(e==null?void 0:e.username),display_name:String(e==null?void 0:e.display_name),avatar:String(e==null?void 0:e.avatar_filename),domain:(i==null?void 0:i.domain)||null,url:(i==null?void 0:i.url)||null}),s=T(L).username;let b=t==null?void 0:t.get_state();if(console.debug(b),b){let x=await(t==null?void 0:t.replenish_mkp());console.debug(`REPLENISH RESULT: ${x}`)}I("/@"+s).then(()=>{console.log("logged in")})}else console.debug("authentication failed"),c.showModal()}let c;function n(o){R[o?"unshift":"push"](()=>{c=o,l(0,c)})}return d.$$.update=()=>{d.$$.dirty&4&&(t=u)},[c,y,u,n]}class Y extends H{constructor(a){super(),A(this,a,j,W,D,{})}}export{Y as component};
