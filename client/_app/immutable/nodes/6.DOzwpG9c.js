import"../chunks/CWj6FrbW.js";import{aL as Me,p as Fe,aC as J,S as Je,I as Be,E as e,A as a,w as y,aH as $,y as m,a as Ge,aJ as te,aI as S,z as d,D as c,aM as ae,aE as M,aG as B}from"../chunks/CPBLXjHw.js";import{i as U}from"../chunks/DQNDscH3.js";import{e as ve}from"../chunks/J1mst6rE.js";import{P as fe,h as re}from"../chunks/lslhiYcw.js";import{s as Q}from"../chunks/BjYZIULF.js";import{a as me,s as Ke}from"../chunks/DmKqPpxj.js";import{p as We}from"../chunks/NTu1Tg67.js";import{H as He}from"../chunks/_4yh5eBs.js";import{A as $e}from"../chunks/CbAUYwaI.js";import{e as Qe}from"../chunks/CS4B0N_g.js";import{D as R,i as q,e as Re,a as qe,b as oe,g as Ye,t as Ve,c as Xe,d as Ze}from"../chunks/CR2iVpIj.js";import{g as et}from"../chunks/BALzUkBY.js";var tt=y('<time class="article-date svelte-zu9b5f"> </time>'),at=y('<h1 class="article-title svelte-zu9b5f"><!></h1>'),rt=y('<img class="author-avatar svelte-zu9b5f" alt="Author avatar"/>'),ot=y('<span class="author-name svelte-zu9b5f"><!></span>'),st=y('<span class="author-name svelte-zu9b5f"> </span>'),it=y('<div class="author-card svelte-zu9b5f" role="button" tabindex="0"><!> <div class="author-info svelte-zu9b5f"><!> <span class="author-handle svelte-zu9b5f"> </span></div></div>'),nt=y('<a class="hashtag svelte-zu9b5f"> </a>'),lt=y('<div class="hashtags svelte-zu9b5f"></div>'),ct=y('<div class="article-content svelte-zu9b5f"><!></div>'),ut=y('<a class="svelte-zu9b5f"> </a>'),dt=y('<span class="svelte-zu9b5f"> </span>'),vt=y('<li class="svelte-zu9b5f"><!></li>'),ft=y('<button class="load-more svelte-zu9b5f"> </button>'),mt=y('<aside class="article-sidebar svelte-zu9b5f"><h2 class="svelte-zu9b5f">More Articles</h2> <ul class="article-list svelte-zu9b5f"></ul> <!></aside>'),pt=y('<div class="article-container svelte-zu9b5f"><div class="article-header-full svelte-zu9b5f"><div class="header-left svelte-zu9b5f"><!> <!></div> <!></div> <div class="article-content-layout svelte-zu9b5f"><article class="article-full svelte-zu9b5f"><!> <!></article> <!></div></div>'),bt=y('<div class="actor-card-overlay svelte-zu9b5f" role="dialog" aria-modal="true" tabindex="-1"><div class="actor-card-container svelte-zu9b5f"><!></div></div>'),_t=y('<!> <main class="svelte-zu9b5f"><!></main> <!>',1);function Nt(pe,be){Fe(be,!0);const _e=()=>me(Qe,"$enigmatickWasm",se),Y=()=>me(We,"$page",se),[se,he]=Ke();let n=te(_e);async function ge(){var o;if(e(n)){const v=Y().url.searchParams.get("uuid");if(!v){console.error("No UUID provided");return}if(v==="chess-demo"){const b={"@context":"https://www.w3.org/ns/activitystreams",type:"Person",id:"https://example.com/user/alice",preferredUsername:"alice",name:"Alice Chessmaster",inbox:"https://example.com/user/alice/inbox",outbox:"https://example.com/user/alice/outbox",followers:"https://example.com/user/alice/followers",following:"https://example.com/user/alice/following",publicKey:{id:"https://example.com/user/alice#main-key",owner:"https://example.com/user/alice",publicKeyPem:`-----BEGIN PUBLIC KEY-----
...
-----END PUBLIC KEY-----`},url:"https://example.com/@alice"},_={id:"https://example.com/user/bob",preferredUsername:"bob",name:"Bob Grandmaster",url:"https://example.com/@bob"},P={id:b.id,preferredUsername:b.preferredUsername,name:b.name,url:b.url,webfinger:"@alice@example.com"},z={id:_.id,preferredUsername:_.preferredUsername,name:_.name,url:_.url,webfinger:"@bob@example.com"},x={type:"Object",id:"https://example.com/chess/demo",attributedTo:[P,z],whitePlayer:"https://example.com/user/alice",blackPlayer:"https://example.com/user/bob",currentTurn:"white",chessState:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",gameStatus:"active",published:new Date().toISOString(),content:"A friendly game of chess over ActivityPub!",to:["https://www.w3.org/ns/activitystreams#Public"]};a(t,new R(b,x),!0),console.log("Loaded demo chess game:",e(t));return}console.log("LOADING PROFILE");let g=await fetch("/objects/"+Y().url.searchParams.get("uuid"),{headers:{Accept:"application/activity+json"}});if(!g.ok){console.error("Failed to fetch object:",g.status,g.statusText);const b=await g.text();console.error("Error response:",b),a(t,null);return}let f=await g.json();if(!f.attributedTo){console.error("Object missing attributedTo"),a(t,null);return}let w=await e(n).get_actor(f.attributedTo);if(!w){console.error("Failed to get actor for:",f.attributedTo),a(t,null);return}const p=JSON.parse(w);if(a(t,new R(p,f),!0),console.log(e(t)),q(f)&&p.preferredUsername){const _=e(n).get_state().get_server_url();(_&&((o=p.id)==null?void 0:o.includes(_))||!1)&&await xe(p.preferredUsername,f.id||"")}if(f.conversation){const b=Re(f.conversation);if(b){let _=await e(n).get_local_conversation(b);if(_){const P=JSON.parse(_);let z=new Map;for(const x of P)if(x.id&&x.id!=f.id){const T=x.attributedTo;if(typeof T=="string"){let G=await e(n).get_actor(T);if(G){const H=JSON.parse(G);z.set(String(x.id),new R(H,x)),a(t,new R(p,f,void 0,z),!0)}}}console.info(z)}}}}}let t=J(null),E=J(!1),C=J(null),I=J(Je([])),L=J(null),F=J(!1),V=new Map,ie=null;async function ne(o){return e(n)&&!V.has(o)&&V.set(o,await e(n).get_note(o)),V.get(o)}let X=J(null);async function xe(o,v){var f;if(!e(n))return;a(F,!0),a(I,[],!0),a(L,null),ie||(ie=new(e(n)).EnigmatickCache);const g=await e(n).get_outbox(o,[],void 0,void 0,"article");if(g)try{const w=JSON.parse(g),p=w.orderedItems||[],b=[];for(const _ of p)if(_.type==="Create"&&typeof _.object=="object"&&_.object!==null){const P=_.object;if(q(P)&&P.id!==v){const z=((f=P.ephemeral)==null?void 0:f.internalUuid)||null;b.push({id:P.id||"",name:P.name||"Untitled Article",uuid:z})}}a(I,b.slice(0,5),!0),a(L,w.next||null,!0)}catch(w){console.error("Failed to parse articles collection:",w)}a(F,!1)}async function ye(){var g,f;if(!e(n)||!e(L)||!((g=e(t))!=null&&g.actor))return;a(F,!0);const o=e(t).actor.preferredUsername;if(!o){a(F,!1);return}const v=Ze(e(L));if(v&&v.type&&v.value){const w=await e(n).get_outbox(o,[],v.type,v.value,"article");if(w)try{const p=JSON.parse(w),b=p.orderedItems||[],_=e(t).note.id,P=[];for(const z of b)if(z.type==="Create"&&typeof z.object=="object"&&z.object!==null){const x=z.object;if(q(x)&&x.id!==_){const T=((f=x.ephemeral)==null?void 0:f.internalUuid)||null;P.push({id:x.id||"",name:x.name||"Untitled Article",uuid:T})}}a(I,[...e(I),...P].slice(0,5),!0),a(L,p.next||null,!0)}catch(p){console.error("Failed to parse articles collection:",p)}}a(F,!1)}Be(()=>{const o=Y().url.searchParams.get("uuid");if(!o||!e(n)){a(t,null),a(X,null),a(I,[],!0),a(L,null);return}o!==e(X)&&(a(X,o,!0),a(t,null),a(I,[],!0),a(L,null),(async()=>{try{await ge(),console.log("loadObject")}catch(v){console.error("Error loading object:",v),a(t,null)}})())});var le=_t(),ce=$(le);He(ce,{});var Z=S(ce,2),we=d(Z);{var ze=o=>{fe(o,{get note(){return e(t)},cachedNote:ne})},Pe=o=>{var v=ae(),g=$(v);{var f=p=>{fe(p,{get note(){return e(t)},cachedNote:ne})},w=p=>{var b=ae(),_=$(b);{var P=z=>{var x=pt(),T=d(x),G=d(T),H=d(G);{var je=u=>{var l=tt(),k=d(l,!0);c(l),M(D=>{Q(l,"datetime",e(t).published),B(k,D)},[()=>new Date(e(t).published).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit"})]),m(u,l)};U(H,u=>{e(t).published&&u(je)})}var Ae=S(H,2);{var Se=u=>{var l=at(),k=d(l);re(k,()=>oe(e(n),e(t).note.name,e(t).note)),c(l),m(u,l)};U(Ae,u=>{e(t).note.name&&u(Se)})}c(G);var Ce=S(G,2);{var Ne=u=>{var l=it();l.__click=async()=>{var s;if((s=e(t))!=null&&s.actor){if("inbox"in e(t).actor&&"outbox"in e(t).actor)a(C,e(t).actor,!0),a(E,!0);else if(e(t).actor.id&&e(n)){const r=await e(n).get_actor(e(t).actor.id);r&&(a(C,JSON.parse(r),!0),a(E,!0))}}},l.__keydown=async s=>{var r;if((s.key==="Enter"||s.key===" ")&&(s.preventDefault(),(r=e(t))!=null&&r.actor)){if("inbox"in e(t).actor&&"outbox"in e(t).actor)a(C,e(t).actor,!0),a(E,!0);else if(e(t).actor.id&&e(n)){const i=await e(n).get_actor(e(t).actor.id);i&&(a(C,JSON.parse(i),!0),a(E,!0))}}};var k=d(l);{var D=s=>{var r=rt();M(i=>Q(r,"src",i),[()=>Xe(e(n),e(t).actor.icon.url)]),m(s,r)};U(k,s=>{var r;(r=e(t).actor.icon)!=null&&r.url&&s(D)})}var K=S(k,2),j=d(K);{var h=s=>{var r=ot(),i=d(r);re(i,()=>oe(e(n),e(t).actor.name,e(t).actor)),c(r),m(s,r)},A=s=>{var r=st(),i=d(r,!0);c(r),M(()=>B(i,e(t).actor.preferredUsername)),m(s,r)};U(j,s=>{e(t).actor.name?s(h):s(A,!1)})}var N=S(j,2),O=d(N,!0);c(N),c(K),c(l),M(s=>B(O,s),[()=>Ye(e(t).actor)]),m(u,l)};U(Ce,u=>{e(t).actor&&u(Ne)})}c(T);var ue=S(T,2),ee=d(ue),de=d(ee);{var Oe=u=>{const l=te(()=>Ve(e(t).note.tag)),k=te(()=>e(l).filter(h=>h.type==="Hashtag"));var D=ae(),K=$(D);{var j=h=>{var A=lt();ve(A,21,()=>e(k),N=>N.name||N.href,(N,O)=>{var s=nt(),r=d(s,!0);c(s),M((i,W)=>{Q(s,"href",i),B(r,W)},[()=>{var i;return e(O).href||`#${((i=e(O).name)==null?void 0:i.replace("#",""))||""}`},()=>{var i;return(i=e(O).name)!=null&&i.startsWith("#")?e(O).name:`#${e(O).name}`}]),m(N,s)}),c(A),m(h,A)};U(K,h=>{e(k).length>0&&h(j)})}m(u,D)};U(de,u=>{e(t).note.tag&&u(Oe)})}var Ee=S(de,2);{var Ie=u=>{var l=ct(),k=d(l);re(k,()=>oe(e(n),e(t).note.content,e(t).note)),c(l),m(u,l)};U(Ee,u=>{e(t).note.content&&u(Ie)})}c(ee);var Le=S(ee,2);{var Te=u=>{var l=mt(),k=S(d(l),2);ve(k,21,()=>e(I),j=>j.id,(j,h)=>{var A=vt(),N=d(A);{var O=r=>{var i=ut();i.__click=De=>{De.preventDefault(),et(`/objects?uuid=${e(h).uuid}`)};var W=d(i,!0);c(i),M(()=>{Q(i,"href",`/objects?uuid=${e(h).uuid??""}`),B(W,e(h).name)}),m(r,i)},s=r=>{var i=dt(),W=d(i,!0);c(i),M(()=>B(W,e(h).name)),m(r,i)};U(N,r=>{e(h).uuid?r(O):r(s,!1)})}c(A),m(j,A)}),c(k);var D=S(k,2);{var K=j=>{var h=ft();h.__click=ye;var A=d(h,!0);c(h),M(()=>{h.disabled=e(F),B(A,e(F)?"Loading...":"Load More")}),m(j,h)};U(D,j=>{e(L)&&j(K)})}c(l),m(u,l)};U(Le,u=>{e(I).length>0&&u(Te)})}c(ue),c(x),m(z,x)};U(_,z=>{e(n)&&e(t)&&q(e(t).note)&&z(P)},!0)}m(p,b)};U(g,p=>{e(n)&&e(t)&&(e(t).note.type==="Note"||e(t).note.type==="Question")?p(f):p(w,!1)},!0)}m(o,v)};U(we,o=>{e(n)&&e(t)&&qe(e(t).note)?o(ze):o(Pe,!1)})}c(Z);var ke=S(Z,2);{var Ue=o=>{var v=bt();v.__click=()=>{a(E,!1),a(C,null)},v.__keydown=w=>{w.key==="Escape"&&(a(E,!1),a(C,null))};var g=d(v);g.__click=w=>w.stopPropagation();var f=d(g);$e(f,{get actor(){return e(C)},onClose:()=>{a(E,!1),a(C,null)}}),c(g),c(v),m(o,v)};U(ke,o=>{e(E)&&e(C)&&o(Ue)})}m(pe,le),Ge(),he()}Me(["click","keydown"]);export{Nt as component};
