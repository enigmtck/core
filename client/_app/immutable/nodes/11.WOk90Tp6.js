import{_ as Fe}from"../chunks/preload-helper.0HuHagjb.js";import{s as Ge,a as z,f as j,c as F,g as J,h as q,u as ae,d as N,j as D,i as W,v as V,D as ne,I as Ve,M as je,w as Le,o as Ze,G as y,e as Q,E as qe,p as Ye,J as Je}from"../chunks/scheduler.tnyNm5U0.js";import{h as ie,u as We,R as Ke,A as Qe}from"../chunks/Article.IaakLnVK.js";import{e as ce}from"../chunks/each.-oqiv04n.js";import{S as Xe,i as xe,b as Se,d as ke,m as Oe,a as C,c as pe,t as B,e as Re,g as he}from"../chunks/index.R_ElRwcJ.js";import{C as et}from"../chunks/Compose.wT4Gt7uh.js";import{b as tt,g as nt}from"../chunks/navigation.Jx__BpAD.js";import{a as ot,e as rt}from"../chunks/stores.bABpd-zC.js";import{r as ue}from"../chunks/index.R4pWNgh9.js";import{c as fe,D as lt,s as se,i as Ne}from"../chunks/common.DsDv12mj.js";async function st(t,n){const r=t.getReader();let e;for(;!(e=await r.read()).done;)n(e.value)}function at(t){let n,r,e,o=!1;return function(c){n===void 0?(n=c,r=0,e=-1):n=ct(n,c);const s=n.length;let i=0;for(;r<s;){o&&(n[r]===10&&(i=++r),o=!1);let u=-1;for(;r<s&&u===-1;++r)switch(n[r]){case 58:e===-1&&(e=r-i);break;case 13:o=!0;case 10:u=r;break}if(u===-1)break;t(n.subarray(i,u),e),i=r,e=-1}i===s?n=void 0:i!==0&&(n=n.subarray(i),r-=i)}}function it(t,n,r){let e=Ce();const o=new TextDecoder;return function(c,s){if(c.length===0)r?.(e),e=Ce();else if(s>0){const i=o.decode(c.subarray(0,s)),u=s+(c[s+1]===32?2:1),v=o.decode(c.subarray(u));switch(i){case"data":e.data=e.data?e.data+`
`+v:v;break;case"event":e.event=v;break;case"id":t(e.id=v);break;case"retry":const T=parseInt(v,10);isNaN(T)||n(e.retry=T);break}}}}function ct(t,n){const r=new Uint8Array(t.length+n.length);return r.set(t),r.set(n,t.length),r}function Ce(){return{data:"",event:"",id:"",retry:void 0}}var ut=function(t,n){var r={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.indexOf(e)<0&&(r[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,e=Object.getOwnPropertySymbols(t);o<e.length;o++)n.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(t,e[o])&&(r[e[o]]=t[e[o]]);return r};const Ee="text/event-stream",ft=1e3,Ie="last-event-id";function dt(t,n){var{signal:r,headers:e,onopen:o,onmessage:l,onclose:c,onerror:s,openWhenHidden:i,fetch:u}=n,v=ut(n,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((T,O)=>{const g=Object.assign({},e);g.accept||(g.accept=Ee);let b;function R(){b.abort(),document.hidden||m()}i||document.addEventListener("visibilitychange",R);let L=ft,M=0;function H(){document.removeEventListener("visibilitychange",R),window.clearTimeout(M),b.abort()}r?.addEventListener("abort",()=>{H(),T()});const A=u??window.fetch,I=o??pt;async function m(){var P;b=new AbortController;try{const w=await A(t,Object.assign(Object.assign({},v),{headers:g,signal:b.signal}));await I(w),await st(w.body,at(it(d=>{d?g[Ie]=d:delete g[Ie]},d=>{L=d},l))),c?.(),H(),T()}catch(w){if(!b.signal.aborted)try{const d=(P=s?.(w))!==null&&P!==void 0?P:L;window.clearTimeout(M),M=window.setTimeout(m,d)}catch(d){H(),O(d)}}}m()})}function pt(t){const n=t.headers.get("content-type");if(!n?.startsWith(Ee))throw new Error(`Expected content-type to be ${Ee}, Actual: ${n}`)}const de=typeof document<"u",ht=0,mt=1,te=2;function gt({resource:t,options:n,onIdFound:r}){const e=new Map;let o=ht;const l=new AbortController,c=!0,s=n?{...n}:{};async function i(){de&&(await dt(`${t}`,{openWhenHidden:c,...s,method:"POST",async onopen({headers:g}){if(!r)return;const b=g.get("x-sse-id");b&&r(b??"")},onmessage({id:g,event:b,data:R}){O({id:g,event:b,data:R})},onclose(){o=te,T({})},onerror(g){o=te,v(g)},signal:l.signal}),o=mt)}function u({reason:g}){l.abort(g),o=te,T({})}function v({error:g}){const b=e.get("error")??[];for(const R of b)R({id:"",event:"",data:"",error:g,connect:i,close:u})}function T({error:g}){const b=e.get("close")??[];for(const R of b)R({id:"",event:"",data:"",error:g,connect:i,close:u})}function O({id:g,event:b,data:R}){const L=decodeURIComponent(R),M=e.get(b)??[];for(const H of M)H({id:g,event:b,data:L,connect:i,close:u})}return i(),{get url(){return`${t}`},get readyState(){return o},addEventListener(g,b){e.has(g)||e.set(g,[]),(e.get(g)??[]).push(b)},removeEventListener(g,b){if(!e.has(g))return;const L=(e.get(g)??[]).filter(function(H){return H!==b});e.set(g,L)},close:u}}const K=new Map;async function we({resource:t}){const n=`${t}`,r=K.get(n);if(r){const{eventSource:e}=r;e.readyState!==te&&(r.eventSource.close({}),r.stopBeacon()),r.connectionsCounter--,r.connectionsCounter<0&&(r.connectionsCounter=0),r.connectionsCounter===0&&K.delete(n)}}function vt({resource:t,beacon:n=5e3,options:r={}}){const e=`${t}`;if(!K.has(e)){let s=!1;const i=gt({resource:t,beacon:n,options:r,onIdFound(T){n<=0||(s=setInterval(function(){navigator.sendBeacon(t.toString()+"?"+T)},n))}}),u=function(){s&&clearInterval(s)};i.addEventListener("close",u),i.addEventListener("error",u);const v={resource:t,eventSource:i,connectionsCounter:0,stopBeacon:u};return K.set(e,v),v}const o=K.get(e);if(!o)throw new Error(`Could not find reference for ${e}.`);const{eventSource:l,stopBeacon:c}=o;if(l.readyState===te){const s={resource:t,eventSource:l,connectionsCounter:0,stopBeacon:c};return K.set(e,s),s}return o.connectionsCounter<0?o.connectionsCounter=1:o.connectionsCounter++,o}function bt({connected:t,eventName:n,readables:r,state:e}){const{eventSource:o,resource:l}=t;return ue("",function(s){function i(u){s(u.data)}return o.addEventListener(n,i),async function(){e.eventsCounter--,await we({resource:l}),o.removeEventListener(n,i),r.delete(n)}})}function _t({connected:t,eventName:n}){return function(e){if(!de)return ue("");const{eventSource:o}=t,l=new ReadableStream({start(c){o.addEventListener(n,function(i){c.enqueue(i.data)})}});return e(l)}}function yt({error:t,previous:n}){return console.error(t),n}function Et(t,{close:n,error:r,beacon:e=5e3,options:o={}}={}){let l={eventsCounter:0},c=new Map;const s=vt({resource:t,beacon:e,options:o}),{eventSource:i}=s;return r&&i.addEventListener("error",r),n&&i.addEventListener("close",n),{close(){return de?we({resource:t}):Promise.resolve()},select(u){if(u.includes(`
`))throw new Error(`The name of the event must not contain new line characters, received "${u}"`);const v=typeof u;if(v!=="string")throw new Error(`Event name must be of type \`string\`, received \`${v}\`.`);c.has(u)||c.set(u,bt({connected:s,eventName:u,readables:c,state:l})),l.eventsCounter++;const T=c.get(u);if(!T)throw new Error(`Could not find event ${u}.`);return{subscribe:T.subscribe,transform:_t({connected:s,eventName:u}),json(O=yt){return de?this.transform(function(R){let L=null;const M=R.getReader();return ue(L,function(A){const I=async function(){try{const{done:P,value:w}=await M.read();if(P)return;try{L=JSON.parse(w),A(L)}catch(d){A(O({previous:L,raw:w,error:d}))}I()}catch(P){A(O({previous:L,raw:"",error:P}))}};return I(),function(){we({resource:t}),M.cancel()}})}):ue(null)}}}}}function Me(t,n,r){const e=t.slice();return e[41]=n[r],e}function De(t,n,r){const e=t.slice();return e[44]=n[r],e}function wt(t){let n,r='<i class="fa-solid fa-house svelte-1f6ptaa"></i>Home',e,o,l='<i class="fa-solid fa-city svelte-1f6ptaa"></i>Local',c,s;return{c(){n=j("button"),n.innerHTML=r,e=z(),o=j("button"),o.innerHTML=l,this.h()},l(i){n=J(i,"BUTTON",{class:!0,"data-view":!0,"data-svelte-h":!0}),ae(n)!=="svelte-e533dz"&&(n.innerHTML=r),e=F(i),o=J(i,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),ae(o)!=="svelte-bi7xl3"&&(o.innerHTML=l),this.h()},h(){D(n,"class","selected svelte-1f6ptaa"),D(n,"data-view","home"),D(o,"data-view","local"),D(o,"class","svelte-1f6ptaa")},m(i,u){W(i,n,u),W(i,e,u),W(i,o,u),c||(s=[ne(n,"click",t[7]),ne(o,"click",t[7])],c=!0)},p:y,d(i){i&&(N(n),N(e),N(o)),c=!1,je(s)}}}function He(t){let n,r,e,o,l={ctx:t,current:null,token:null,hasCatch:!1,pending:At,then:St,catch:Tt,value:47,blocks:[,,,]};ie(n=t[5](t[41].note),l);let c=t[41].note.id==t[1]&&t[41].replies?.size&&$e(t);return{c(){l.block.c(),r=z(),c&&c.c(),e=Q()},l(s){l.block.l(s),r=F(s),c&&c.l(s),e=Q()},m(s,i){l.block.m(s,l.anchor=i),l.mount=()=>r.parentNode,l.anchor=r,W(s,r,i),c&&c.m(s,i),W(s,e,i),o=!0},p(s,i){t=s,l.ctx=t,i[0]&8&&n!==(n=t[5](t[41].note))&&ie(n,l)||We(l,t,i),t[41].note.id==t[1]&&t[41].replies?.size?c?(c.p(t,i),i[0]&10&&C(c,1)):(c=$e(t),c.c(),C(c,1),c.m(e.parentNode,e)):c&&(he(),B(c,1,1,()=>{c=null}),pe())},i(s){o||(C(l.block),C(c),o=!0)},o(s){for(let i=0;i<3;i+=1){const u=l.blocks[i];B(u)}B(c),o=!1},d(s){s&&(N(r),N(e)),l.block.d(s),l.token=null,l=null,c&&c.d(s)}}}function Tt(t){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function St(t){let n,r,e,o={ctx:t,current:null,token:null,hasCatch:!1,pending:Rt,then:Ot,catch:kt,value:48,blocks:[,,,]};return ie(r=t[6](t[41].note),o),{c(){n=Q(),o.block.c()},l(l){n=Q(),o.block.l(l)},m(l,c){W(l,n,c),o.block.m(l,o.anchor=c),o.mount=()=>n.parentNode,o.anchor=n,e=!0},p(l,c){t=l,o.ctx=t,c[0]&8&&r!==(r=t[6](t[41].note))&&ie(r,o)||We(o,t,c)},i(l){e||(C(o.block),e=!0)},o(l){for(let c=0;c<3;c+=1){const s=o.blocks[c];B(s)}e=!1},d(l){l&&N(n),o.block.d(l),o.token=null,o=null}}}function kt(t){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function Ot(t){let n,r;return n=new Qe({props:{remove:Ct,refresh:Nt,note:t[41],username:t[11],replyToHeader:t[47],announceHeader:t[48],renderAction:t[4]}}),n.$on("replyTo",function(){Je(t[0].handleReplyToMessage)&&t[0].handleReplyToMessage.apply(this,arguments)}),n.$on("noteSelect",t[8]),{c(){Se(n.$$.fragment)},l(e){ke(n.$$.fragment,e)},m(e,o){Oe(n,e,o),r=!0},p(e,o){t=e;const l={};o[0]&8&&(l.note=t[41]),o[0]&8&&(l.replyToHeader=t[47]),o[0]&8&&(l.announceHeader=t[48]),n.$set(l)},i(e){r||(C(n.$$.fragment,e),r=!0)},o(e){B(n.$$.fragment,e),r=!1},d(e){Re(n,e)}}}function Rt(t){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function At(t){return{c:y,l:y,m:y,p:y,i:y,o:y,d:y}}function $e(t){let n,r,e,o=ce(Array.from(t[41].replies.values()).sort(fe)),l=[];for(let s=0;s<o.length;s+=1)l[s]=Be(De(t,o,s));const c=s=>B(l[s],1,1,()=>{l[s]=null});return{c(){n=j("div");for(let s=0;s<l.length;s+=1)l[s].c();r=z(),this.h()},l(s){n=J(s,"DIV",{class:!0});var i=q(n);for(let u=0;u<l.length;u+=1)l[u].l(i);r=F(i),i.forEach(N),this.h()},h(){D(n,"class","replies svelte-1f6ptaa")},m(s,i){W(s,n,i);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(n,null);V(n,r),e=!0},p(s,i){if(i[0]&2313){o=ce(Array.from(s[41].replies.values()).sort(fe));let u;for(u=0;u<o.length;u+=1){const v=De(s,o,u);l[u]?(l[u].p(v,i),C(l[u],1)):(l[u]=Be(v),l[u].c(),C(l[u],1),l[u].m(n,r))}for(he(),u=o.length;u<l.length;u+=1)c(u);pe()}},i(s){if(!e){for(let i=0;i<o.length;i+=1)C(l[i]);e=!0}},o(s){l=l.filter(Boolean);for(let i=0;i<l.length;i+=1)B(l[i]);e=!1},d(s){s&&N(n),Ve(l,s)}}}function Be(t){let n,r;return n=new Ke({props:{note:t[44],username:t[11]}}),n.$on("replyTo",function(){Je(t[0].handleReplyToMessage)&&t[0].handleReplyToMessage.apply(this,arguments)}),n.$on("noteSelect",t[8]),{c(){Se(n.$$.fragment)},l(e){ke(n.$$.fragment,e)},m(e,o){Oe(n,e,o),r=!0},p(e,o){t=e;const l={};o[0]&8&&(l.note=t[44]),n.$set(l)},i(e){r||(C(n.$$.fragment,e),r=!0)},o(e){B(n.$$.fragment,e),r=!1},d(e){Re(n,e)}}}function Pe(t){let n,r,e=t[41].note&&(!t[1]&&(!t[41].note.inReplyTo||t[41].note.ephemeralAnnounces?.length)||t[41].note.id==t[1])&&He(t);return{c(){e&&e.c(),n=Q()},l(o){e&&e.l(o),n=Q()},m(o,l){e&&e.m(o,l),W(o,n,l),r=!0},p(o,l){o[41].note&&(!o[1]&&(!o[41].note.inReplyTo||o[41].note.ephemeralAnnounces?.length)||o[41].note.id==o[1])?e?(e.p(o,l),l[0]&10&&C(e,1)):(e=He(o),e.c(),C(e,1),e.m(n.parentNode,n)):e&&(he(),B(e,1,1,()=>{e=null}),pe())},i(o){r||(C(e),r=!0)},o(o){B(e),r=!1},d(o){o&&N(n),e&&e.d(o)}}}function Ue(t){let n,r,e,o;return{c(){n=j("div"),r=j("i"),this.h()},l(l){n=J(l,"DIV",{class:!0});var c=q(n);r=J(c,"I",{class:!0}),q(r).forEach(N),c.forEach(N),this.h()},h(){D(r,"class","fa-solid fa-angles-left svelte-1f6ptaa"),D(n,"class","back svelte-1f6ptaa")},m(l,c){W(l,n,c),V(n,r),e||(o=ne(r,"click",qe(t[9])),e=!0)},p:y,d(l){l&&N(n),e=!1,o()}}}function Lt(t){let n,r,e,o,l,c,s,i='<i class="fa-solid fa-globe svelte-1f6ptaa"></i>Global',u,v,T,O,g='<i class="fa-solid fa-chevron-up svelte-1f6ptaa"></i>',b,R,L,M,H={senderFunction:t[10]};n=new et({props:H}),t[15](n);let A=t[11]&&wt(t),I=ce(Array.from(t[3].values()).sort(fe).reverse()),m=[];for(let d=0;d<I.length;d+=1)m[d]=Pe(Me(t,I,d));const P=d=>B(m[d],1,1,()=>{m[d]=null});let w=(t[1]||t[2])&&Ue(t);return{c(){Se(n.$$.fragment),r=z(),e=j("main"),o=j("header"),l=j("nav"),A&&A.c(),c=z(),s=j("button"),s.innerHTML=i,u=z(),v=j("div");for(let d=0;d<m.length;d+=1)m[d].c();T=z(),O=j("div"),O.innerHTML=g,b=z(),w&&w.c(),this.h()},l(d){ke(n.$$.fragment,d),r=F(d),e=J(d,"MAIN",{class:!0});var E=q(e);o=J(E,"HEADER",{class:!0});var $=q(o);l=J($,"NAV",{class:!0});var S=q(l);A&&A.l(S),c=F(S),s=J(S,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),ae(s)!=="svelte-v94doe"&&(s.innerHTML=i),S.forEach(N),$.forEach(N),u=F(E),v=J(E,"DIV",{class:!0});var G=q(v);for(let X=0;X<m.length;X+=1)m[X].l(G);G.forEach(N),T=F(E),O=J(E,"DIV",{class:!0,"data-svelte-h":!0}),ae(O)!=="svelte-14v484t"&&(O.innerHTML=g),b=F(E),w&&w.l(E),E.forEach(N),this.h()},h(){D(s,"data-view","global"),D(s,"class","svelte-1f6ptaa"),D(l,"class","svelte-1f6ptaa"),D(o,"class","svelte-1f6ptaa"),D(v,"class","scrollable svelte-1f6ptaa"),D(O,"class","scroll svelte-1f6ptaa"),D(e,"class","svelte-1f6ptaa")},m(d,E){Oe(n,d,E),W(d,r,E),W(d,e,E),V(e,o),V(o,l),A&&A.m(l,null),V(l,c),V(l,s),V(e,u),V(e,v);for(let $=0;$<m.length;$+=1)m[$]&&m[$].m(v,null);V(e,T),V(e,O),V(e,b),w&&w.m(e,null),R=!0,L||(M=[ne(s,"click",t[7]),ne(O,"click",Te)],L=!0)},p(d,E){const $={};if(n.$set($),d[11]&&A.p(d,E),E[0]&2427){I=ce(Array.from(d[3].values()).sort(fe).reverse());let S;for(S=0;S<I.length;S+=1){const G=Me(d,I,S);m[S]?(m[S].p(G,E),C(m[S],1)):(m[S]=Pe(G),m[S].c(),C(m[S],1),m[S].m(v,null))}for(he(),S=I.length;S<m.length;S+=1)P(S);pe()}d[1]||d[2]?w?w.p(d,E):(w=Ue(d),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i(d){if(!R){C(n.$$.fragment,d);for(let E=0;E<I.length;E+=1)C(m[E]);R=!0}},o(d){B(n.$$.fragment,d),m=m.filter(Boolean);for(let E=0;E<m.length;E+=1)B(m[E]);R=!1},d(d){d&&(N(r),N(e)),t[15](null),Re(n,d),A&&A.d(),Ve(m,d),w&&w.d(),L=!1,je(M)}}}function ye(t){if(t)try{return JSON.parse(t)}catch{return console.error("UNABLE TO PARSE PROFILE"),console.debug(t),null}else return console.error("UNABLE TO PARSE NULL OR UNDEFINED"),null}function Te(){const t=document.getElementsByClassName("scrollable")[0];let n=t.scrollTop;return t.scrollTop=0,n}function Nt(){console.debug("REFRESH")}function Ct(){console.debug("REMOVE")}function It(t,n,r){let e,o,l,c,s;Le(t,ot,a=>r(13,c=a)),Le(t,rt,a=>r(14,s=a));let i,u=null,v=null,T=new Set,O=new Array;function g(a){for(let f of a)if(f.target){let p=f.target;if(f.isIntersecting){if(O.push(p.id),p.dataset){let h=p.dataset;if(console.log(h.conversation),o&&h.conversation){let _=h.conversation;T.has(_)||(T.add(_),o.get_conversation(h.conversation,0,50).then(k=>{if(k){let U=JSON.parse(k);U.forEach(Ae=>{Ae.inReplyTo&&A(Ae)}),console.log(U),b(!0)}}))}}}else{let h=O.indexOf(p.id);h!==-1&&O.splice(h,1)}}}function b(a){new Map(Y).forEach((p,h)=>{p.note.inReplyTo&&(l.has(p.note.inReplyTo)?(Y.delete(h),H(p)):a&&Y.has(p.note.inReplyTo)&&b(!1))})}function R(a){v&&v.observe(a)}Ze(async()=>{const{Buffer:a}=await Fe(()=>import("../chunks/index.aMiLl7Je.js").then(p=>p.i),__vite__mapDeps([0,1]),import.meta.url);window.Buffer=a;let f=document.getElementsByClassName("scrollable")[0];v=new IntersectionObserver(g,{root:null,threshold:.3}),f&&f.addEventListener("scroll",E),ge?(e="home",Et("/api/user/"+ge+"/events",{close({connect:p}){console.log("event stream closed"),se(500).then(()=>{p()})}}).select("message").subscribe(p=>{if(p)try{let h=JSON.parse(p);if(console.log(h),h.type==="Note"){let _=h;oe||_.inReplyTo?A(_):le.push(_),ee+=1}else if(o&&h.uuid)u=h.uuid,o.send_authorization(u).then(_=>{console.info(`AUTHORIZATION SENT FOR ${u}`)});else if(o&&h.type=="Announce"){let _=h;o.get_note(_.object).then(k=>{try{let U=JSON.parse(String(k));U.ephemeralAnnounces=[_.actor],U.id=_.id,U.published=_.published,U.ephemeralTimestamp=_.published,oe?A(U):le.push(U),ee+=1}catch{console.error("FAILED TO ADD NOTE"),console.error(k)}})}}catch{console.error("FAILED TO PARSE SSE MESSAGE"),console.error(p)}})):e="global"});async function L(a){if(a.inReplyTo){const f=await S(a.inReplyTo);if(f){const p=JSON.parse(String(f)),h=await $(p.attributedTo),_=ye(h);return _&&o?Ne(o,_.name||_.preferredUsername,_):null}else return null}else return null}async function M(a){if(a.ephemeralAnnounces){const f=await $(a.ephemeralAnnounces[0]);let p="";if(a.ephemeralAnnounces.length==2?p=` and ${a.ephemeralAnnounces.length-1} other`:a.ephemeralAnnounces.length>2&&(p=` and ${a.ephemeralAnnounces.length-1} others`),f){const h=ye(f);if(h&&o){const _=Ne(o,h.name||h.preferredUsername,h);return{url:h.url,name:_,others:p}}else return null}else return null}else return null}function H(a){const f=a.note;if(f.inReplyTo){let p=x.get(String(f.inReplyTo));if(p){let h=l.get(p[0]);if(p.forEach((_,k,U)=>{k>0&&(h=h?.replies.get(_))}),h?.note.id==f.inReplyTo){h.replies.set(String(f.id),a);let _=[...p];_.push(String(f.id)),x.set(String(f.id),_)}else console.error("TRAVERSAL ENDED SOMEWHERE UNEXPECTED")}else a.note.id&&Y.set(a.note.id,a)}else l.get(String(f.id))||(l.set(String(f.id),a),x.set(String(f.id),[String(f.id)]))}async function A(a){if(a.ephemeralActors&&a.ephemeralActors.forEach(f=>{f.id&&Z.set(f.id,JSON.stringify(f))}),a.ephemeralLikes&&(console.debug("EPHEMERAL LIKES"),console.debug(a.ephemeralLikes)),a.attributedTo){const f=await $(a.attributedTo);if(f){const p=ye(f);if(p){const h=new lt(p,a);H(h)}r(3,l)}}}function I(){let a=0;if(l.forEach(f=>{f.note.inReplyTo||(a+=1)}),a<10)try{m().then(f=>{console.debug("TIMELINE LENGTH: "+f),f>0&&I()})}catch(f){console.error(f)}}async function m(){let f=0;if(o&&e){let p=await o.get_timeline(ee,20,e);console.debug("WASM RESPONSE"),console.debug(p);try{let h=JSON.parse(String(p));console.debug(h);let _=O[0];try{h.forEach(k=>{A(k)})}catch(k){console.error(k),console.debug(h)}return h.length>0&&_&&document.getElementById(_)?.scrollIntoView(),b(!0),console.log(x),console.info(Y),ee+=20,h.length}catch(h){for(console.error(h),console.debug(p);f++<10;)await se(1e3),await m(),console.debug("RETRYING TIMELINE")}}else console.error("NO WASM OR VIEW YET"),await se(500),await m()}tt(a=>{if(console.log(a),a.to&&a.to.route.id===null){let f=a.to.url.href;const p=/^https:\/\/(:?[a-zA-Z0-9\-]+)(:?\.[a-zA-Z0-9\-]+)+?\/@[a-zA-Z0-9_]+$/;f.match(p)&&(console.log(f),a.cancel(),nt(`/search?actor=${f}`))}});async function P(a){if(console.log(a),a.target){let f=a.target.dataset.view;f&&(Array.from(document.getElementsByTagName("header")[0].getElementsByTagName("nav")[0].getElementsByTagName("button")).forEach(p=>p.classList.remove("selected")),a.target.classList.add("selected"),e=f,X(),await I())}}function w(a){console.debug("NOTE SELECT"),console.debug(a),r(2,be=a.detail.replyToConversation),r(1,ve=a.detail.replyToNote),console.debug(`setting focusNote to ${a.detail.replyToNote}`),_e=Te(),re=!0,console.debug("MESSAGE DETAIL"),console.debug(a.detail),i.handleReplyToMessage({detail:a.detail})}function d(){r(2,be=null),r(1,ve=null),i.resetCompose(),se(500).then(()=>{const a=document.getElementsByTagName("main")[0];a.scrollTop=_e}),re=!1}async function E(){const a=document.getElementsByClassName("scrollable")[0];if(!me&&!re){me=!0;let p=1;for(;!re&&a.scrollTop+a.offsetHeight>=a.scrollHeight*.8&&p>0;)p=await m();me=!1}const f=document.getElementsByClassName("scroll")[0];if(a.scrollTop<50){oe=!0;let p;for(;(p=le.shift())!==void 0;)A(p);f.style.display="none"}else oe=!1,f.style.display="revert"}async function $(a){return o&&!Z.has(a)&&Z.set(a,await o.get_actor(a)),Z.get(a)}async function S(a){return o&&!Z.has(a)&&Z.set(a,await o.get_note(a)),Z.get(a)}async function G(a,f,p,h,_){if(o){let k=(await o.SendParams.new()).set_content(h).set_public();return k=k.set_attachments(JSON.stringify(_)),f&&(k=await k.add_recipient_id(String(a),!0),k=k.set_in_reply_to(String(f)),k=k.set_conversation(String(p))),await o.send_note(k)}else return!1}function X(){le=[],x=new Map,Y=new Map,ee=0,r(3,l=new Map),T=new Set,_e=Te();const a=document.getElementsByClassName("scroll")[0];a.style.display="none"}let oe=!0,re=!1,le=[],x=new Map,Y=new Map,me=!1,ee=0,Z=new Map,ge=c.username,ve=null,be=null,_e=0;function ze(a){Ye[a?"unshift":"push"](()=>{i=a,r(0,i)})}return t.$$.update=()=>{t.$$.dirty[0]&16384&&r(12,o=s),t.$$.dirty[0]&8192&&c.avatar,t.$$.dirty[0]&4096&&o&&I()},e="",r(3,l=new Map),[i,ve,be,l,R,L,M,P,w,d,G,ge,o,c,s,ze]}class Wt extends Xe{constructor(n){super(),xe(this,n,It,Lt,Ge,{},null,[-1,-1])}}export{Wt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["../chunks/index.aMiLl7Je.js","../chunks/_commonjsHelpers.5-cIlDoe.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}