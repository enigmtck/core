import{s as B,f as P,g as J,h as z,d as p,j as C,i as g,w as A,a as G,e as E,c as U,H as K}from"../chunks/scheduler.vJi1FF2t.js";import{S as Q,i as X,a as f,t as u,c as v,b as F,d as H,m as L,g as w,e as T}from"../chunks/index.NkgvvCTc.js";import{e as O,c as j,D as b,k as Y}from"../chunks/common.iVHbJUVt.js";import{p as Z}from"../chunks/stores.RFVp_Ggc.js";import{A as x,R as ee}from"../chunks/Article.F1uC_LI8.js";import{e as te}from"../chunks/stores.Q3fukup_.js";function R(i,r,s){const e=i.slice();return e[7]=r[s],e}function D(i){let r,s,e,t;r=new x({props:{remove:V,refresh:re,note:i[1],username:null,renderAction:ne,cachedNote:i[2]}});let n=i[1].replies?.size&&I(i);return{c(){F(r.$$.fragment),s=G(),n&&n.c(),e=E()},l(o){H(r.$$.fragment,o),s=U(o),n&&n.l(o),e=E()},m(o,l){L(r,o,l),g(o,s,l),n&&n.m(o,l),g(o,e,l),t=!0},p(o,l){const a={};l&2&&(a.note=o[1]),r.$set(a),o[1].replies?.size?n?(n.p(o,l),l&2&&f(n,1)):(n=I(o),n.c(),f(n,1),n.m(e.parentNode,e)):n&&(w(),u(n,1,1,()=>{n=null}),v())},i(o){t||(f(r.$$.fragment,o),f(n),t=!0)},o(o){u(r.$$.fragment,o),u(n),t=!1},d(o){o&&(p(s),p(e)),T(r,o),n&&n.d(o)}}}function I(i){let r,s,e=O(Array.from(i[1].replies.values()).sort(j)),t=[];for(let o=0;o<e.length;o+=1)t[o]=M(R(i,e,o));const n=o=>u(t[o],1,1,()=>{t[o]=null});return{c(){r=P("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){r=J(o,"DIV",{class:!0});var l=z(r);for(let a=0;a<t.length;a+=1)t[a].l(l);l.forEach(p),this.h()},h(){C(r,"class","replies svelte-1dm0tnx")},m(o,l){g(o,r,l);for(let a=0;a<t.length;a+=1)t[a]&&t[a].m(r,null);s=!0},p(o,l){if(l&2){e=O(Array.from(o[1].replies.values()).sort(j));let a;for(a=0;a<e.length;a+=1){const h=R(o,e,a);t[a]?(t[a].p(h,l),f(t[a],1)):(t[a]=M(h),t[a].c(),f(t[a],1),t[a].m(r,null))}for(w(),a=e.length;a<t.length;a+=1)n(a);v()}},i(o){if(!s){for(let l=0;l<e.length;l+=1)f(t[l]);s=!0}},o(o){t=t.filter(Boolean);for(let l=0;l<t.length;l+=1)u(t[l]);s=!1},d(o){o&&p(r),K(t,o)}}}function M(i){let r,s;return r=new ee({props:{note:i[7],username:null,remove:V}}),{c(){F(r.$$.fragment)},l(e){H(r.$$.fragment,e)},m(e,t){L(r,e,t),s=!0},p(e,t){const n={};t&2&&(n.note=e[7]),r.$set(n)},i(e){s||(f(r.$$.fragment,e),s=!0)},o(e){u(r.$$.fragment,e),s=!1},d(e){T(r,e)}}}function oe(i){let r,s,e=i[0]&&i[1]&&D(i);return{c(){r=P("main"),e&&e.c(),this.h()},l(t){r=J(t,"MAIN",{class:!0});var n=z(r);e&&e.l(n),n.forEach(p),this.h()},h(){C(r,"class","svelte-1dm0tnx")},m(t,n){g(t,r,n),e&&e.m(r,null),s=!0},p(t,[n]){t[0]&&t[1]?e?(e.p(t,n),n&3&&f(e,1)):(e=D(t),e.c(),f(e,1),e.m(r,null)):e&&(w(),u(e,1,1,()=>{e=null}),v())},i(t){s||(f(e),s=!0)},o(t){u(e),s=!1},d(t){t&&p(r),e&&e.d()}}}function re(){console.debug("REFRESH")}function V(){console.debug("REMOVE")}function ne(i){}function ae(i,r,s){let e,t,n;A(i,Z,c=>s(3,t=c)),A(i,te,c=>s(4,n=c));async function o(){if(e){console.log("LOADING PROFILE");let m=await(await fetch("/objects/"+t.url.searchParams.get("uuid"),{headers:{Accept:"application/activity+json"}})).json(),y=await e.get_actor(m.attributedTo);if(y){const k=JSON.parse(y);if(s(1,l=new b(k,m)),console.log(l),m.conversation){const $=Y(m.conversation);if($){let S=await e.get_local_conversation($);if(S){const W=JSON.parse(S);let d=new Map;for(const _ of W)if(_.id&&_.id!=m.id){let N=await e.get_actor(_.attributedTo);if(N){const q=JSON.parse(N);d.set(String(_.id),new b(q,_)),s(1,l=new b(k,m,void 0,d))}}console.info(d)}}}}}}let l=null,a=new Map;async function h(c){return e&&!a.has(c)&&a.set(c,await e.get_note(c)),a.get(c)}return i.$$.update=()=>{i.$$.dirty&16&&s(0,e=n),i.$$.dirty&9&&e&&t.url.searchParams.get("uuid")&&(async()=>{try{await o(),console.log("loadObject")}catch(c){console.error("Error loading object:",c)}})()},[e,l,h,t,n]}class me extends Q{constructor(r){super(),X(this,r,ae,oe,B,{})}}export{me as component};
