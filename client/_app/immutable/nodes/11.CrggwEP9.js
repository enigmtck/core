import{S as Ne,i as Ve,s as Be,n as pe,d as T,N as Ze,b as Z,c as y,m as U,o as _,e as D,f as N,h as V,z as G,j as M,k as B,a as Je,g as De,t as Me,B as ae,C as ve,D as Fe,r as te,u as J,w as Oe,H as ke,F as we,I as be,J as ye,l as _e,q as Ge,v as Pe,x as Ae,G as Qe,A as ee,Z as Ke,_ as Xe}from"../chunks/Bme_sf2i.js";import{e as ge,s as Ce,f as Ye,D as xe,h as $e}from"../chunks/DD9C-qjT.js";import"../chunks/IHki7fMi.js";import{a as et,e as tt}from"../chunks/BigVxDb3.js";import{A as st}from"../chunks/CkBrkEuw.js";import{C as lt}from"../chunks/D8uejoQU.js";import{b as at,g as nt}from"../chunks/BQPeWUxY.js";import{r as Ee}from"../chunks/B4fNvM9E.js";import"../chunks/C2jeIaVt.js";const it=t=>typeof window>"u"||!t?Ee(!1):Ee(!1,a=>{const s=window.matchMedia(t);a(s.matches);const n=r=>a(r.matches);return s.addEventListener("change",n),()=>{s.removeEventListener("change",n)}});function Se(t,e,a){const s=t.slice();return s[6]=e[a],s}function Le(t){let e,a,s=t[6]+"",n,r,o,f;return{c(){e=M("a"),a=Me("#"),n=Me(s),this.h()},l(h){e=D(h,"A",{href:!0,title:!0,"data-tag":!0,class:!0});var i=N(e);a=De(i,"#"),n=De(i,s),i.forEach(T),this.h()},h(){_(e,"href","#filters"),_(e,"title","Delete"),_(e,"data-tag",r=t[6]),_(e,"class","svelte-1g70ie2")},m(h,i){Z(h,e,i),y(e,a),y(e,n),o||(f=U(e,"click",t[3]),o=!0)},p(h,i){i&1&&s!==(s=h[6]+"")&&Je(n,s),i&1&&r!==(r=h[6])&&_(e,"data-tag",r)},d(h){h&&T(e),o=!1,f()}}}function ot(t){let e,a,s,n,r='<input type="text" name="statement" placeholder="Filter Statement (e.g., #Enigmatick)" class="svelte-1g70ie2"/>',o,f,h=ge(t[0]),i=[];for(let m=0;m<h.length;m+=1)i[m]=Le(Se(t,h,m));return{c(){e=M("div"),a=M("div");for(let m=0;m<i.length;m+=1)i[m].c();s=B(),n=M("form"),n.innerHTML=r,this.h()},l(m){e=D(m,"DIV",{class:!0});var c=N(e);a=D(c,"DIV",{class:!0});var p=N(a);for(let E=0;E<i.length;E+=1)i[E].l(p);p.forEach(T),s=V(c),n=D(c,"FORM",{class:!0,"data-svelte-h":!0}),G(n)!=="svelte-ghbe8s"&&(n.innerHTML=r),c.forEach(T),this.h()},h(){_(a,"class","svelte-1g70ie2"),_(n,"class","svelte-1g70ie2"),_(e,"class","filters svelte-1g70ie2")},m(m,c){Z(m,e,c),y(e,a);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(a,null);y(e,s),y(e,n),t[5](n),o||(f=U(n,"submit",t[2]),o=!0)},p(m,[c]){if(c&9){h=ge(m[0]);let p;for(p=0;p<h.length;p+=1){const E=Se(m,h,p);i[p]?i[p].p(E,c):(i[p]=Le(E),i[p].c(),i[p].m(a,null))}for(;p<i.length;p+=1)i[p].d(1);i.length=h.length}},i:pe,o:pe,d(m){m&&T(e),Ze(i,m),t[5](null),o=!1,f()}}}function rt(t,e,a){let{resetData:s}=e,{hashtags:n}=e,r;const o=i=>{var p;i.preventDefault();const m=new FormData(r);let c;(c=(p=m.get("statement"))==null?void 0:p.toString().trim())&&(c=c.startsWith("#")?c.slice(1):c,n.add(c.toString().toLowerCase()),a(0,n),s()),r.reset()},f=i=>{i.preventDefault();let c=i.target.dataset.tag;c&&(n.delete(c),a(0,n),s())};function h(i){ae[i?"unshift":"push"](()=>{r=i,a(1,r)})}return t.$$set=i=>{"resetData"in i&&a(4,s=i.resetData),"hashtags"in i&&a(0,n=i.hashtags)},[n,r,o,f,s,h]}class ct extends Ne{constructor(e){super(),Ve(this,e,rt,ot,Be,{resetData:4,hashtags:0})}}function He(t,e,a){const s=t.slice();return s[49]=e[a],s[50]=e,s[51]=a,s}function ft(t){let e,a='<i class="fa-solid fa-house svelte-wy5xij"></i>',s,n,r='<i class="fa-solid fa-hotel svelte-wy5xij"></i>',o,f,h='<i class="fa-solid fa-at svelte-wy5xij"></i>',i,m;return{c(){e=M("button"),e.innerHTML=a,s=B(),n=M("button"),n.innerHTML=r,o=B(),f=M("button"),f.innerHTML=h,this.h()},l(c){e=D(c,"BUTTON",{class:!0,"data-view":!0,"data-svelte-h":!0}),G(e)!=="svelte-1agtoqw"&&(e.innerHTML=a),s=V(c),n=D(c,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),G(n)!=="svelte-173hbjd"&&(n.innerHTML=r),o=V(c),f=D(c,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),G(f)!=="svelte-1jv3lro"&&(f.innerHTML=h),this.h()},h(){_(e,"class","selected svelte-wy5xij"),_(e,"data-view","home"),_(n,"data-view","local"),_(n,"class","svelte-wy5xij"),_(f,"data-view","direct"),_(f,"class","svelte-wy5xij")},m(c,p){Z(c,e,p),Z(c,s,p),Z(c,n,p),Z(c,o,p),Z(c,f,p),i||(m=[U(e,"click",t[12]),U(n,"click",t[12]),U(f,"click",t[12])],i=!0)},p:pe,d(c){c&&(T(e),T(s),T(n),T(o),T(f)),i=!1,Fe(m)}}}function ze(t){let e,a=t[51],s;const n=()=>t[25](e,a),r=()=>t[25](null,a);let o={parentArticle:t[7][t[51]],remove:t[17],note:t[49],cachedNote:t[15]};return e=new st({props:o}),n(),e.$on("replyTo",function(){Xe(t[0].handleReplyToMessage)&&t[0].handleReplyToMessage.apply(this,arguments)}),{c(){ye(e.$$.fragment)},l(f){be(e.$$.fragment,f)},m(f,h){we(e,f,h),s=!0},p(f,h){t=f,a!==t[51]&&(r(),a=t[51],n());const i={};h[0]&128&&(i.parentArticle=t[7][t[51]]),h[0]&256&&(i.note=t[49]),e.$set(i)},i(f){s||(J(e.$$.fragment,f),s=!0)},o(f){te(e.$$.fragment,f),s=!1},d(f){r(),ve(e,f)}}}function Ie(t){var n,r;let e,a,s=t[49].note&&(!t[3]&&(!t[49].note.inReplyTo||((r=(n=t[49].note.ephemeral)==null?void 0:n.announces)==null?void 0:r.length))||t[49].note.id==t[3])&&ze(t);return{c(){s&&s.c(),e=Ae()},l(o){s&&s.l(o),e=Ae()},m(o,f){s&&s.m(o,f),Z(o,e,f),a=!0},p(o,f){var h,i;o[49].note&&(!o[3]&&(!o[49].note.inReplyTo||(i=(h=o[49].note.ephemeral)==null?void 0:h.announces)!=null&&i.length)||o[49].note.id==o[3])?s?(s.p(o,f),f[0]&264&&J(s,1)):(s=ze(o),s.c(),J(s,1),s.m(e.parentNode,e)):s&&(Pe(),te(s,1,1,()=>{s=null}),Oe())},i(o){a||(J(s),a=!0)},o(o){te(s),a=!1},d(o){o&&T(e),s&&s.d(o)}}}function Re(t){let e,a='<i class="fa-solid fa-angles-left svelte-wy5xij"></i>',s,n;return{c(){e=M("div"),e.innerHTML=a,this.h()},l(r){e=D(r,"DIV",{class:!0,"data-svelte-h":!0}),G(e)!=="svelte-1x9brsn"&&(e.innerHTML=a),this.h()},h(){_(e,"class","back svelte-wy5xij")},m(r,o){Z(r,e,o),s||(n=U(e,"click",Qe(t[13])),s=!0)},p:pe,d(r){r&&T(e),s=!1,n()}}}function ut(t){let e,a,s,n,r,o,f,h,i='<i class="fa-solid fa-globe svelte-wy5xij"></i>',m,c,p='<i class="fa-solid fa-chevron-up svelte-wy5xij"></i>',E,I,Y,Q,F,S,W,ne="Filters",ie,O,oe,q,H,ue="Â ",K,X,re,ce={senderFunction:t[16],direct:t[9]==="direct"};e=new lt({props:ce}),t[23](e),e.$on("publish",t[24]);let L=t[20]&&ft(t),R=ge(Array.from(t[8].values())),v=[];for(let u=0;u<R.length;u+=1)v[u]=Ie(He(t,R,u));const he=u=>te(v[u],1,1,()=>{v[u]=null});let j=(t[3]||t[4])&&Re(t);return O=new ct({props:{hashtags:t[2],resetData:t[18]}}),{c(){ye(e.$$.fragment),a=B(),s=M("main"),n=M("div"),r=M("header"),o=M("nav"),L&&L.c(),f=B(),h=M("button"),h.innerHTML=i,m=B(),c=M("div"),c.innerHTML=p,E=B(),I=M("div");for(let u=0;u<v.length;u+=1)v[u].c();Y=B(),j&&j.c(),Q=B(),F=M("div"),S=M("div"),W=M("h1"),W.textContent=ne,ie=B(),ye(O.$$.fragment),oe=B(),q=M("div"),H=M("a"),H.textContent=ue,this.h()},l(u){be(e.$$.fragment,u),a=V(u),s=D(u,"MAIN",{class:!0});var w=N(s);n=D(w,"DIV",{class:!0});var g=N(n);r=D(g,"HEADER",{class:!0});var P=N(r);o=D(P,"NAV",{class:!0});var b=N(o);L&&L.l(b),f=V(b),h=D(b,"BUTTON",{"data-view":!0,class:!0,"data-svelte-h":!0}),G(h)!=="svelte-1446o8e"&&(h.innerHTML=i),b.forEach(T),m=V(P),c=D(P,"DIV",{class:!0,"data-svelte-h":!0}),G(c)!=="svelte-iaaual"&&(c.innerHTML=p),P.forEach(T),E=V(g),I=D(g,"DIV",{class:!0});var x=N(I);for(let fe=0;fe<v.length;fe+=1)v[fe].l(x);x.forEach(T),Y=V(g),j&&j.l(g),g.forEach(T),Q=V(w),F=D(w,"DIV",{class:!0});var se=N(F);S=D(se,"DIV",{style:!0,class:!0});var le=N(S);W=D(le,"H1",{class:!0,"data-svelte-h":!0}),G(W)!=="svelte-lvj8b"&&(W.textContent=ne),ie=V(le),be(O.$$.fragment,le),le.forEach(T),oe=V(se),q=D(se,"DIV",{class:!0});var de=N(q);H=D(de,"A",{href:!0,class:!0,"data-svelte-h":!0}),G(H)!=="svelte-8mgpvu"&&(H.textContent=ue),de.forEach(T),se.forEach(T),w.forEach(T),this.h()},h(){_(h,"data-view","global"),_(h,"class","svelte-wy5xij"),_(o,"class","svelte-wy5xij"),_(c,"class","scroll svelte-wy5xij"),_(r,"class","svelte-wy5xij"),_(I,"class","scrollable svelte-wy5xij"),_(n,"class","content svelte-wy5xij"),_(W,"class","svelte-wy5xij"),ke(S,"display",t[10]?"none":"flex"),_(S,"class","svelte-wy5xij"),_(H,"href","#filters"),_(H,"class","svelte-wy5xij"),_(q,"class","handle svelte-wy5xij"),_(F,"class","context svelte-wy5xij"),_(s,"class","svelte-wy5xij")},m(u,w){we(e,u,w),Z(u,a,w),Z(u,s,w),y(s,n),y(n,r),y(r,o),L&&L.m(o,null),y(o,f),y(o,h),y(r,m),y(r,c),y(n,E),y(n,I);for(let g=0;g<v.length;g+=1)v[g]&&v[g].m(I,null);t[26](I),y(n,Y),j&&j.m(n,null),y(s,Q),y(s,F),y(F,S),y(S,W),y(S,ie),we(O,S,null),t[27](S),y(F,oe),y(F,q),y(q,H),t[28](q),K=!0,X||(re=[U(h,"click",t[12]),U(c,"click",t[14]),U(I,"scroll",t[21]),U(H,"click",t[19])],X=!0)},p(u,w){const g={};if(w[0]&512&&(g.direct=u[9]==="direct"),e.$set(g),u[20]&&L.p(u,w),w[0]&164233){R=ge(Array.from(u[8].values()));let b;for(b=0;b<R.length;b+=1){const x=He(u,R,b);v[b]?(v[b].p(x,w),J(v[b],1)):(v[b]=Ie(x),v[b].c(),J(v[b],1),v[b].m(I,null))}for(Pe(),b=R.length;b<v.length;b+=1)he(b);Oe()}u[3]||u[4]?j?j.p(u,w):(j=Re(u),j.c(),j.m(n,null)):j&&(j.d(1),j=null);const P={};w[0]&4&&(P.hashtags=u[2]),O.$set(P),(!K||w[0]&1024)&&ke(S,"display",u[10]?"none":"flex")},i(u){if(!K){J(e.$$.fragment,u);for(let w=0;w<R.length;w+=1)J(v[w]);J(O.$$.fragment,u),K=!0}},o(u){te(e.$$.fragment,u),v=v.filter(Boolean);for(let w=0;w<v.length;w+=1)te(v[w]);te(O.$$.fragment,u),K=!1},d(u){u&&(T(a),T(s)),t[23](null),ve(e,u),L&&L.d(),Ze(v,u),t[26](null),j&&j.d(),ve(O),t[27](null),t[28](null),X=!1,Fe(re)}}}let ht=0;function dt(t,e,a){let s,n,r,o,f,h;_e(t,et,l=>a(38,o=l)),_e(t,tt,l=>a(22,f=l));let i,m;const c=it("(max-width: 1000px)");_e(t,c,l=>a(10,h=l)),Ge(async()=>{g&&g.addEventListener("scroll",ie),he?a(9,s="home"):a(9,s="global"),await Y()});const p=async l=>{if(console.debug(`Placing ${l.note.id}`),!l.note.inReplyTo&&l.note.id){r.has(l.note.id)||r.set(l.note.id,l),await E(!0,0);return}const d=k=>{for(const[,A]of k.entries()){if(A.note.id===l.note.inReplyTo&&l.note.id)return A.replies.has(l.note.id)||A.replies.set(l.note.id,l),!0;if(d(A.replies))return!0}return!1};if(l.note.inReplyTo&&d(r)){await E(!1);return}await E(!1)},E=async(l,d)=>{try{let k=P;if(a(8,r),l&&d){for(let A=0;A<d;A++)await ee();g.scrollTo({top:k,left:0,behavior:"instant"})}}catch(k){console.error(k)}},I=async l=>{var d,k,A;if(console.debug(`Adding ${l.object.id}`),console.debug(l.object),l.object.attributedTo){console.debug(`Attributed to ${(d=l.object.ephemeral)==null?void 0:d.attributedTo}`);const z=(A=(k=l.object.ephemeral)==null?void 0:k.attributedTo)==null?void 0:A.at(0);if(z){const C=new xe(z,l.object,l);await p(C)}}},Y=async()=>{let l=0;if(r.forEach(d=>{d.note.inReplyTo||(l+=1)}),l<10)try{let d=await Q();d&&d>0&&await Y()}catch(d){console.error(d)}},Q=async()=>{var k;let d=0;if(n&&s&&g){K||(K=new n.EnigmatickCache);let A=await n.get_timeline(R,void 0,20,s,X);try{let z=JSON.parse(String(A));if(z.next){const C=Ye(z.next);C.type==="max"&&C.value&&(R=C.value)}try{(k=z.orderedItems)==null||k.forEach(C=>{I(C)})}catch(C){console.error(C)}return length}catch(z){for(console.error(z);d++<10;)await Ce(1e3),await Q()}}else await Ce(500),await Q()};at(async l=>{if(l.to&&l.to.route.id===null){let d=l.to.url.href;const k=/^https:\/\/(?:[a-zA-Z0-9\-]+)(?:\.[a-zA-Z0-9\-]+)+?\/@[a-zA-Z0-9_]+$/,A=/^https:\/\/(?:[a-zA-Z0-9\-]+)(?:\.[a-zA-Z0-9\-]+)+?\/tags\/([a-zA-Z0-9\-_]+)$/,z=/^https:\/\/(?:[a-zA-Z0-9\-]+)(?:\.[a-zA-Z0-9\-]+)+?\/search\?tag=([a-zA-Z0-9\-_]+)$/;let C;if(d.match(k)){let me=$e(d);me&&(l.cancel(),nt(`/${me}`))}else((C=d.match(A))||(C=d.match(z)))&&(X.add(C[1].toLowerCase()),l.cancel(),a(2,X),H())}});const F=async l=>{if(l.target){let d=l.target.dataset.view;d&&(Array.from(document.getElementsByTagName("header")[0].getElementsByTagName("nav")[0].getElementsByTagName("button")).forEach(k=>k.classList.remove("selected")),l.target.classList.add("selected"),a(9,s=d),await H())}},S=async()=>{a(4,u=null),a(3,j=null),i.resetCompose(),await W(),ce=!1},W=async()=>{await ee(),await ee(),await ee(),g.scrollTo({top:ht,left:0,behavior:"instant"})},ne=async()=>{let l=g.scrollTop;return await ee(),await ee(),await ee(),g.scrollTo({top:0,left:0,behavior:"instant"}),l},ie=async()=>{if(!L&&!ce&&!j){L=!0;let d=1;for(;!ce&&g.scrollTop+g.offsetHeight>=g.scrollHeight*.9&&d>0;)d=await Q()||0;L=!1}const l=document.getElementsByClassName("scroll")[0];g.scrollTop<50?(re=!0,l.style.display="none"):(re=!1,l.style.display="revert")},O=async l=>{n&&!v.has(l)&&v.set(l,n.get_note(l));const d=v.get(l);return d&&d instanceof Promise?await d:d},oe=async(l,d,k,A,z,C,me)=>{var Te;if(n){let $=(await n.SendParams.new()).set_content(k);me||$.set_public(),$.set_attachments(JSON.stringify(A)),$.set_hashtags(C);for(const[qe,je]of z)$.add_mention(qe,je.id||"",((Te=je.capabilities)==null?void 0:Te.enigmatickEncryption)||!1);return d&&($.set_in_reply_to(String(d.note.id)),$.set_conversation(String(d.note.conversation))),await n.send_note($)}else return null},q=()=>{},H=async()=>{S(),a(8,r=new Map),await ne(),R=void 0;const l=document.getElementsByClassName("scroll")[0];l.style.display="none",await Y()},ue=l=>{l&&l.preventDefault(),m.style.display==="none"?a(1,m.style.display="flex",m):a(1,m.style.display="none",m)};let K=null,X=new Set,re=!0,ce=!1,L=!1,R,v=new Map,he=o.username,j=null,u=null,w,g,P=0,b=[];const x=l=>{!L&&!j&&(P=g.scrollTop)};function se(l){ae[l?"unshift":"push"](()=>{i=l,a(0,i)})}function le(l){Ke.call(this,t,l)}function de(l,d){ae[l?"unshift":"push"](()=>{b[d]=l,a(7,b)})}function fe(l){ae[l?"unshift":"push"](()=>{g=l,a(6,g)})}function Ue(l){ae[l?"unshift":"push"](()=>{m=l,a(1,m)})}function We(l){ae[l?"unshift":"push"](()=>{w=l,a(5,w)})}return t.$$.update=()=>{t.$$.dirty[0]&4194304&&(n=f)},a(9,s=""),a(8,r=new Map),[i,m,X,j,u,w,g,b,r,s,h,c,F,S,ne,O,oe,q,H,ue,he,x,f,se,le,de,fe,Ue,We]}class jt extends Ne{constructor(e){super(),Ve(this,e,dt,ut,Be,{},null,[-1,-1])}}export{jt as component};
