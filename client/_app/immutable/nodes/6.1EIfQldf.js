import"../chunks/CWj6FrbW.js";import{p as I,y as J,v as e,r as s,k as w,n as b,a as M,aD as W,aw as $,q as C,u as x,aB as L,aC as q}from"../chunks/C-PNKZ_s.js";import{i as N}from"../chunks/CPpPu6cz.js";import{e as B,i as G}from"../chunks/gGHH_MYY.js";import{a as S,s as V}from"../chunks/ChSDbmkr.js";import{p as H}from"../chunks/D7gh-3I6.js";import{A as K,R as Q}from"../chunks/CLkBcGVC.js";import{e as X}from"../chunks/n0qzx-_D.js";import{D as h,e as Y,c as Z}from"../chunks/CT8Pszs0.js";var ee=w('<div class="replies svelte-zu9b5f"></div>'),te=w("<!> <!>",1),re=w('<main class="svelte-zu9b5f"><!></main>');function pe(k,A){I(A,!0);const D=()=>S(X,"$enigmatickWasm",y),d=()=>S(H,"$page",y),[y,E]=V();let i=W(D);async function P(){if(e(i)){if(!d().url.searchParams.get("uuid")){console.error("No UUID provided");return}console.log("LOADING PROFILE");let a=await fetch("/objects/"+d().url.searchParams.get("uuid"),{headers:{Accept:"application/activity+json"}});if(!a.ok){console.error("Failed to fetch object:",a.status,a.statusText);const c=await a.text();console.error("Error response:",c),s(t,null);return}let o=await a.json();if(!o.attributedTo){console.error("Object missing attributedTo"),s(t,null);return}let f=await e(i).get_actor(o.attributedTo);if(!f){console.error("Failed to get actor for:",o.attributedTo),s(t,null);return}const p=JSON.parse(f);if(s(t,new h(p,o),!0),console.log(e(t)),o.conversation){const c=Y(o.conversation);if(c){let n=await e(i).get_local_conversation(c);if(n){const _=JSON.parse(n);let l=new Map;for(const u of _)if(u.id&&u.id!=o.id){const j=u.attributedTo;if(typeof j=="string"){let T=await e(i).get_actor(j);if(T){const F=JSON.parse(T);l.set(String(u.id),new h(F,u)),s(t,new h(p,o,void 0,l),!0)}}}console.info(l)}}}}}function O(){console.debug("REMOVE")}let t=$(null),m=new Map;async function R(r){return e(i)&&!m.has(r)&&m.set(r,await e(i).get_note(r)),m.get(r)}let g=$(null);J(()=>{const r=d().url.searchParams.get("uuid");if(!r||!e(i)){s(t,null),s(g,null);return}r!==e(g)&&(s(g,r,!0),s(t,null),(async()=>{try{await P(),console.log("loadObject")}catch(a){console.error("Error loading object:",a),s(t,null)}})())});var v=re(),U=C(v);{var z=r=>{var a=te(),o=L(a);K(o,{remove:O,get note(){return e(t)},cachedNote:R});var f=q(o,2);{var p=c=>{var n=ee();B(n,21,()=>Array.from(e(t).replies.values()).sort(Z),G,(_,l)=>{Q(_,{get note(){return e(l)},username:null,remove:O})}),x(n),b(c,n)};N(f,c=>{var n;(n=e(t).replies)!=null&&n.size&&c(p)})}b(r,a)};N(U,r=>{e(i)&&e(t)&&r(z)})}x(v),b(k,v),M(),E()}export{pe as component};
