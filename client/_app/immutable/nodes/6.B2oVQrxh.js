import{S as G,i as H,s as K,d as _,I as u,J as f,K as v,b as g,o as D,e as J,f as L,j as z,l as O,L as C,M as y,N as F,O as T,h as U,r as A,P as V,k as Q,v as X}from"../chunks/DR2rOELM.js";import{D as b,a as Y,e as E,b as j}from"../chunks/CV3kTBDU.js";import"../chunks/IHki7fMi.js";import{p as Z}from"../chunks/DX1v6C1c.js";import{A as x,R as ee}from"../chunks/B-rSUPNY.js";import{e as te}from"../chunks/B4kYsGbE.js";function R(i,r,s){const e=i.slice();return e[7]=r[s],e}function I(i){var l;let r,s,e,t;r=new x({props:{remove:W,refresh:re,note:i[1],username:null,renderAction:ne,cachedNote:i[2]}});let n=((l=i[1].replies)==null?void 0:l.size)&&M(i);return{c(){V(r.$$.fragment),s=Q(),n&&n.c(),e=A()},l(o){T(r.$$.fragment,o),s=U(o),n&&n.l(o),e=A()},m(o,a){F(r,o,a),g(o,s,a),n&&n.m(o,a),g(o,e,a),t=!0},p(o,a){var c;const m={};a&2&&(m.note=o[1]),r.$set(m),(c=o[1].replies)!=null&&c.size?n?(n.p(o,a),a&2&&f(n,1)):(n=M(o),n.c(),f(n,1),n.m(e.parentNode,e)):n&&(y(),u(n,1,1,()=>{n=null}),v())},i(o){t||(f(r.$$.fragment,o),f(n),t=!0)},o(o){u(r.$$.fragment,o),u(n),t=!1},d(o){o&&(_(s),_(e)),C(r,o),n&&n.d(o)}}}function M(i){let r,s,e=E(Array.from(i[1].replies.values()).sort(j)),t=[];for(let l=0;l<e.length;l+=1)t[l]=P(R(i,e,l));const n=l=>u(t[l],1,1,()=>{t[l]=null});return{c(){r=z("div");for(let l=0;l<t.length;l+=1)t[l].c();this.h()},l(l){r=J(l,"DIV",{class:!0});var o=L(r);for(let a=0;a<t.length;a+=1)t[a].l(o);o.forEach(_),this.h()},h(){D(r,"class","replies svelte-1dm0tnx")},m(l,o){g(l,r,o);for(let a=0;a<t.length;a+=1)t[a]&&t[a].m(r,null);s=!0},p(l,o){if(o&2){e=E(Array.from(l[1].replies.values()).sort(j));let a;for(a=0;a<e.length;a+=1){const m=R(l,e,a);t[a]?(t[a].p(m,o),f(t[a],1)):(t[a]=P(m),t[a].c(),f(t[a],1),t[a].m(r,null))}for(y(),a=e.length;a<t.length;a+=1)n(a);v()}},i(l){if(!s){for(let o=0;o<e.length;o+=1)f(t[o]);s=!0}},o(l){t=t.filter(Boolean);for(let o=0;o<t.length;o+=1)u(t[o]);s=!1},d(l){l&&_(r),X(t,l)}}}function P(i){let r,s;return r=new ee({props:{note:i[7],username:null,remove:W}}),{c(){V(r.$$.fragment)},l(e){T(r.$$.fragment,e)},m(e,t){F(r,e,t),s=!0},p(e,t){const n={};t&2&&(n.note=e[7]),r.$set(n)},i(e){s||(f(r.$$.fragment,e),s=!0)},o(e){u(r.$$.fragment,e),s=!1},d(e){C(r,e)}}}function oe(i){let r,s,e=i[0]&&i[1]&&I(i);return{c(){r=z("main"),e&&e.c(),this.h()},l(t){r=J(t,"MAIN",{class:!0});var n=L(r);e&&e.l(n),n.forEach(_),this.h()},h(){D(r,"class","svelte-1dm0tnx")},m(t,n){g(t,r,n),e&&e.m(r,null),s=!0},p(t,[n]){t[0]&&t[1]?e?(e.p(t,n),n&3&&f(e,1)):(e=I(t),e.c(),f(e,1),e.m(r,null)):e&&(y(),u(e,1,1,()=>{e=null}),v())},i(t){s||(f(e),s=!0)},o(t){u(e),s=!1},d(t){t&&_(r),e&&e.d()}}}function re(){console.debug("REFRESH")}function W(){console.debug("REMOVE")}function ne(i){}function ae(i,r,s){let e,t,n;O(i,Z,c=>s(3,t=c)),O(i,te,c=>s(4,n=c));async function l(){if(e){console.log("LOADING PROFILE");let p=await(await fetch("/objects/"+t.url.searchParams.get("uuid"),{headers:{Accept:"application/activity+json"}})).json(),w=await e.get_actor(p.attributedTo);if(w){const k=JSON.parse(w);if(s(1,o=new b(k,p)),console.log(o),p.conversation){const $=Y(p.conversation);if($){let N=await e.get_local_conversation($);if(N){const q=JSON.parse(N);let d=new Map;for(const h of q)if(h.id&&h.id!=p.id){let S=await e.get_actor(h.attributedTo);if(S){const B=JSON.parse(S);d.set(String(h.id),new b(B,h)),s(1,o=new b(k,p,void 0,d))}}console.info(d)}}}}}}let o=null,a=new Map;async function m(c){return e&&!a.has(c)&&a.set(c,await e.get_note(c)),a.get(c)}return i.$$.update=()=>{i.$$.dirty&16&&s(0,e=n),i.$$.dirty&9&&e&&t.url.searchParams.get("uuid")&&(async()=>{try{await l(),console.log("loadObject")}catch(c){console.error("Error loading object:",c)}})()},[e,o,m,t,n]}class me extends G{constructor(r){super(),H(this,r,ae,oe,K,{})}}export{me as component};
