import{s as W,f as D,g as j,h as H,d as m,j as J,i as _,w as S,a as q,e as A,c as B,I as C}from"../chunks/scheduler.tnyNm5U0.js";import{S as G,i as U,a as c,t as u,c as d,b as M,d as T,m as z,g as v,e as F}from"../chunks/index.R_ElRwcJ.js";import{e as E}from"../chunks/each.-oqiv04n.js";import{p as K}from"../chunks/stores.JRRNFnPI.js";import{A as Q,R as X}from"../chunks/Article.22avzd8z.js";import{e as Y}from"../chunks/stores.bABpd-zC.js";import{c as N,D as g,e as Z}from"../chunks/common.wRqRBlgV.js";function O(s,r,i){const e=s.slice();return e[5]=r[i],e}function P(s){let r,i,e,t;r=new Q({props:{remove:te,refresh:ee,note:s[1],username:null,replyToHeader:null,announceHeader:null,renderAction:oe}});let n=s[1].replies?.size&&R(s);return{c(){M(r.$$.fragment),i=q(),n&&n.c(),e=A()},l(o){T(r.$$.fragment,o),i=B(o),n&&n.l(o),e=A()},m(o,a){z(r,o,a),_(o,i,a),n&&n.m(o,a),_(o,e,a),t=!0},p(o,a){const l={};a&2&&(l.note=o[1]),r.$set(l),o[1].replies?.size?n?(n.p(o,a),a&2&&c(n,1)):(n=R(o),n.c(),c(n,1),n.m(e.parentNode,e)):n&&(v(),u(n,1,1,()=>{n=null}),d())},i(o){t||(c(r.$$.fragment,o),c(n),t=!0)},o(o){u(r.$$.fragment,o),u(n),t=!1},d(o){o&&(m(i),m(e)),F(r,o),n&&n.d(o)}}}function R(s){let r,i,e=E(Array.from(s[1].replies.values()).sort(N)),t=[];for(let o=0;o<e.length;o+=1)t[o]=I(O(s,e,o));const n=o=>u(t[o],1,1,()=>{t[o]=null});return{c(){r=D("div");for(let o=0;o<t.length;o+=1)t[o].c();this.h()},l(o){r=j(o,"DIV",{class:!0});var a=H(r);for(let l=0;l<t.length;l+=1)t[l].l(a);a.forEach(m),this.h()},h(){J(r,"class","replies svelte-1dm0tnx")},m(o,a){_(o,r,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(r,null);i=!0},p(o,a){if(a&2){e=E(Array.from(o[1].replies.values()).sort(N));let l;for(l=0;l<e.length;l+=1){const f=O(o,e,l);t[l]?(t[l].p(f,a),c(t[l],1)):(t[l]=I(f),t[l].c(),c(t[l],1),t[l].m(r,null))}for(v(),l=e.length;l<t.length;l+=1)n(l);d()}},i(o){if(!i){for(let a=0;a<e.length;a+=1)c(t[a]);i=!0}},o(o){t=t.filter(Boolean);for(let a=0;a<t.length;a+=1)u(t[a]);i=!1},d(o){o&&m(r),C(t,o)}}}function I(s){let r,i;return r=new X({props:{note:s[5],username:null}}),{c(){M(r.$$.fragment)},l(e){T(r.$$.fragment,e)},m(e,t){z(r,e,t),i=!0},p(e,t){const n={};t&2&&(n.note=e[5]),r.$set(n)},i(e){i||(c(r.$$.fragment,e),i=!0)},o(e){u(r.$$.fragment,e),i=!1},d(e){F(r,e)}}}function x(s){let r,i,e=s[0]&&s[1]&&P(s);return{c(){r=D("main"),e&&e.c(),this.h()},l(t){r=j(t,"MAIN",{class:!0});var n=H(r);e&&e.l(n),n.forEach(m),this.h()},h(){J(r,"class","svelte-1dm0tnx")},m(t,n){_(t,r,n),e&&e.m(r,null),i=!0},p(t,[n]){t[0]&&t[1]?e?(e.p(t,n),n&3&&c(e,1)):(e=P(t),e.c(),c(e,1),e.m(r,null)):e&&(v(),u(e,1,1,()=>{e=null}),d())},i(t){i||(c(e),i=!0)},o(t){u(e),i=!1},d(t){t&&m(r),e&&e.d()}}}function ee(){console.debug("REFRESH")}function te(){console.debug("REMOVE")}function oe(s){}function re(s,r,i){let e,t,n;S(s,K,l=>i(2,t=l)),S(s,Y,l=>i(3,n=l));async function o(){if(e){console.log("LOADING PROFILE");let f=await(await fetch("/notes/"+t.url.searchParams.get("uuid"),{headers:{Accept:"application/activity+json"}})).json(),b=await e.get_actor(f.attributedTo);if(b){const y=JSON.parse(b);if(i(1,a=new g(y,f)),console.log(a),f.conversation){const w=Z(f.conversation);if(w){let $=await e.get_local_conversation(w);if($){const L=JSON.parse($);let h=new Map;for(const p of L)if(p.id&&p.id!=f.id){let k=await e.get_actor(p.attributedTo);if(k){const V=JSON.parse(k);h.set(String(p.id),new g(V,p)),i(1,a=new g(y,f,h))}}console.info(h)}}}}}}let a=null;return s.$$.update=()=>{s.$$.dirty&8&&i(0,e=n),s.$$.dirty&5&&e&&t.url.searchParams.get("uuid")&&o().then(()=>{console.log("loadProfile")})},[e,a,t,n]}class ue extends G{constructor(r){super(),U(this,r,re,x,W,{})}}export{ue as component};
